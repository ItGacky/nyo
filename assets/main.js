(function(){function F(a,b,d){return d<a?a:d>b?b:d}function ga(a,b){return null!=a?a:b}function Ba(a){return r(Oa()*a)}function oa(a){return null==a?[]:a.map(function(a){return null!=a?a.toJSON():null})}function T(a,b){return null==b?[]:b.map(function(d){return null!=d?a.fromJSON(d):null})}function pa(a){return void 0===a?"(undefined)":null===a?"(null)":a.toString()}function Ca(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];return a.replace(/\$\{(\d+)\}/g,function(a,d){var f=parseInt(d,
10);return pa(b[f])})}function Pa(a,b,d){return Object.defineProperty(a,b,{enumerable:!0,configurable:!0,writable:!0,value:d})}function qa(a,b,d,e){return Object.defineProperty(a,b,{enumerable:!0,configurable:!0,get:d,set:e})}function Db(a,b){var d=document.createElement("script");d.src=a;d.onerror=b;document.head.appendChild(d)}function ra(a,b){if(a===b)return 0;if(void 0===a&&void 0!==b)return-1;if(void 0!==a&&void 0===b)return 1;if(null===a&&null!==b)return-1;if(null!==a&&null===b)return 1;var d=
typeof a,e=typeof b;if(d!==e)return d<e?-1:1;if("object"===d){if(a instanceof Date&&b instanceof Date)return ra(a.getTime(),b.getTime());if(a instanceof Array&&b instanceof Array){a:{for(var d=a.length,e=b.length,c=0,f=ca(d,e);c<f;++c){var h=ra(a[c],b[c]);if(0!==h){d=h;break a}}d=d<e?-1:d>e?1:0}return d}if(a.consructor===Object&&b.constructor===Object){a:{for(var d=Da(a).sort(),e=Da(b).sort(),c=d.length,f=e.length,h=ca(c,f),y=0;y<h;++y){var g=d[y],ha=e[y];if(g<ha||g>ha){d=-1;break a}g=ra(a[g],b[ha]);
if(0!==g){d=g;break a}}d=c<f?-1:c>f?1:0}return d}throw new TypeError("Cannot compare: ("+a+") and ("+b+")");}return a<b?-1:a>b?1:0}function sa(a,b){if(null==a)return b;if("function"===typeof a)return[a,b];a.push(b);return a}function ta(a){if(null!=a)if("function"===typeof a)W.then(a);else for(var b=0;b<a.length;b++)W.then(a[b])}function ab(a){var b=function(){a().then(function(){ta(b.sig);b.sig=void 0})};b.then=function(a){this.sig=sa(this.sig,a);return this};return b}function g(){for(var a=[],b=
0;b<arguments.length;b++)a[b-0]=arguments[b];return new N(a)}function Eb(a,b,d){function e(d){return(null==d.pageX?d.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-a.offsetLeft:d.pageX-a.offsetLeft)*y/a.offsetWidth}function c(d){return(null==d.pageY?d.clientY+document.body.scrollTop+document.documentElement.scrollTop-a.offsetTop:d.pageY-a.offsetTop)*g/a.offsetHeight}function f(){null!=J&&clearTimeout(J);J=setTimeout(function(){J=void 0;var b=a.parentElement,e=b.clientWidth,b=
b.clientHeight,b=b-a.offsetTop;0<b&&(d.magnifyCanvas||(e=ca(e,y),b=ca(b,g)),e*g>y*b?e=P(b*y/g):b=P(e*g/y),0<e&&0<b&&(a.style.width=e+"px",a.style.height=b+"px",!d.refineCanvas&&(e>y||b>g)&&(e=y,b=g),a.width!=e||a.width!=e))&&(a.width=e,a.height=b)},300)}function h(d){W.finish();var e=a.width,c=a.height,f=a.getContext("2d");f.clearRect(0,0,e,c);f.save();f.font="24px Arial";e===y&&c===g||f.scale(e/y,c/g);b.onDraw(f,d);f.restore();window.requestAnimationFrame(h)}var y=a.width,g=a.height,ha=window.navigator.pointerEnabled,
k=window.navigator.msPointerEnabled,v=null!=document.ontouchstart,Qa=ha?"pointerdown":k?"MSPointerDown":v?"touchstart":"mousedown",U=ha?"pointerup":k?"MSPointerUp":v?"touchend":"mouseup";a.addEventListener(ha?"pointermove":k?"MSPointerMove":v?"touchmove":"mousemove",function(a){if(a.buttons&1)b.onDrag(e(a),c(a));else b.onHover(e(a),c(a));a.preventDefault()});a.addEventListener(Qa,function(a){switch(a.button){case 0:b.onDown(e(a),c(a))}a.preventDefault()});a.addEventListener(U,function(a){switch(a.button){case 0:b.onUp(e(a),
c(a));break;case 2:b.onPress(l.TAB)}a.preventDefault()});a.addEventListener("contextmenu",function(a){a.preventDefault()});a.addEventListener("mousewheel",function(a){b.onPress(0<a.wheelDelta?l.PAGE_UP:l.PAGE_DOWN);a.preventDefault()});window.addEventListener("keydown",function(a){if(!a.ctrlKey&&!a.altKey){var d=ga(a.keyCode,a.charCode);d&&l[d]&&(b.onPress(d),a.preventDefault())}});var J;window.addEventListener("resize",f);"complete"===document.readyState?f():window.addEventListener("load",f);window.requestAnimationFrame(h)}
function Ea(a,b,d,e){void 0===e&&(e=!1);var c=a.w,f=a.h;return c>b||f>d||e?(a=c/b,e=f/d,a>e?(c=b,f/=a):(c/=e,f=d),{w:c,h:f}):a}function Fa(a,b){if(b)for(var d in b)switch(d){case "fontSize":a.font=b.fontSize+"px "+(b.fontFamily||"Arial");break;case "fontFamily":null==b.fontSize&&(a.font="24px "+b.fontFamily);break;default:a[d]=b[d]}}function ua(a,b,d,e,c,f){var h;null==e?(f=b,b=f.x,h=f.y,e=f.w,c=f.h,f,f=d):h=d;0<e&&0<c&&(a.save(),Fa(a,f),f&&!f.fillStyle||a.fillRect(b,h,e,c),f&&!f.strokeStyle||a.strokeRect(b,
h,e,c),a.restore())}function Ra(a,b,d,e,c){function f(a,d,b,e,c){c&&!c.strokeStyle||a.strokeText(d,b,e);c&&!c.fillStyle||a.fillText(d,b,e)}a.save();Fa(a,c);if(0>b.indexOf("\n"))f(a,b,d,e,c);else{var h=b.split("\n");b=c&&c.fontSize||24;switch(a.textBaseline){case "top":for(var g=0;g<h.length;g++){var p=h[g];f(a,p,d,e,c);e+=b}break;case "middle":e-=b*(h.length-1)/2;for(g=0;g<h.length;g++)p=h[g],f(a,p,d,e,c),e+=b;break;case "bottom":for(g=0,h=h.reverse();g<h.length;g++)p=h[g],f(a,p,d,e,c),e-=b}}a.restore()}
function ia(a,b,d,e,c,f,h){a.save();Fa(a,h);switch(a.textAlign){case "center":d+=c/2;break;case "right":d+=c;break}if(0>b.indexOf("\n")){switch(a.textBaseline){case "middle":e+=f/2;break;case "bottom":e+=f;break}h&&!h.strokeStyle||a.strokeText(b,d,e,c);h&&!h.fillStyle||a.fillText(b,d,e,c)}else{b=b.split("\n");var g=h&&h.fontSize||24;switch(a.textBaseline){case "middle":e+=(f-g*(b.length-1))/2;break;case "bottom":e=e+f-g*(b.length-1);break}for(f=0;f<b.length;f++){var p=a,k=b[f],l=d,v=e,Qa=c,U=h;U&&
!U.strokeStyle||p.strokeText(k,l,v,Qa);U&&!U.fillStyle||p.fillText(k,l,v,Qa);e+=g}}a.restore()}function va(a,b,d,e,c,f,h){if(0<e&&0<c){a.save();var g=a.createLinearGradient(b,d,b,d+c);g.addColorStop(0,f);g.addColorStop(1,h);a.fillStyle=g;a.fillRect(b,d,e,c);a.restore()}}function Sa(a,b,d,e,c,f,h,g){void 0===g&&(g=0);0<e&&0<c&&(a.save(),a.translate(b+e/2,d+c/2),a.scale(e,c),b=a.createRadialGradient(0,0,g/2,0,0,.5),b.addColorStop(0,f),b.addColorStop(1,h),a.fillStyle=b,a.fillRect(-.5,-.5,1,1),a.restore())}
function B(a,b,d){return"rgb("+a+","+b+","+d+")"}function w(a,b,d,e){return"rgba("+a+","+b+","+d+","+e.toFixed(6).replace(/([0-9]+(\.[0-9]+[1-9])?)(\.?0+$)/,"$1")+")"}function Ga(a){null==Ha&&(Ha=[g("Tag","Melee"),g("Tag","Throw"),g("Tag","Shoot"),g("Tag","Shield"),g("Tag","Head"),g("Tag","Body"),g("Tag","Arms"),g("Tag","Legs"),g("Tag","Slash"),g("Tag","Blunt"),g("Tag","Pierce"),g("Tag","Magic"),g("Tag","Alchemy")]);return a.map(function(a){return Ha[a].localized}).join(", ")}function wa(a){for(var b=
0,d=0;d<a.length;d++)b|=1<<a[d];return b}function Ta(a,b){0>a.indexOf("/")&&(a="assets/char/"+a);return a.endsWith(".png")?new S(a):new Fb(a,b)}function bb(a){var b={fillStyle:k.WHITE.rgba,strokeStyle:k.BLACK.rgba,fontSize:44,textAlign:"center",textBaseline:"middle"},d={textAlign:"right",textBaseline:"middle"},e={textAlign:"right",textBaseline:"middle"},c=new K(4,4,32,32,new S("assets/config.png"),function(){function c(a,b){var e=100+70*a;(new G(640,e,160,60,new C(b,d))).attach(p);return e}function h(a,
d,b){a=c(a,d);d=new Gb(810,a+15,300,30,b);d.attach(p);(new G(1120,a,50,60,new C(b,e))).attach(p);return d}function y(a,d,b,e,h,g){a=c(a,d);var y=new K(810,a+0,100,60,new C(function(){var a=h();y.pressed&&y.hover&&(a=!a);return(a?b:e).localized}),g);y.attach(p);return y}var p=new Ia;(new G(0,0,1280,720,new cb(pb))).attach(p);(new G(0,20,1280,80,new C(g("Config","Caption"),b))).attach(p);(new K(480,495,320,90,new C(g("Config","OK")),function(){p.detach()},qb)).attach(p);var k=Da(N.languages).sort().map(function(a){return g("Language",
a)}),l=new D(10,10,160,D.heightOf(ca(10,k.length)),[{name:g("Config","LanguageID"),extract:function(a){return a.src[1]},width:40,align:"center"},{name:g("Config","LanguageName"),extract:function(a){return a.localized}}],k,function(a){l.selected=a;N.language=a.src[1]});l.selected=l.rows.find(function(a){return a.src[1]===N.language});l.attach(p);h(0,g("Config","Volume"),m.volume);h(1,g("Config","CPUEffects"),m.effects);var k=g("Config","On"),v=g("Config","Off");y(2,g("Config","FullScreen"),k,v,function(){return System.getFullScreen()},
function(){System.setFullScreenn(!System.getFullScreen())});y(3,g("Config","MagnifyCanvas"),k,v,function(){return m.magnifyCanvas},function(){m.magnifyCanvas=!m.magnifyCanvas});y(4,g("Config","RefineCanvas"),k,v,function(){return m.refineCanvas},function(){m.refineCanvas=!m.refineCanvas});(function(a,d,b){a=new K(810,70*a+100,300,60,new C(d),b);a.attach(p);return a})(5,g("Config","BackToTitle"),function(){p.detach();xa()});p.attach(a)},Hb,new K.IconDesign("white"));c.attach(a);return c}function rb(){try{var a=
System.getRoamingStorage("NYO");if(!a)return null;var b=sb(a);return{shop:b.shop,warehouse:T(ja,b.warehouse),reservers:T(Z,b.reservers),party:T(Z,b.party),gold:b.gold}}catch(d){return H.error(d),null}}function tb(a){try{System.setRoamingStorage("NYO",ub(a))}catch(b){H.error(b)}vb()}function Ib(){try{var a=System.getLocalStorage("NYO");if(a){var b=sb(a);b&&(typeof b.language===typeof N.language&&(N.language=b.language),typeof b.magnifyCanvas===typeof m.magnifyCanvas&&(m.magnifyCanvas=b.magnifyCanvas),
typeof b.refineCanvas===typeof m.refineCanvas&&(m.refineCanvas=b.refineCanvas),typeof b.volume===typeof m.volume.value&&(m.volume.value=b.volume),typeof b.effects===typeof m.effects.value&&(m.effects.value=b.effects))}}catch(d){H.error(d)}}function vb(){try{System.setLocalStorage("NYO",ub({language:N.language,magnifyCanvas:m.magnifyCanvas,refineCanvas:m.refineCanvas,volume:m.volume.value,effects:m.effects.value}))}catch(a){H.error(a)}}var q=this&&this.__extends||function(a,b){function d(){this.constructor=
a}for(var e in b)b.hasOwnProperty(e)&&(a[e]=b[e]);a.prototype=null===b?Object.create(b):(d.prototype=b.prototype,new d)},Da=Object.keys,db=Math.abs,ca=Math.min,V=Math.max,r=Math.floor,eb=Math.ceil,P=Math.round,Va=Math.pow,X=Math.sin,ka=Math.cos,wb=Math.atan2,Y=Math.PI,Oa=Math.random,sb=JSON.parse,ub=JSON.stringify,Wa=function(){},W={sig:null,then:function(a){this.sig=sa(this.sig,a);return this},finish:function(){var a=this.sig;if(a)if(this.sig=null,"function"===typeof a)a();else for(var b=0;b<a.length;b++)(0,a[b])()}},
Xa=function(){function a(a){for(var d=this,e=a.length,c=0;c<a.length;c++)a[c].then(function(){0>=--e&&(ta(d.sig),d.sig=void 0)})}a.prototype.then=function(a){this.sig=sa(this.sig,a);return this};return a}(),N=function(){function a(a){this.src=a}Object.defineProperty(a.prototype,"localized",{get:function(){function b(d){var b=a.languages,f=a.language,h=b[f];null==h&&(f=a.language=a.fallback,h=b[f]);if("string"===typeof h)return b[f]=!0,Db(h,function(){b[f]=!1}),null;if(!0===h)return null;if(!1===h)return d.join(".");
for(var g=h,h=0,p=d.length;h<p;++h)if(g=g[d[h]],null==g)return d.join(".");return g.toString()}if(this._language!==a.language){var d=b(this.src);if(null===d)return this.src.join(".");this._language=a.language;this._localized=d}return this._localized},enumerable:!0,configurable:!0});a.prototype.toString=function(){return this.localized};a.language=(window.navigator.userLanguage||window.navigator.language||window.navigator.browserLanguage).substr(0,2);a.fallback="en";a.languages={};return a}();System.localize=
function(a,b){N.languages[a]=b};var l;(function(a){a[a.TAB=9]="TAB";a[a.ENTER=13]="ENTER";a[a.ESCAPE=27]="ESCAPE";a[a.SPACE=32]="SPACE";a[a.PAGE_UP=33]="PAGE_UP";a[a.PAGE_DOWN=34]="PAGE_DOWN";a[a._END=35]="_END";a[a._HOME=36]="_HOME";a[a.LEFT=37]="LEFT";a[a.UP=38]="UP";a[a.RIGHT=39]="RIGHT";a[a.DOWN=40]="DOWN";a[a._INSERT=45]="_INSERT";a[a.DELETE=46]="DELETE";a[a.$0=48]="$0";a[a.$1=49]="$1";a[a.$2=50]="$2";a[a.$3=51]="$3";a[a.$4=52]="$4";a[a.$5=53]="$5";a[a.$6=54]="$6";a[a.$7=55]="$7";a[a.$8=56]=
"$8";a[a.$9=57]="$9";a[a.A=65]="A";a[a.B=66]="B";a[a.C=67]="C";a[a.D=68]="D";a[a.E=69]="E";a[a.F=70]="F";a[a.G=71]="G";a[a.H=72]="H";a[a.I=73]="I";a[a.J=74]="J";a[a.K=75]="K";a[a.L=76]="L";a[a.M=77]="M";a[a.N=78]="N";a[a.O=79]="O";a[a.P=80]="P";a[a.Q=81]="Q";a[a.R=82]="R";a[a.S=83]="S";a[a.T=84]="T";a[a.U=85]="U";a[a.V=86]="V";a[a.W=87]="W";a[a.X=88]="X";a[a.Y=89]="Y";a[a.Z=90]="Z"})(l||(l={}));var da=function(){function a(){this.parent=null}a.prototype.onHover=function(a,d){};a.prototype.onDrag=
function(a,d){};a.prototype.onDown=function(a,d){};a.prototype.onUp=function(a,d){};a.prototype.onPress=function(a){};a.prototype.onDraw=function(a,d){};a.prototype.attach=function(a){if(a)return a.onAttach(this);throw new RangeError("Cannot attach to null");};a.prototype.detach=function(){var a=this.parent;return a?(a.onDetach(this),a):null};Object.defineProperty(a.prototype,"visible",{get:function(){return!0},set:function(a){Pa(this,"visible",a)},enumerable:!0,configurable:!0});return a}(),Q=function(a){function b(d){a.call(this);
this.children=[];if(d)for(var b=0;b<d.length;b++)d[b].attach(this)}q(b,a);b.prototype.onAttach=function(a){if(null==a.parent)return this.children.push(a),a.parent=this,!0;if(a.parent===this)return!1;throw new RangeError("Cannot add Component with another parent");};b.prototype.onDetach=function(a){if(a.parent===this){a.parent=null;for(var b=this.children,c=0;c<b.length;++c)if(b[c]===a){a=this.children;b=a.length;if(0>c||b<=c)throw new RangeError("index is out of range");for(var f=Array(b-1),h=0;h<
c;++h)f[h]=a[h];for(h=c+1;h<b;++h)f[h-1]=a[h];this.children=f;break}return!0}if(null==a.parent)return!1;throw new RangeError("Cannot remove Component with another parent");};b.prototype.onHover=function(a,b){for(var c=0,f=this.children;c<f.length;c++){var h=f[c];if(h.visible)h.onHover(a,b)}};b.prototype.onDrag=function(a,b){for(var c=0,f=this.children;c<f.length;c++){var h=f[c];if(h.visible)h.onDrag(a,b)}};b.prototype.onDown=function(a,b){for(var c=0,f=this.children;c<f.length;c++){var h=f[c];if(h.visible)h.onDown(a,
b)}};b.prototype.onUp=function(a,b){for(var c=0,f=this.children;c<f.length;c++){var h=f[c];if(h.visible)h.onUp(a,b)}};b.prototype.onPress=function(a){for(var b=0,c=this.children;b<c.length;b++){var f=c[b];if(f.visible)f.onPress(a)}};b.prototype.onDraw=function(a,b){for(var c=0,f=this.children;c<f.length;c++){var h=f[c];if(h.visible)h.onDraw(a,b)}};return b}(da),k=function(){function a(a,d,e,c){void 0===c&&(c=1);this.r=a;this.g=d;this.b=e;this.a=c}Object.defineProperty(a.prototype,"rgb",{get:function(){var a=
F(0,255,P(255*this.r)),d=F(0,255,P(255*this.g)),e=F(0,255,P(255*this.b));return B(a,d,e)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"rgba",{get:function(){var a=F(0,255,P(255*this.r)),d=F(0,255,P(255*this.g)),e=F(0,255,P(255*this.b)),c=F(0,1,this.a);return w(a,d,e,c)},enumerable:!0,configurable:!0});a.prototype.toString=function(){return this.rgba};a.BLACK=new a(0,0,0);a.WHITE=new a(1,1,1);a.GRAY=new a(.5,.5,.5);a.RED=new a(1,0,0);a.MAROON=new a(.5,0,0);a.FUCHSIA=new a(1,0,
1);a.PURPLE=new a(.5,0,.5);a.LIME=new a(0,1,0);a.GREEN=new a(0,.5,0);a.BLUE=new a(0,0,1);a.NAVY=new a(0,0,.5);a.AQUA=new a(0,1,1);a.TEAL=new a(0,.5,.5);a.OLIVE=new a(.5,.5,0);a.YELLOW=new a(1,1,0);return a}(),cb=function(){function a(a){this.rectStyle=a}a.prototype.draw=function(a,d,e){ua(a,e,this.rectStyle)};return a}(),C=function(){function a(a,d,e){this.value=a;this.textStyle=d;this.rectStyle=e;null==this.textStyle&&(this.textStyle={});null==this.textStyle.fillStyle&&(this.textStyle.fillStyle=
k.WHITE.rgba);null==this.textStyle.textAlign&&(this.textStyle.textAlign="center");null==this.textStyle.textBaseline&&(this.textStyle.textBaseline="middle")}a.prototype.draw=function(a,d,e){d=e.x;var c=e.y,f=e.w;e=e.h;this.rectStyle&&ua(a,d,c,f,e,this.rectStyle);ia(a,this.text,d,c,f,e,this.textStyle)};Object.defineProperty(a.prototype,"text",{get:function(){var a=this.value;"function"===typeof a&&(a=a());return pa(a)},enumerable:!0,configurable:!0});return a}(),S=function(){function a(a){this.src=
a;this._image=void 0}Object.defineProperty(a.prototype,"image",{get:function(){var b=this;if(void 0===this._image){this._image=null;var d=new Image;d.addEventListener("load",function(){b._image=d});d.addEventListener("error",function(){b._image=a.DUMMY});d.src=this.src}return this._image},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"w",{get:function(){var a=this.image;return a?a.width:1},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"h",{get:function(){var a=
this.image;return a?a.height:1},enumerable:!0,configurable:!0});a.prototype.draw=function(a,d,e,c,f){void 0===f&&(f=.5);d=this.image;var h=e.x,g=e.y,p=e.w;e=e.h;d&&0<p&&0<e&&(a.save(),null==c||0>=f?a.drawImage(d,h,g,p,e):(a.globalCompositeOperation="destination-out",a.drawImage(d,h,g,p,e),a.globalCompositeOperation="destination-over",a.fillStyle=c,a.fillRect(h,g,p,e),1>f&&(a.globalCompositeOperation="source-over",a.globalAlpha=1-f,a.drawImage(d,h,g,p,e))),a.restore())};a.prototype.createPattern=function(a,
d){var e=this.image;return e?a.createPattern(e,d):w(0,0,0,0)};a.DUMMY=null;return a}(),H,Jb={fontSize:32,fillStyle:"white",strokeStyle:"black",textAlign:"left",textBaseline:"top",lineWidth:2},pb={fillStyle:w(0,0,0,.8)},Kb={fillStyle:"white",strokeStyle:"black",fontSize:44,textAlign:"center",textBaseline:"middle"},I=function(a){function b(d,b){a.call(this);this.duration=d;b&&(this.onAnimation=b)}q(b,a);b.prototype.attach=function(d){return a.prototype.attach.call(this,d)?(this.start=performance.now(),
!0):!1};b.prototype.detach=function(){this.start=null;return a.prototype.detach.call(this)};b.prototype.onDraw=function(a,b){if(null!=this.start)if(b>=this.start+this.duration)this.onAnimation(1,a,b),this.detach(),ta(this.sig),this.sig=void 0;else if(b>=this.start)this.onAnimation((b-this.start)/this.duration,a,b)};b.prototype.onAnimation=function(a,b,c){};b.prototype.then=function(a){this.sig=sa(this.sig,a);return this};b.clamp=function(a,b,c){return null==b||a<b?0:null==c||b+c<a?1:(a-b)/c};b.cycle=
function(a,b,c){return null==b||null==c||a<b?0:(a-b)%c/c};return b}(da),xb=function(a){function b(b,e){void 0===e&&(e=400);a.call(this,e);this.next=b}q(b,a);b.prototype.onAnimation=function(a,b,c){if(1>a){if(0<a)this.next.onDraw(b,c);b.save();b.globalAlpha=1-a;b.fillStyle="black";b.fillRect(0,0,1280,720);b.restore()}else this.next.attach(this.parent)};return b}(I),ea=function(a){function b(b,e,c){void 0===c&&(c=400);a.call(this,c);this.prev=b;this.next=e}q(b,a);b.prototype.attach=function(b){return a.prototype.attach.call(this,
b)?(this.prev.detach(),!0):!1};b.prototype.onAnimation=function(a,b,c){1>a?(this.prev.onDraw(b,c),0<a&&(b.save(),b.globalAlpha=a,b.fillStyle="black",b.fillRect(0,0,1280,720),b.restore())):this.next&&(new xb(this.next,this.duration)).attach(this.parent)};return b}(I),Ia=function(a){function b(){a.apply(this,arguments)}q(b,a);b.prototype.attach=function(b){return null==this.prev&&null!=b.parent&&a.prototype.attach.call(this,b.parent)?(b.detach(),this.prev=b,!0):!1};b.prototype.detach=function(){var b=
a.prototype.detach.call(this);b&&this.prev.attach(b);return b};b.prototype.onDraw=function(b,e){this.prev.onDraw(b,e);a.prototype.onDraw.call(this,b,e)};b.confirm=function(a,e){for(var c=[],f=2;f<arguments.length;f++)c[f-2]=arguments[f];var h=new b;(new G(0,0,1280,720,new C(e,Kb,pb))).attach(h);for(var f=c.length,g=1280/(3+c.length),p=g/8,k=(1280-g*f-p*(f-1))/2,l=function(a){var b=c[a],d=b.click,e=b.mnemonic;(new K(k+(g+p)*a,495,g,90,new C(b.label),d?function(){h.detach();d()}:function(){h.detach()},
e)).attach(h)},v=0;v<f;++v)l(v);h.attach(a);return h};return b}(Q),la=function(a){function b(b,e,c,f){a.call(this);this.x=b;this.y=e;this.w=c;this.h=f}q(b,a);b.prototype.contains=function(a,b){return this.visible&&this.x<=a&&this.y<=b&&a<this.x+this.w&&b<this.y+this.h};Object.defineProperty(b.prototype,"left",{get:function(){return this.x},set:function(a){this.w=this.w+this.x-a;this.x=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"right",{get:function(){return this.x+this.w},
set:function(a){this.w=a-this.x},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"top",{get:function(){return this.y},set:function(a){this.h=this.h+this.y-a;this.y=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"bottom",{get:function(){return this.y+this.h},set:function(a){this.h=a-this.y},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"center",{get:function(){return{x:this.x+this.w/2,y:this.y+this.h/2}},enumerable:!0,configurable:!0});b.prototype.moveTo=
function(a,b){this.x=a;this.y=b;return this};b.prototype.moveBy=function(a,b){this.x+=a;this.y+=b;return this};return b}(da),G=function(a){function b(b,e,c,f,h){a.call(this,b,e,c,f);this.drawable=h}q(b,a);b.prototype.onDraw=function(a,b){this.drawable.draw(a,b,this)};return b}(la),K=function(a){function b(d,e,c,f,h,g,k,l){void 0===l&&(l=b.defaultDesign);a.call(this,d,e,c,f);this.drawable=h;this.click=g;this.mnemonic=k;this.design=l;this._hover=this._pressed=!1}q(b,a);Object.defineProperty(b.prototype,
"enabled",{get:function(){return!0},set:function(a){Pa(this,"enabled",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"pressed",{get:function(){return this._pressed},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hover",{get:function(){return this._hover},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"state",{get:function(){return this.enabled?this._hover?this._pressed?2:1:0:3},enumerable:!0,configurable:!0});b.prototype.onHover=function(a,
b){this._hover=this.contains(a,b);this._pressed=!1};b.prototype.onDrag=function(a,b){this._hover=this._pressed&&this.contains(a,b)};b.prototype.onDown=function(a,b){this._hover=this._pressed=this.enabled&&this.contains(a,b)};b.prototype.onUp=function(a,b){if(this._pressed&&(this._pressed=!1,this.contains(a,b)))this.onClick()};b.prototype.onPress=function(a){this.mnemonic&&0<=this.mnemonic.indexOf(a)&&this.enabled&&(this._pressed=!1,this.onClick())};b.prototype.onClick=function(){var a=this;W.then(function(){return a.click()})};
b.prototype.onDraw=function(a,b){this.design.draw(a,b,this)};b.defaultDesign={draw:function(a,b,c){a.save();switch(c.state){case 0:a.fillStyle=w(0,0,0,.8);a.strokeStyle=B(200,200,200);break;case 1:a.fillStyle=w(0,0,50,.8);a.strokeStyle=B(100,100,200);break;case 2:a.fillStyle=w(0,0,150,.8);a.strokeStyle=B(100,100,255);break;case 3:a.fillStyle=w(200,200,200,.8),a.strokeStyle=B(200,200,200)}a.fillRect(c.x,c.y,c.w,c.h);a.strokeRect(c.x,c.y,c.w,c.h);a.restore();c.drawable&&c.drawable.draw(a,b,c)}};b.IconDesign=
function(){function a(b){this.overlay=b}a.prototype.draw=function(a,b,d){var h=d.drawable;switch(d.state){case 0:h.draw(a,b,d);break;case 1:h.draw(a,b,d,this.overlay,.7);break;case 2:h.draw(a,b,d,this.overlay,.9);break;case 3:h.draw(a,b,d,w(200,200,200,.8))}};return a}();return b}(la),yb=function(a){function b(b,e,c,f,h,g,k,l,m,v){void 0===v&&(v=K.defaultDesign);a.call(this,b,e,c,f,g,k,m,v);this.group=h;this.swap=l;h.push(this)}q(b,a);b.prototype.onDrag=function(b,e){var c=this;a.prototype.onDrag.call(this,
b,e);if(this.dragged&&!this.swapping){var f=this.group.find(function(a){return a!==c&&a.contains(b,e)&&!a.swapping});if(f){var h=performance.now();this.onSwap(f,h);f.onSwap(this,h);this.dragged={xOrig:this.swapping.xTo,yOrig:this.swapping.yTo};this.swap&&this.swap(f)}else null!=this.dragged.xDown?(this.x=this.dragged.xOrig-this.dragged.xDown+b,this.y=this.dragged.yOrig-this.dragged.yDown+e):(this.dragged.xDown=b,this.dragged.yDown=e)}};b.prototype.onDown=function(b,e){a.prototype.onDown.call(this,
b,e);!this.dragged&&this.contains(b,e)&&(this.dragged={xDown:b,yDown:e,xOrig:this.x,yOrig:this.y})};b.prototype.onUp=function(b,e){if(this.swapping)this.dragged=null,a.prototype.onUp.call(this,b,e);else if(this.dragged){var c=this.dragged,f=c.xOrig,c=c.yOrig;this.swapping={start:performance.now(),xFrom:this.x,yFrom:this.y,xTo:f,yTo:c};this.dragged=null;if(this._pressed&&(this._pressed=!1,this.contains(b,e)&&f<=b&&c<=e&&b<f+this.w&&e<c+this.h))this.onClick()}else a.prototype.onUp.call(this,b,e)};b.prototype.onSwap=
function(a,b){this._pressed=!1;this.swapping={start:b,xFrom:this.x,yFrom:this.y,xTo:a.dragged?a.dragged.xOrig:a.x,yTo:a.dragged?a.dragged.yOrig:a.y}};b.prototype.onDraw=function(b,e){if(this.swapping){var c=I.clamp(e,this.swapping.start,200);1>c?(c=(1-ka(Y*c))/2,this.x=this.swapping.xFrom*(1-c)+this.swapping.xTo*c,this.y=this.swapping.yFrom*(1-c)+this.swapping.yTo*c):(this.x=this.swapping.xTo,this.y=this.swapping.yTo,this.swapping=null)}a.prototype.onDraw.call(this,b,e)};return b}(K),D=function(a){function b(d,
e,c,f,h,g,k,l){void 0===l&&(l=b.defaultDesign);a.call(this,d,e,c,f);this.columns=h;this.rows=g;this.click=k;this.design=l;this.topRow=0}q(b,a);b.heightOf=function(a,e){void 0===e&&(e=b.defaultDesign);return e.headerHeight+a*e.rowHeight};b.prototype.onHover=function(a,b){this.hover=this.toRowIndex(a,b);this.scrolling=this.dragged=null};b.prototype.onDrag=function(a,b){var c=this.design.headerHeight;null!=this.scrolling?this.scrollTo(r(this.rows.length*(b-(this.y+c)-this.scrolling)/(this.h-c))):(c=
this.toRowIndex(a,b),null!=c&&null!=this.dragged&&c!==this.dragged&&(f=[this.rows[c],this.rows[this.dragged]],this.rows[this.dragged]=f[0],this.rows[c]=f[1],this.dragged=c,this.sortkeys=this.scrolling=this.hover=null));var f};b.prototype.onDown=function(a,b){if(this.contains(a,b)&&(this.hover=this.dragged=this.toRowIndex(a,b),null==this.dragged)){var c=this.design,f=c.headerHeight,h=this.w-c.scrollBarWidth,c=this.y+f;if(this.x<=a&&a<this.x+h&&this.y<=b&&b<c)c=this.toColumnIndex(a,b),null!=c&&this.sort(c,
null!=this.sortkeys&&this.sortkeys[0]===c+1);else if(this.x+h<=a&&a<this.right){var h=this.rows.length,g=this.displayCount,f=this.h-f,k=c+f*this.topRow/h,l=f*g/h;c<=b&&b<k?(this.scrollTo(r(h*(b-c)/f)),k=c+f*this.topRow/h):k+l<=b&&b<this.bottom&&(this.scrollTo(r(h*(b-c)/f)-g+1),k=c+f*this.topRow/h);k<=b&&b<k+l&&(this.scrolling=b-k)}}};b.prototype.onUp=function(a,b){null==this.scrolling&&null!=this.dragged&&this.dragged===this.hover&&(this.click(this.rows[this.dragged],this.dragged),this.refresh());
this.scrolling=this.dragged=null;this.hover=this.toRowIndex(a,b)};b.prototype.onPress=function(a){switch(a){case l.PAGE_DOWN:this.scrollBy(this.scrollStep);break;case l.PAGE_UP:this.scrollBy(-this.scrollStep)}};b.prototype.onDraw=function(a,b){var c=this.design,f=c.headerHeight,h=c.scrollBarWidth,g=this.rows.length,k=this.displayCount,l=this.x,m=this.y+f,v=this.w-h,r=this.h-f,q=this.x+v,J=(0<g&&r*this.topRow/g||0)+m,O=0<g&&r*k/g||r,nb=this.defaultColumnWidth;c.drawHeader(a,this.x,this.y,this.w,f);
c.drawBackground(a,this.x,m,v,r);0<h&&(c.drawHeader(a,q,m,h,r),k<g&&c.drawScrollBar(a,q,J,h,O));a.save();a.font=c.rowFont;a.fillStyle=c.rowStyle;a.textBaseline="middle";for(var O=c.rowHeight,R=0;R<k;++R){var h=R+this.topRow,ob=this.rows[h],Ua=m+O*R;h===this.dragged?c.drawRowDragged(a,this.x,Ua,v,O):ob===this.selected?c.drawRowSelected(a,this.x,Ua,v,O):h===this.hover&&null==this.dragged&&c.drawRowHover(a,this.x,Ua,v,O);for(var fb=0,h=0,g=this.columns.length;h<g;++h){var q=this.columns[h],J=ga(q.width,
nb),zb=this.extract(ob,q);if(null!=zb){var ma=l+fb+2,Ja=J-4;a.textAlign=q.align||"left";switch(a.textAlign){case "center":ma+=Ja/2;break;case "right":ma+=Ja}a.fillText(zb,ma,Ua+O/2,Ja)}fb+=J}}a.restore();a.save();O=0;a.font=c.headerFont;a.fillStyle=c.headerStyle;a.textAlign="center";a.textBaseline="middle";a.strokeStyle=c.lineStyle;h=0;for(g=this.columns.length;h<g;++h)q=this.columns[h],J=ga(q.width,nb),R=l+O,0<h&&(a.beginPath(),a.moveTo(R,m),a.lineTo(R,this.bottom),a.stroke()),a.fillText(q.name.localized,
R+J/2,this.y+f/2),O+=J;a.restore();0===k&&0<r&&c.emptyText&&(a.save(),a.font=c.emptyFont,a.textAlign="center",a.textBaseline="middle",a.fillStyle=c.emptyStyle,a.fillText(c.emptyText.localized,this.x+v/2,m+r/2),a.restore())};Object.defineProperty(b.prototype,"displayCount",{get:function(){var a=this.design;return ca(r((this.h-a.headerHeight)/a.rowHeight),this.rows.length)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"scrollStep",{get:function(){return V(r(.2*this.displayCount),
1)},enumerable:!0,configurable:!0});b.prototype.extract=function(a,b){var c=b.extract;switch(typeof c){case "function":return c(a);case "number":return a[c];default:return a[c]}};b.prototype.compare=function(a,b){for(var c=0,f=0,h=this.sortkeys.length;0===c&&f<h;++f){var g=this.sortkeys[f],c=this.columns[(0<g?g:-g)-1],c=c.compare?c.compare(a,b):ra(this.extract(a,c),this.extract(b,c));0>g&&(c=-c)}return c};b.prototype.sort=function(a,b){var c=this;void 0===b&&(b=!1);var f=a+1;if(this.sortkeys){for(var h=
0,g=this.sortkeys.length;h<g;++h)if(this.sortkeys[h]===f||this.sortkeys[h]===-f){this.sortkeys.splice(h,1);break}this.sortkeys.unshift(b?-f:f)}else this.sortkeys=[b?-f:f];this.rows.sort(function(a,b){return c.compare(a,b)})};b.prototype.toRowIndex=function(a,b){var c=this.design,f=this.w-c.scrollBarWidth;return this.x<=a&&a<this.x+f&&(c=this.topRow+r((b-this.y-c.headerHeight)/c.rowHeight),this.topRow<=c&&c<this.rows.length)?c:null};b.prototype.toColumnIndex=function(a,b){var c=this.w-this.design.scrollBarWidth;
if(this.x<=a&&a<this.x+c)for(var c=this.defaultColumnWidth,f=this.x,h=0,g=this.columns.length;h<g;++h){var k=ga(this.columns[h].width,c);if(f<=a&&a<f+k)return h;f+=k}return null};Object.defineProperty(b.prototype,"defaultColumnWidth",{get:function(){for(var a=this.w-this.design.scrollBarWidth,b=0,c=0,f=0,h=this.columns;f<h.length;f++){var g=h[f];null!=g.width?b+=g.width:++c}return 0<c&&b<a?(a-b)/c:0},enumerable:!0,configurable:!0});b.prototype.refresh=function(){var a=this.rows.length;this.dragged>=
a&&(this.dragged=null);this.hover>=a&&(this.hover=null);this.scrollTo(this.topRow)};b.prototype.scrollTo=function(a){this.topRow=F(0,this.rows.length-this.displayCount,a)};b.prototype.scrollBy=function(a){this.scrollTo(this.topRow+a)};b.defaultDesign={rowHeight:28,rowFont:"20px Arial",rowStyle:k.WHITE.rgb,headerHeight:24,headerFont:"18px Arial",headerStyle:k.WHITE.rgb,scrollBarWidth:14,lineStyle:(new k(.4,.4,.4)).rgba,drawHeader:function(a,b,c,f,h){a.save();a.fillStyle=w(25,25,25,.8);a.fillRect(b,
c,f,h);a.restore()},drawBackground:function(a,b,c,f,h){a.save();a.fillStyle=w(0,0,0,.6);a.fillRect(b,c,f,h);a.restore()},drawScrollBar:function(a,b,c,f,h){va(a,b,c,f,h,B(100,100,100),B(75,75,75))},drawRowDragged:function(a,b,c,f,h){va(a,b,c,f,h,B(255,0,0),B(50,0,0))},drawRowSelected:function(a,b,c,f,h){va(a,b,c,f,h,B(100,0,0),B(50,0,0))},drawRowHover:function(a,b,c,f,h){va(a,b,c,f,h,B(75,0,0),B(50,0,0))}};return b}(la),Ab=function(){function a(a,d,e){this.min=d;this.max=e;this.value=a}Object.defineProperty(a.prototype,
"value",{get:function(){return this._value},set:function(a){this._value=F(this.min,this.max,P(a))},enumerable:!0,configurable:!0});a.prototype.toString=function(){return this._value.toString()};a.prototype.valueOf=function(){return this._value};return a}(),Gb=function(a){function b(d,e,c,f,h,g){void 0===g&&(g=b.defaultDesign);a.call(this,d,e,c,f);this.value=h;this.design=g;this.hover=this.dragged=!1}q(b,a);b.prototype.getValueAsX=function(){var a=this.design.knobWidth,b=this.value,c=b.min;return this.x+
a/2+(b.value-c)/(b.max-c)*(this.w-a)};b.prototype.setValueByX=function(a){var b=this.design.knobWidth;a=F(0,1,(a-this.x-b/2)/(this.w-b));var b=this.value,c=b.min;this.value.value=P(c+a*(b.max-c))};b.prototype.onHover=function(a,b){this.hover=this.contains(a,b);this.dragged=!1};b.prototype.onDrag=function(a,b){this.hover=this.dragged&&this.contains(a,b);this.dragged&&this.setValueByX(a)};b.prototype.onDown=function(a,b){this.contains(a,b)&&(this.dragged=!0,this.setValueByX(a))};b.prototype.onUp=function(a,
b){this.dragged=!1};b.prototype.onDraw=function(a,b){this.design.draw(a,b,this)};Object.defineProperty(b.prototype,"knob",{get:function(){var a=this.design.knobWidth,b=this.h;return{x:this.getValueAsX()-a/2,y:this.y-(this.h-b)/2,w:a,h:b,state:this.dragged?2:this.hover?1:0}},enumerable:!0,configurable:!0});b.defaultDesign={knobWidth:12,draw:function(a,b,c){ua(a,c,{fillStyle:w(50,50,50,.8),strokeStyle:"white",lineWidth:4});b=c.knob;c={strokeStyle:"white",lineWidth:4};switch(b.state){case 0:c.fillStyle=
w(150,150,150,.8);break;case 1:c.fillStyle=w(200,200,200,.8);break;case 2:c.fillStyle=w(255,255,255,.8)}ua(a,b,c)}};return b}(la),Lb=function(a){function b(b,e,c,f,h,g){a.call(this,b,e,c,f);this.duration=h;this.style=g;this.logs=[]}q(b,a);b.prototype.onDraw=function(a,b){var c=this.logs;if(0<c.length){var f=b-this.duration,g=c.findIndex(function(a){return a.when>f});0>g?c.length=0:c.splice(0,g);g=c.length;if(0<g)for(var k=this.style,l=ga(k.fontSize,24),m=0;m<g;++m)ia(a,c[m].message,this.x,this.y+
m*l,this.w,l,k)}};b.prototype.log=function(a){if(a){var b=performance.now(),c=this.logs,f=c.length;0<f&&c[f-1].message===a?c[f-1].when=b:c.push({message:pa(a),when:b})}};b.prototype.error=function(a){this.log(a)};return b}(la);N.languages.en="assets/lang/en.js";N.languages.ja="assets/lang/ja.js";var gb={bkgnd:new k(0,0,0,.6),delta:new k(1,.2,0),normal:new k(.6,.8,0),full:new k(0,.8,.2)},Bb={bkgnd:new k(0,0,0,.6),delta:new k(0,.2,.4),normal:new k(0,.6,.8),full:new k(0,.6,1)},na=[{PICK:0,WALK:!1,POPUP:!1},
{PICK:0,WALK:!1,POPUP:!0},{PICK:0,WALK:!0,POPUP:!0},{PICK:300,WALK:!0,POPUP:!0}],qb=[l.TAB,l.ENTER,l.ESCAPE,l.SPACE,l.DELETE],hb=[l.ENTER,l.SPACE,l.Y],ib=[l.TAB,l.ESCAPE,l.DELETE,l.N],Hb=[l.ESCAPE],Mb=[l.ENTER,l.SPACE],Nb={Warrior:{INT:4,DEX:4,STR:7,equipments:["Mace","PlateArmor","Mace"],skills:["Swing","Crash","Bash"],image:"nazrin"},Samurai:{INT:3,DEX:7,STR:5,equipments:["Katana","Chainmail"],skills:["Swing","Slash","CutThrough","Sweep"],image:"rin"},Knight:{INT:6,DEX:2,STR:7,equipments:["Spear",
"LamellarArmor","KiteShield"],skills:["Swing","Stab","Thrust","ShieldBash","ShieldCharge"],image:"toramaru"},Thief:{INT:3,DEX:6,STR:6,equipments:["LongBow","LetherArmor","FirstAidKit"],skills:["Shoot","FirstAid"],image:"marisa"},Healer:{INT:7,DEX:3,STR:5,equipments:["Staff","Robe"],skills:["Swing","Heal","PartyHeal"],image:"reimu"},Mage:{INT:8,DEX:4,STR:3,equipments:["Wand","Robe"],skills:["FireBall","IceSpear","DrainLife","LightningLaser","FireNova"],image:"utsuho"}},Cb={Ant:{INT:3,DEX:3,STR:4,equipments:["Dagger",
"LetherArmor"],skills:["Swing"],image:"ant.png"},Elemental:{INT:4,DEX:3,STR:3,equipments:["Wand","LetherArmor"],skills:["FireBall"],image:"elemental.png"},Frog:{INT:4,DEX:4,STR:4,equipments:["ShortBow","LetherArmor"],skills:["Shoot"],image:"frog.png"},Plant:{INT:4,DEX:3,STR:4,equipments:["Wand","LetherArmor"],skills:["FireNova"],image:"plant.png"},Slug:{INT:3,DEX:3,STR:3,equipments:["Wand","LetherArmor"],skills:["DrainLife"],image:"slug.png"},Snail:{INT:3,DEX:3,STR:3,equipments:["LongBow","LetherArmor"],
skills:["Shoot"],image:"snail.png"},Sword:{INT:3,DEX:5,STR:4,equipments:["LongSword","LetherArmor"],skills:["Swing"],image:"sword.png"},Wall:{INT:3,DEX:3,STR:6,equipments:["Mace","LetherArmor"],skills:["Swing"],image:"wall.png"},Weasel:{INT:3,DEX:6,STR:3,equipments:["Spear","LetherArmor"],skills:["Thrust"],image:"weasel.png"}},Ob={AddedFire:{tags:[0,1,2],min:5,max:10,ATK:function(a,b){return b+a}}},aa={Dagger:{tags:[0,8],weight:13,price:100,ATK:30},ShortSword:{tags:[0,8],weight:15,price:100,ATK:40},
LongSword:{tags:[0,8],weight:16,price:100,ATK:50},Katana:{tags:[0,8],weight:15,price:100,ATK:45},Axe:{tags:[0,8,9],weight:18,price:100,ATK:45},Mace:{tags:[0,9],weight:16,price:100,ATK:40},Spear:{tags:[0,10],weight:20,price:100,ATK:50},Halberd:{tags:[0,8,9,10],weight:30,price:100,ATK:50},ShortBow:{tags:[2,10],weight:18,price:100,ATK:30},LongBow:{tags:[2,10],weight:20,price:100,ATK:40},Staff:{tags:[0,9,11],weight:20,price:100,ATK:20},Wand:{tags:[11],weight:16,price:100,ATK:25},FirstAidKit:{tags:[12],
weight:10,price:100,ATK:10},Buckler:{tags:[3],weight:20,price:100,ATK:10,DEF:10},RoundShield:{tags:[3],weight:25,price:100,ATK:15,DEF:15},SpikedShield:{tags:[3],weight:30,price:100,ATK:30,DEF:15},KiteShield:{tags:[3],weight:35,price:100,ATK:20,DEF:20},TowerShield:{tags:[3],weight:40,price:100,ATK:30,DEF:20},Circlet:{tags:[4],weight:5,price:100,DEF:2},LeatherHood:{tags:[4],weight:10,price:100,DEF:4},Mask:{tags:[4],weight:15,price:100,DEF:6},Sallet:{tags:[4],weight:20,price:100,DEF:8},Bascinet:{tags:[4],
weight:25,price:100,DEF:10},Helmet:{tags:[4],weight:30,price:100,DEF:12},Robe:{tags:[5],weight:20,price:100,DEF:10},LetherArmor:{tags:[5],weight:25,price:100,DEF:15},ScaleArmor:{tags:[5],weight:30,price:100,DEF:20},Chainmail:{tags:[5],weight:35,price:100,DEF:22},LamellarArmor:{tags:[5],weight:40,price:100,DEF:25},PlateArmor:{tags:[5],weight:45,price:100,DEF:30},Gloves:{tags:[6],weight:10,price:100,DEF:4},Mittens:{tags:[6],weight:20,price:100,DEF:6},Gauntlets:{tags:[6],weight:30,price:100,DEF:8},Slippers:{tags:[7],
weight:5,price:100,DEF:2},Sandals:{tags:[7],weight:10,price:100,DEF:4},Shoes:{tags:[7],weight:15,price:100,DEF:6},Boots:{tags:[7],weight:20,price:100,DEF:8},Greaves:{tags:[7],weight:25,price:100,DEF:10}},Pb={Dummy:{tags:[],cost:999,range:0,power:0,target:0,aciton:"Charge"},Swing:{tags:[0],cost:14,range:1,power:100,target:0,aciton:"Charge"},Slash:{tags:[0,8],cost:15,range:1,power:110,target:0,aciton:"Charge"},CutThrough:{tags:[0,8],cost:20,range:1,power:100,target:0,aciton:"GoBehind"},Sweep:{tags:[0,
8],cost:20,range:1,power:100,target:4,aciton:"Nova"},Crash:{tags:[0,9],cost:15,range:1,power:110,target:0,aciton:"Charge"},Bash:{tags:[0,9],cost:20,range:1,power:100,target:0,aciton:"Knockback"},Stab:{tags:[0,10],cost:15,range:1,power:110,target:0,aciton:"Charge"},Thrust:{tags:[0,10],cost:15,range:2,power:100,target:2,aciton:"Laser"},ShieldBash:{tags:[3],cost:20,range:1,power:100,target:0,aciton:"Charge"},ShieldCharge:{tags:[3],cost:24,range:1,power:100,target:0,aciton:"Trample"},Shoot:{tags:[2],
cost:20,range:3,power:100,target:0,aciton:"Shoot"},IceSpear:{tags:[11],cost:16,range:5,power:80,target:0,aciton:"Freeze"},DrainLife:{tags:[11],cost:16,range:5,power:80,target:0,aciton:"Drain"},FireBall:{tags:[11],cost:16,range:5,power:100,target:0,aciton:"Explode"},LightningLaser:{tags:[11],cost:16,range:5,power:100,target:2,aciton:"Laser"},FireNova:{tags:[11],cost:16,range:2,power:100,target:4,aciton:"Nova"},Heal:{tags:[11],cost:24,range:3,power:100,target:1,aciton:"Charge"},PartyHeal:{tags:[11],
cost:24,range:1,power:100,target:5,aciton:"Nova"},FirstAid:{tags:[12],cost:24,range:1,power:100,target:1,aciton:"Charge"}},Ha,Qb=wa([3,4,5,6,7]),ya=function(){function a(b){this.EID=b;this.def=Ob[this.EID];if(null==this.def)throw new RangeError('Enchantment not found: "'+this.EID+'"');this.name=a.nameOf(this.EID);this.spec=a.specOf(this.EID);this.value=this.def.min+Ba(this.def.max-this.def.min)}a.prototype.qualify=function(a){return Ca(this.name.localized,a)};a.prototype.modify=function(a){this.def.ATK&&
(a=this.def.ATK(this.value,a));return a};a.nameOf=function(a){return g("Enchant",a,"Name")};a.specOf=function(a){return g("Enchant",a,"Spec")};a.from=function(b){return new a(b)};a.fromJSON=function(b){return new a(b.EID)};a.prototype.toJSON=function(){return{EID:this.EID,value:this.value}};return a}(),ja=function(){function a(b,d){this.IID=b;this.enchants=d;this.def=aa[this.IID];if(null==this.def)throw new RangeError('Item not found: "'+this.IID+'"');this.baseName=a.nameOf(this.IID);this.spec=a.specOf(this.IID);
this.tagbits=wa(this.def.tags);null==this.enchants&&(this.enchants=(this.def.enchants||[]).map(ya.from))}Object.defineProperty(a.prototype,"name",{get:function(){for(var a=this.baseName.localized,d=0,e=this.enchants;d<e.length;d++)a=e[d].qualify(a);return a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"tags",{get:function(){return this.def.tags},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"weight",{get:function(){return this.def.weight},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"priceToSell",{get:function(){for(var a=this.def.price,d=0,e=this.enchants;d<e.length;d++)a=e[d].modify(a);return r(a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ATK",{get:function(){for(var a=this.def.ATK||0,d=0,e=this.enchants;d<e.length;d++)a=e[d].modify(a);return a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"DEF",{get:function(){for(var a=this.def.DEF||0,d=0,e=this.enchants;d<e.length;d++)a=e[d].modify(a);return a},
enumerable:!0,configurable:!0});a.nameOf=function(a){return g("Item",a,"Name")};a.specOf=function(a){return g("Item",a,"Spec")};a.from=function(b){return new a(b)};a.fromJSON=function(b){return new a(b.IID,T(ya,b.enchants))};a.prototype.toJSON=function(){return{IID:this.IID,enchants:oa(this.enchants)}};return a}(),Ya=function(){function a(b){this.SID=b;this.def=Pb[this.SID];if(null==this.def)throw new RangeError('Skill not found: "'+this.SID+'"');this.name=a.nameOf(this.SID);this.spec=a.specOf(this.SID);
this.tagbits=wa(this.def.tags)}Object.defineProperty(a.prototype,"tags",{get:function(){return this.def.tags},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"cost",{get:function(){return this.def.cost},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"range",{get:function(){return this.def.range},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"power",{get:function(){return this.def.power},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"target",{get:function(){return this.def.target},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hostile",{get:function(){var a;a:switch(this.def.target){case 1:case 3:case 5:a=!1;break a;default:a=!0}return a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"action",{get:function(){return this.def.aciton},enumerable:!0,configurable:!0});a.prototype.match=function(a){return(this.tagbits&a.tagbits)===this.tagbits};a.nameOf=function(a){return g("Skill",a,"Name")};
a.specOf=function(a){return g("Skill",a,"Spec")};a.from=function(b){return new a(b)};a.fromJSON=function(b){return new a(b.SID)};a.prototype.toJSON=function(){return{SID:this.SID}};a.DUMMY=new a("Dummy");return a}(),Ka=[1,2,3,4,5,5,5,5,4,3,2,1],Rb=Ka.reduce(function(a,b){return V(a,b)},0),Fb=function(){function a(a,d){this.src=a;this.back=new S(a+"/back.png");for(var e=[new S(a+"/eye.png")],c=1;c<=Rb;++c)e.push(new S(a+("/eye"+c+".png")));this.eyes=e;this.fore=new S(a+"/fore.png");this.cycle=4500+
100*d;this.offset=Ba(this.cycle)}Object.defineProperty(a.prototype,"w",{get:function(){return this.back.w},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"h",{get:function(){return this.back.h},enumerable:!0,configurable:!0});a.prototype.draw=function(a,d,e,c,f){this.back.draw(a,d,e,c,f);var g;g=(d+this.offset)%this.cycle;g=450>g?Ka[r(g/450*Ka.length)]:0;this.eyes[g].draw(a,d,e,c,f);this.fore.draw(a,d,e,c,f)};return a}(),Z=function(){function a(a,d,e,c,g,h,k,l){this.name=a;this.INT=
d;this.DEX=e;this.STR=c;this.equipments=g;this.skills=h;this.known=k;this.image=l}Object.defineProperty(a.prototype,"HP",{get:function(){return 10*(3+this.STR)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"SP",{get:function(){var a=V(0,this.weight-this.maxWeight);return V(0,4*(3+this.STR)-a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"step",{get:function(){return 13-this.DEX},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ZoC",{get:function(){return 3+
this.DEX},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxWeight",{get:function(){return 10*(3+this.STR)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"weight",{get:function(){return this.equipments.reduce(function(a,d){return a+d.weight},0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"DEF",{get:function(){return 100*(1-this.equipments.reduce(function(a,d){return a*(1-d.DEF/100)},1))},enumerable:!0,configurable:!0});a.prototype.costOf=
function(a){return null==a?void 0:a.cost-this.INT};a.prototype.rangeOf=function(a){return null==a?void 0:a.range};a.prototype.powerOf=function(a){var d=this.itemFor(a);return d?d.ATK*a.power/100:void 0};a.prototype.itemFor=function(a){var d=void 0;if(a)for(var e=0,c=0,g=this.equipments;c<g.length;c++){var h=g[c];if(a.match(h)){var k=h.ATK;e<k&&(e=k,d=h)}}return d};a.adventurer=function(b){var d=Nb[b];if(null==d)throw new RangeError('Adventurer not found: "'+b+'"');return a.from(g("Adventurer",b),
d)};a.monster=function(b){var d=Cb[b];if(null==d)throw new RangeError('Monster not found: "'+b+'"');return a.from(g("Monster",b),d)};a.from=function(b,d){return new a(b.localized,d.INT,d.DEX,d.STR,d.equipments.map(ja.from),d.skills.map(Ya.from),[],Ta(d.image,d.INT))};a.fromJSON=function(b){return new a(b.name,b.INT,b.DEX,b.STR,T(ja,b.equipments),T(Ya,b.skills),T(Ya,b.known),Ta(b.image,b.INT))};a.prototype.toJSON=function(){var a=this.name,d=this.INT,e=this.DEX,c=this.STR,g=oa(this.equipments),h=oa(this.skills),
k=oa(this.known),l;l=this.image.src;l=l.startsWith("assets/char/")?l.substr(12):l;return{name:a,INT:d,DEX:e,STR:c,equipments:g,skills:h,known:k,image:l}};return a}(),La;(function(a){var b=function(a){function b(){var c=this;a.call(this);(new G(0,0,1280,720,new S("assets/scene/title.jpg"))).attach(this);var f=rb(),h=function(a){(new ea(c,new Ma.Home(a))).attach(c.parent)},k,l;f?(k=g("Title","Continue"),l=function(){return h(f)},(new K(1070,650,200,60,new C(g("Title","Delete")),function(){Ia.confirm(c,
g("Title","ConfirmDelete"),{label:g("Title","Delete"),click:function(){try{System.setRoamingStorage("NYO",null)}catch(a){H.error(a)}(new ea(c,new b)).attach(c.parent);H.log(g("Title","NotifyDelete"))},mnemonic:hb},{label:g("Config","Cancel"),mnemonic:ib})})).attach(this)):(k=g("Title","New"),l=function(){var a={},b;for(b in aa){var c=Ba(4);0<c&&(a[b]=c)}a={shop:a,warehouse:[],reservers:[],party:[Z.adventurer("Knight"),Z.adventurer("Warrior"),Z.adventurer("Samurai"),Z.adventurer("Mage"),Z.adventurer("Healer"),
Z.adventurer("Thief")],gold:1E3};a.party[0].equipments[0].enchants.push(ya.from("AddedFire"));tb(a);h(a)});(new K(480,504,320,72,new C(k),l,Mb)).attach(this);(new K(480,612,320,72,new C(g("Title","Quit")),System.exit)).attach(this);bb(this)}q(b,a);return b}(Q);a.Scene=b})(La||(La={}));var Ma;(function(a){function b(){return[{name:g("Character","Name"),extract:function(a){return a.name},width:200},{name:g("Character","INT"),extract:function(a){return a.INT},width:60,align:"right"},{name:g("Character",
"DEX"),extract:function(a){return a.DEX},width:60,align:"right"},{name:g("Character","STR"),extract:function(a){return a.STR},width:60,align:"right"}]}function d(a){return[{name:a,extract:function(a){return a.name},width:200},{name:g("Town","Tags"),extract:function(a){return Ga(a.tags)}},{name:g("Town","Weight"),extract:function(a){return a.weight},width:60,align:"right"},{name:g("Town","ATK"),extract:function(a){return a.ATK},width:60,align:"right"},{name:g("Town","DEF"),extract:function(a){return a.DEF},
width:60,align:"right"}]}function e(a,b){var c=b.shop,e=d(a);e.push({name:g("Town","Stock"),extract:function(a){return ga(c[a.IID],g("Town","New"))},width:60,align:"right"});return e}function c(a,b){var c=b.shop,d=b.warehouse;return[{name:a,extract:function(a){return ja.nameOf(a)},width:200},{name:g("Town","Tags"),extract:function(a){return Ga(aa[a].tags)}},{name:g("Town","ATK"),extract:function(a){return aa[a].ATK},width:60,align:"right"},{name:g("Town","DEF"),extract:function(a){return aa[a].DEF},
width:60,align:"right"},{name:g("Town","Weight"),extract:function(a){return aa[a].weight},width:60,align:"right"},{name:g("Town","Stock"),extract:function(a){return c[a]},width:60,align:"right"},{name:g("Town","Owned"),extract:function(a){return d.reduce(function(b,c){return c.IID===a?b+1:b},0)},width:60,align:"right"}]}function f(a){return[{name:a,extract:function(a){return a.name.localized},width:200},{name:g("Town","Required"),extract:function(a){return Ga(a.tags)}},{name:g("Town","Cost"),extract:function(a){return a.cost},
width:60,align:"right"},{name:g("Town","Range"),extract:function(a){return a.range},width:60,align:"right"},{name:g("Town","Power"),extract:function(a){return a.power},width:60,align:"right"},{name:g("Town","Spec"),extract:function(a){return a.spec.localized}}]}var h={fontSize:64,fillStyle:B(255,255,255),strokeStyle:B(0,0,0),textAlign:"center",textBaseline:"middle",lineWidth:2},m=function(){function a(b,c){this.party=b;this.index=c}a.prototype.draw=function(a,b,c){var d=c.x,e=c.y,g=c.w;c=c.h;var f=
this.party[this.index];a.save();if(f){var l=Ea(f.image,140,184);f.image.draw(a,b,{x:d+g/2-l.w/2,y:e+92-l.h/2,w:l.w,h:l.h});var m=this.party.reduce(function(a,b){return b?V(a,b.HP):a},1);b=f.HP;var l=d+10,p=g-20,q=e+c-30,m=(p-2)*b/m;a.strokeStyle=k.BLACK;a.fillStyle=gb.full;a.fillRect(l,q,m,6);a.strokeRect(l,q,m,6);ia(a,b.toString(),l+4,q-20,p,20,{fontSize:20,fillStyle:B(255,255,255),strokeStyle:B(0,0,0),textAlign:"left",textBaseline:"bottom",lineWidth:2});ia(a,f.name,d,e+c-24,g,24,{fontSize:24,fillStyle:B(255,
255,255),strokeStyle:B(0,0,0),textAlign:"center",textBaseline:"bottom",lineWidth:2})}else ia(a,(this.index+1).toString(),d,e,g,c,h);a.restore()};return a}(),p=function(a){function b(c){a.call(this);this.data=c}q(b,a);b.prototype.addButton=function(a,b,c,d){a=new K(1280-170*a,665,160,45,new C(c),d,b);a.attach(this);return a};b.prototype.goTo=function(a){(new ea(this,new a(this.data))).attach(this.parent)};return b}(Q),w=function(a){function b(c,d){a.call(this,c);(new G(0,0,1280,720,new S("assets/scene/"+
d))).attach(this);bb(this);for(var e=c.party,g=this,f=[],h=0;6>h;++h){var k=r(h/3),l=r(h%3);(new yb(10+170*(1-k),10+214*l+68*k,160,204,f,new m(e,h),function(){g.onPortraitClick(this.drawable.index)},function(a){var b=this.drawable;a=a.drawable;c=[e[a.index],e[b.index]];e[b.index]=c[0];e[a.index]=c[1];c=[a.index,b.index];b.index=c[0];a.index=c[1];var c})).attach(this)}}q(b,a);return b}(p),F=function(a){function b(c){var d=this;a.call(this,c,"town.jpg");var e=["grass","moss"],f=Ba(e.length);this.addSpot(5,
l.G,"Guild",function(){}).enabled=!1;this.addSpot(4,l.P,"Pub",function(){return d.goTo(v)});this.addSpot(3,l.T,"Shop",function(){return d.goTo(I)});this.addSpot(2,l.S,"Smith",function(){}).enabled=!1;this.addSpot(1,l.D,"Dungeon",function(){(new ea(d,new za.Scene(c,new za.EndressStage(e[f])))).attach(d.parent)}).enabled=c.party.some(function(a){return null!=a});this.addButton(2,[l.L],g("Town","Load"),function(){Ia.confirm(d,g("Town","ConfirmLoad"),{label:g("Town","Load"),click:function(){var a=rb();
a&&((new ea(d,new b(a))).attach(d.parent),H.log(g("Town","NotifyLoad")))},mnemonic:hb},{label:g("Config","Cancel"),mnemonic:ib})});this.addButton(1,[l.S],g("Town","Save"),function(){tb(d.data);H.log(g("Town","NotifySave"))})}q(b,a);b.prototype.onPortraitClick=function(a){(a=this.data.party[a])&&(new ea(this,new U(this.data,a))).attach(this.parent)};b.prototype.addSpot=function(a,b,c,d){a=new K(950,665-100*a,320,90,new C(g("Town",c)),d,[b]);a.attach(this);return a};return b}(w);a.Home=F;var v=function(a){function c(d){function e(a,
b){(c=Array.prototype.splice).call.apply(c,[a,0,a.length].concat(b));var c}var f=this;a.call(this,d,"pub.jpg");var h=d.party.concat(),k=d.reservers.concat();this.addButton(3,[l.C],g("Town","Clear"),function(){for(var a=0;6>a;++a){var b=d.party[a];b&&(d.reservers.push(b),d.party[a]=null)}});this.addButton(2,[l.R],g("Town","Revert"),function(){e(d.party,h);e(d.reservers,k)});this.addButton(1,[l.TAB,l.DELETE],g("Town","Back"),function(){return f.goTo(F)});(new D(350,10,920,D.heightOf(10),b(),d.reservers,
function(a,b){return f.onReserverClick(a,b)})).attach(this)}q(c,a);c.prototype.onPortraitClick=function(a){var b=this.data.party[a];b&&(this.data.party[a]=null,this.data.reservers.push(b))};c.prototype.onReserverClick=function(a,b){for(var c=0;6>c;++c)if(null==this.data.party[c]){this.data.party[c]=a;this.data.reservers.splice(b,1);return}H.error(g("Town","PartyFull"))};return c}(w),I=function(a){function b(d){var f=this;a.call(this,d,"shop.jpg");var h=d.shop,k=d.warehouse,m=new D(350,10,920,D.heightOf(10),
c(g("Town","Buy"),d),Da(h),function(a){if(0>=h[a])H.error(g("Town","SoldOut"));else{var b=aa[a].price;if(d.gold<b)H.error(g("Town","NoMoney"));else{var c=new ja(a);--h[a];k.push(c);d.gold-=b;H.log(Ca(g("Town","NotifyBuy").localized,c.name,b))}}});m.attach(this);var p=new D(350,10,920,D.heightOf(10),e(g("Town","Sell"),d),k,function(a,b){var c=a.IID,e=a.priceToSell;k.splice(b,1);var f=h[c];null==f?(h[c]=1,m.rows.push(c)):h[c]=1+f;d.gold+=e;H.log(Ca(g("Town","NotifySell").localized,a.name,e))});p.attach(this);
var q,r;q=this.addButton(3,[l.B],g("Town","Buy"),function(){m.visible=!0;p.visible=!1;q.enabled=!1;r.enabled=!0});r=this.addButton(2,[l.S],g("Town","Sell"),function(){m.visible=!1;p.visible=!0;q.enabled=!0;r.enabled=!1});this.addButton(1,[l.TAB,l.DELETE],g("Town","Back"),function(){return f.goTo(F)});q.click()}q(b,a);b.prototype.onPortraitClick=function(a){H.log("Shop.onPortraitClick: "+a)};return b}(w),U=function(a){function b(c,e){var h=this;a.call(this,c);var k=c.warehouse,m=Ea(e.image,1280,720,
!0);(new G(0,0,m.w,m.h,e.image)).attach(this);(new G(0,0,200,40,new C(e.name))).attach(this);(new G(0,40,200,40,new C("INT: "+e.INT))).attach(this);(new G(100,40,200,40,new C("DEX: "+e.DEX))).attach(this);(new G(200,40,200,40,new C("STR: "+e.STR))).attach(this);(new G(0,80,200,40,new C(function(){return"HP: "+e.HP}))).attach(this);(new G(0,120,200,40,new C(function(){return"SP: "+e.SP}))).attach(this);(new G(0,160,200,40,new C(function(){return"WT: "+e.weight+"/"+e.maxWeight}))).attach(this);(new G(0,
200,200,40,new C(function(){return"DEF: "+e.DEF.toFixed(1)}))).attach(this);var q=new Q([new D(350,10,920,D.heightOf(10),d(g("Town","Equipments")),e.equipments,function(a,b){e.equipments.splice(b,1);k.push(a)}),new D(350,360,920,D.heightOf(10),d(g("Town","Warehouse")),k,function(a,b){k.splice(b,1);var c=e.equipments,d=a.tagbits,g=[],d=d&Qb;if(0!==d)for(var f=0;f<c.length;)0!==(c[f].tagbits&d)?(g.push(c[f]),c.splice(f,1)):++f;e.equipments.push(a);(h=k.push).call.apply(h,[k].concat(g));var h})]);q.attach(this);
var p=new Q([new D(350,10,920,D.heightOf(10),f(g("Town","Skills")),e.skills,function(a,b){e.skills.splice(b,1);e.known.push(a)}),new D(350,360,920,D.heightOf(10),f(g("Town","Knowns")),e.known,function(a,b){e.known.splice(b,1);e.skills.push(a)})]);p.attach(this);var r,v;r=this.addButton(3,[l.E],g("Town","Equipments"),function(){q.visible=!0;p.visible=!1;v.enabled=!0;r.enabled=!1});v=this.addButton(2,[l.S],g("Town","Skills"),function(){q.visible=!1;p.visible=!0;v.enabled=!1;r.enabled=!0});this.addButton(1,
[l.TAB,l.DELETE],g("Town","Back"),function(){return h.goTo(F)});r.click()}q(b,a);return b}(p)})(Ma||(Ma={}));var za;(function(a){function b(a,b){var n=a.xH;return{xH:n+[1,2,1,-1,-2,-1][b],yH:a.yH+(0===n%2?[-1,0,0,0,0,-1]:[0,0,1,1,0,0])[b]}}function d(a,b){var n=a.xH,c=b.xH,u=c-n,n=2*b.yH+c%2-(2*a.yH+n%2);return 0>n?n>u?(-u-n)/2:n>-u?(u-n)/2:-n:n<u?(u+n)/2:n<-u?(-u+n)/2:n}function e(a,b){return a===b||!!a&&!!b&&a.xH===b.xH&&a.yH===b.yH}function c(a,b,n,c,u,d,e,g,f){var h=F(0,1,d/e);d=null==g?h:F(0,
1,(d+g)/e);a.save();a.fillStyle=f.bkgnd;a.fillRect(b,n,c,u);b+=1;n+=1;c-=2;u-=2;d>h?(a.fillStyle=1<=h?f.full:f.normal,a.fillRect(b,n,c*h-1,u),a.fillStyle=f.full,a.fillRect(b+c*h,n,c*(d-h),u)):d<h?(e=c*d,0<d&&(e=V(e,2),a.fillStyle=1<=h?f.full:f.normal,a.fillRect(b,n,e-1,u)),a.fillStyle=f.delta,a.fillRect(b+e,n,c*(h-d),u)):(a.fillStyle=1<=h?f.full:f.normal,a.fillRect(b,n,c*h,u));a.restore()}function f(a,b,n,A,u){b=n.toX(u)+16;n=n.toY(u)+60;c(a,b,n,96,6,A.HP,A.maxHP,null,gb)}function h(a,b,n,A,u,d){b=
n.toX(u)+16;n=n.toY(u)+60+6;c(a,b,n,96,6,A.SP,A.maxSP,d-A.SP,Bb)}function y(a,b,n,c,u,d){var e=0,e=1===a.team?e+10*(u-b):e+10*(b-c);a=2*n+b%2;e=3>a?e+10*a:e+10*(5-a);b<d&&(e*=.1);return e}function p(a,b,n){var c=void 0,u=d(b,n)+1;a.straight(b,n,u,function(b,n){n===u&&a.get(b).empty&&(c=b)});return c}function D(a,b,n,c,u){var d=a.toX(b)-a.toX(n),e=a.toY(b)-a.toY(n),d=100+Va(d*d+e*e,.5)/1280*400,d=new I(d,function(d,e){var f=a.toX(b),g=a.toY(b),h=a.toX(n),M=a.toY(n);Sa(e,f*(1-d)+h*d+64-20,g*(1-d)+M*
d+40-20,40,40,c,u,.5)});d.attach(a);return d}function N(a,b,n,c,u,d){b=D(a,b.hex,n.hex,u,d);b.then(function(){c.attach(a)});return m.wait.POPUP?c:b}function v(a,b,n,c,d,e){function f(n,c){var d=g.get(n).unit;if(b.isTarget(d)){var A=b.trySkill(d);e&&(A=e(A,c));d=a.prepareEffect(d,A);d.attach(a);h.push(d)}}var g=a.field,h=[];f(n,0);g.surround(n,c,f);var kb=new I(400,function(b,e){var z=a.toX(n)+64,f=a.toY(n)+40,g=128*c*b,h=80*c*b,M=(new k(d.r,d.g,d.b,d.a*(1-b))).rgba,Za=(new k(d.r,d.g,d.b,0)).rgba;
Sa(e,z-g,f-h,2*g,2*h,M,Za,b)});kb.attach(a);return m.wait.POPUP?(h.push(kb),new Xa(h)):kb}var P=w(0,0,0,0),U=w(0,0,0,.75),J={inner:new k(.9,1,.7),outer:new k(.2,.9,.2)},O={inner:new k(.9,.7,1),outer:new k(.2,.2,.9)},T={inner:new k(1,.7,.9),outer:new k(.9,.2,.2)},R={inner:new k(.9,.7,1),outer:new k(.2,.2,.9)},aa={outer:new k(.25,.75,1),inner:new k(.7,.9,1),bkgnd:new k(.25,.75,1,.3)},ca={outer:new k(1,.75,.25),inner:new k(1,.9,.75),bkgnd:new k(1,.75,.25,.3)},ia={DASH_OR_RANGE:{outer:new k(1,.25,.25),
inner:new k(1,.7,.7),bkgnd:new k(1,.75,.25,.3)},RANGE:{outer:new k(1,.25,.25),inner:new k(1,.7,.7),bkgnd:new k(1,.5,.25,.3)},TARGET:{outer:new k(1,.1,.1),inner:new k(1,.25,.25),bkgnd:new k(1,.1,.1,.3)}},ja={DASH_OR_RANGE:{outer:new k(.25,.25,1),inner:new k(.7,.7,1),bkgnd:new k(1,.75,.25,.3)},RANGE:{outer:new k(.25,.25,1),inner:new k(.7,.7,1),bkgnd:new k(.25,.5,1,.3)},TARGET:{outer:new k(.1,.1,1),inner:new k(.25,.25,1),bkgnd:new k(.1,.1,1,.3)}},ma=new k(1,1,0,.5),Ja=new k(1,0,0,.5),oa=new k(0,0,1,
.5),ra=w(0,0,0,.65),ua=w(0,0,0,0),va={textAlign:"center",textBaseline:"bottom",fontSize:32,fillStyle:"yellow",strokeStyle:"black",lineWidth:2},za={textAlign:"center",textBaseline:"bottom",fontSize:32,fillStyle:"red",strokeStyle:"black",lineWidth:2},pa=w(255,0,0,.8),Ca=new k(1,.7,.7),Fa=new k(.7,1,.7),Ga=[{messageID:"PartyTurn",bkgnd:k.NAVY,textStyle:{fontSize:64,fillStyle:"white",textAlign:"center",textBaseline:"middle"}},{messageID:"EnemyTurn",bkgnd:k.MAROON,textStyle:{fontSize:64,fillStyle:"white",
textAlign:"center",textBaseline:"middle"}}],Na=function(){function a(b,n){this.dummy=n;this.cells={};this.depth=r(b)}Object.defineProperty(a.prototype,"minXH",{get:function(){return 1+eb(this.depth)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxXH",{get:function(){return 20+r(this.depth)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"minVisibleXH",{get:function(){return r(this.depth)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxVisibleXH",
{get:function(){return 21+eb(this.depth)},enumerable:!0,configurable:!0});a.prototype.contains=function(a,b){if(null==a)return!1;var c;null==b?(d=a,c=d.xH,b=d.yH,d):c=a;return 0<=b&&3>b&&this.minXH<=c&&c<this.maxXH;var d};a.prototype.getLine=function(a){return this.cells[a]};a.prototype.setLine=function(a,b){this.cells[a]=b};a.prototype.deleteLine=function(a){delete this.cells[a]};a.prototype.rawget=function(a,b){var c;null==b?(d=a,c=d.xH,b=d.yH,d):c=a;return 0<=b&&3>b&&this.minVisibleXH<=c&&c<this.maxVisibleXH&&
(c=this.cells[c])?c[b]:null;var d};a.prototype.get=function(a,b){var c;null==b?(d=a,c=d.xH,b=d.yH,d):c=a;c=this.rawget(c,b);return ga(c,this.dummy);var d};a.prototype.set=function(a,b,c){null==c&&(d=b,b=d.xH,c=d.yH,d);d=this.cells[b];null==d&&(d=this.cells[b]=[]);d[c]=a;var d};a.prototype.each=function(a){for(var b=this.maxXH,c=this.minXH;c<b;++c)for(var d=0;3>d;++d)a.call(this,this.get(c,d),c,d)};a.prototype.eachVisible=function(a){for(var b=this.maxVisibleXH,c=this.minVisibleXH;c<b;++c)for(var d=
0;3>d;++d)a.call(this,this.get(c,d),c,d)};a.prototype.straight=function(a,b,c,u){if(!e(a,b)){var f=a.xH,g=1+2*(2*a.yH+a.xH%2),h=b.xH,t=1+2*(2*b.yH+b.xH%2);a=d(a,b);h=(h-f)/a;t=(t-g)/a;for(a=1;a<=c;++a){var k=f+a*h,ba=r((g+a*t)/2);b=void 0;b=0===ba%2?2*r((k+1)/2):2*r(k/2)+1;k=r(ba/2);this.contains(b,k)&&u({xH:b,yH:k},a)}}};a.prototype.surround=function(a,c,d){if(1===c)for(var e=0;6>e;++e){var f=b(a,e);this.contains(f)&&d(f,1)}else if(1<c){a=b(a,0);for(var g=1;g<=c;++g){for(var f=a,h=0,t=[2,3,4,5,0,
1];h<t.length;h++)for(var e=t[h],k=0;k<g;++k,f=b(f,e))this.contains(f)&&d(f,g);a=b(a,0)}}};return a}(),fa=function(){function a(b){this.duration=b}a.prototype.then=function(a){null==this.duration?W.then(a):this.sig=sa(this.sig,a);return this};a.prototype.commit=function(){ta(this.sig);this.duration=this.sig=void 0};a.prototype.getXY=function(a,b,c){if(null!=this.duration)if(c=I.clamp(c,this.start,this.duration),1<=c)this.commit();else return this.onGetXY(a,b,c)};a.prototype.drawCharacter=function(a,
b,c,d,e,f){a.drawCharacter(b,c,d,e,f)};return a}(),Ha=function(a){function b(c){a.call(this,400*(13-c)/4)}q(b,a);b.prototype.onGetXY=function(a,b,c){a=a.hex;return{x:b.toX(a)-128*(1-c)+64,y:b.toY(a)+80}};return b}(fa),Aa=function(a){function b(c){a.call(this,100*Va(c.length-1,.75));this.path=c}q(b,a);b.prototype.onGetXY=function(a,b,c){var d=this.path.length-1,e=r(d*c),f=this.path[e],g=this.path[e+1];a=b.toX(f);var f=b.toY(f),h=b.toX(g);b=b.toY(g);c=d*c-e;return{x:a*(1-c)+h*c+64,y:f*(1-c)+b*c+80}};
return b}(fa),wa=function(a){function b(c,d,e){a.call(this,function(a,b,c){var n=a.toX(b)-a.toX(c);a=a.toY(b)-a.toY(c);return 200+Va(n*n+a*a,.3)/1280*1E3}(c,d,e));this.hexFrom=d;this.hexTo=e}q(b,a);b.prototype.hit=function(a){null==this.duration?W.then(a):this.hitsig=sa(this.hitsig,a)};b.prototype.commit=function(){ta(this.hitsig);this.hitsig=void 0;a.prototype.commit.call(this)};b.prototype.onGetXY=function(a,b,c){var d=this.hexFrom,e=this.hexTo;a=b.toX(d);var d=b.toY(d),f=b.toX(e);b=b.toY(e);.5>
c?c*=2:(c=2-2*c,ta(this.hitsig),this.hitsig=null);return{x:a*(1-c)+f*c+64,y:d*(1-c)+b*c+80}};return b}(fa),xa=function(a){function b(c,d){a.call(this,500);var e=c.HP;this.dying=d>=e?c.hex:null;this.radius=d>=e/2?1:.5+d/e}q(b,a);b.prototype.onGetXY=function(a,b,c){var d=20*(1-c)*this.radius;c=c*Y*this.duration/250*this.radius;a=this.dying||a.hex;return{x:d*X(4*c)+b.toX(a)+64,y:d*X(3*c)+b.toY(a)+80}};b.prototype.drawCharacter=function(b,c,d,e,f,g){this.dying?(g=I.clamp(d,this.start,this.duration),c.save(),
c.globalAlpha=1-g,a.prototype.drawCharacter.call(this,b,c,d,e,f,new k(1,0,0,g)),c.restore()):a.prototype.drawCharacter.call(this,b,c,d,e,f,g)};return b}(fa),na=function(){function a(b,c,d){this.ch=b;this.team=c;this.hex=d;this.idleOffset=Oa();this.HP=this.maxHP;this.SP=this.maxSP;this.skill=b.skills.find(function(a){return null!=b.powerOf(a)})||Ya.DUMMY}a.prototype.toString=function(){return"Unit(name="+this.name+", hex="+this.hex+")"};Object.defineProperty(a.prototype,"name",{get:function(){return this.ch.name},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxHP",{get:function(){return this.ch.HP},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxSP",{get:function(){return this.ch.SP},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"step",{get:function(){return this.ch.step},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ZoC",{get:function(){return this.ch.ZoC},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"DEF",{get:function(){return this.ch.DEF},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"cost",{get:function(){return this.ch.costOf(this.skill)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"range",{get:function(){return this.ch.rangeOf(this.skill)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ATK",{get:function(){return this.ch.powerOf(this.skill)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"minCost",{get:function(){var a=
this;return this.ch.skills.reduce(function(b,c){var d=a.ch.costOf(c);return d<b?d:b},this.maxSP)},enumerable:!0,configurable:!0});a.prototype.isEnemy=function(a){return null!=a&&this.team!==a.team};a.prototype.isTarget=function(a){return null==a?!1:this.skill.hostile?this.isEnemy(a):this!==a&&!this.isEnemy(a)};a.prototype.canTarget=function(a,b){return this.SP>=this.cost&&this.isTarget(a.get(b).unit)&&d(this.hex,b)<=this.range};a.prototype.done=function(a){a=a.zoc;if(!a)return!1;var b=this.hex;return b&&
this.SP<this.minCost&&this.SP<this.step+a[this.team].get(b)};a.prototype.trySkill=function(a){return this.isTarget(a)?this.skill.hostile?-eb(this.ATK*(100-a.DEF)/100):this.ATK:null};a.prototype.shoot=function(a,b){var c=$a[this.skill.action](a,this,b);this.SP-=this.cost;return c};a.prototype.onTurnEnd=function(a){this.team===a.team&&(this.SP=this.maxSP)};a.prototype.onTurnStart=function(a){};a.prototype.getXY=function(a,b){var c;this.state&&(c=this.state.getXY(this,a,b),null==c&&(this.state=null));
if(null==c){var d=this.hex;d&&(c={x:a.toX(d)+64,y:a.toY(d)+80})}return c};Object.defineProperty(a.prototype,"state",{get:function(){return this._state},set:function(a){var b=this._state;if(this._state=a)a.start=performance.now();b&&b.commit()},enumerable:!0,configurable:!0});a.prototype.drawCharacter=function(a,b,c,d,e){var f=this.ch.image,g=Ea(f,128,128),h=g.w,k=.2*h;Sa(a,c-h/2,d-10-k/2,h,k,ra,ua,.75);b&&(h=200*(12-this.ch.DEX),h=V(0,X(2*Y*(this.idleOffset+b%h/h))),d-=16*h+10*(1-h));g.x=c-g.w/2;
g.y=d-g.h;f.draw(a,b,g,e?e.rgb:null,e?e.a:null)};a.prototype.draw=function(a,b,c,d,e){this.state?this.state.drawCharacter(this,a,b,c,d,e):this.drawCharacter(a,b,c,d,e)};a.prototype.drawBars=function(a,b,d,e,f){var g=this.hex;b=d.toX(g)+16;d=d.toY(g)+60;c(a,b,d,96,6,this.HP,this.maxHP,e,gb);c(a,b,d+6,96,6,this.SP,this.maxSP,f,Bb)};a.compare=function(a,b){return a.y<b.y?-1:a.y>b.y?1:a.x<b.x?-1:a.x>b.x?1:0};return a}(),ya=function(){function a(b,c){void 0===b&&(b=0);this.type=b;this.unit=c}Object.defineProperty(a.prototype,
"empty",{get:function(){return null==this.unit&&0===this.type},enumerable:!0,configurable:!0});a.DUMMY=new a(1);return a}(),Ka=function(a){function c(d,f,g){function h(a,b,c,d){var n=this,f=b.range;if(1<=f){var g=b.hex,A=a.field;a=a.numScrollsPerTurn;var u=this.get(d),M=c.get(d),k=db(2*d.yH+d.xH%2-3),t=A.minXH+a,Za=d.xH<t,z=function(a){var b=n.get(a);if(u.SP>b.SP)return!0;if(u.SP<b.SP)return!1;b=a.xH<t;if(!Za&&b)return!0;if(Za&&!b)return!1;b=c.get(a);return M<b?!0:M>b?!1:d.xH<a.xH?!0:d.xH>a.xH?!1:
k<db(2*a.yH+a.xH%2-3)};A.surround(d,f,function(a){if(!e(a,g)){var c=A.rawget(a);a=n.ensure(a);if(null==a.shotFrom||z(a.shotFrom))a.shotFrom=d,null==a.deltaHP&&(a.deltaHP=b.trySkill(c.unit))}})}}var k=this,jb=d.field;a.call(this,jb.depth,c.DUMMY);var t=f.step,l=f.cost,L=f.hex,lb=f.SP;this.ensure(L).SP=lb;if(lb>=t+g.get(L)){L=[L];do{var E=L.shift(),x=this.get(E).SP,m=t+g.get(E);if(x>=m)for(x-=m,m=0;6>m;++m){var q=b(E,m),p=jb.rawget(q);p&&0===p.type&&!f.isEnemy(p.unit)&&(p=this.ensure(q),p.SP<x&&(p.SP=
x,p.comeFrom=E,x>=t+g.get(q)&&L.push(q)))}}while(0<L.length)}lb>=l&&(this.each(function(a,b,c){a.SP>=l&&jb.rawget(b,c).empty&&h.call(k,d,f,g,{xH:b,yH:c})}),h.call(this,d,f,g,f.hex))}q(c,a);c.prototype.ensure=function(a){var b=this.rawget(a);null==b&&(b={SP:-1},this.set(b,a));return b};c.prototype.getPath=function(a,b){var c=this.get(a),d=c.comeFrom,e=c.shotFrom,f;if(null!=c.deltaHP){if(!b.get(e).empty)return null;f=[e];c=this.get(e);d=c.comeFrom;c}else if(d){if(!b.get(a).empty)return null;f=[a]}for(;d;)f.unshift(d),
c=this.get(d),d=c.comeFrom,c;return f};c.DUMMY={SP:-1};return c}(Na),La=function(a){function b(c,d,e,f,g,h){var k=this;a.call(this,d,e,f,g,h,new C(function(){var a=k.focus;if(a){var b=a.ch.skills[k.index];if(b){var c=a.skill===b,d=a.ch.costOf(b),n=a.ch.rangeOf(b),a=a.ch.powerOf(b);return""+(c?"E ":"")+b.name.localized+"\n"+d+" / "+n+" / "+(0<a?a.toFixed(1):"-")}}},b.textStyle),function(){var a=this.focus;if(a){var b=a.ch.skills[this.index];b&&0<a.ch.powerOf(b)&&(a.skill=b,c.onSkillChanged(a))}},function(a){var b=
this.focus;b&&(c=[b.ch.skills[a.index],b.ch.skills[this.index]],b.ch.skills[this.index]=c[0],b.ch.skills[a.index]=c[1],b=[a.index,this.index],this.index=b[0],a.index=b[1]);var c});this.scene=c;this.index=h.length-1}q(b,a);Object.defineProperty(b.prototype,"visible",{get:function(){return null!=this.skill},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"enabled",{get:function(){var a=this.focus;return a?null!=a.ch.powerOf(a.ch.skills[this.index]):null},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"focus",{get:function(){return this.scene.focus},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"skill",{get:function(){var a=this.focus;return a?a.ch.skills[this.index]:null},enumerable:!0,configurable:!0});b.textStyle={fontSize:20};return b}(yb),fa=function(){function a(b,c){void 0===c&&(c=2);this.numScrollsPerTurn=c;var d="assets/"+("level/"+b+"/");this.imgSky=new S(d+"sky.png");this.imgCells=[new S(d+"tile.png"),new S(d+"hole.png")]}a.prototype.generate=
function(a,b){var c=0,d=0;a.each(function(a){(a=a.unit)&&(0===a.team?++c:++d)});for(var e=0===c?.3:.3*Va(1.1,c-d),f=Array(3),g=Da(Cb),h=0;3>h;++h){var k=void 0,l=0;12<b&&Oa()<e?(k=g[Ba(g.length)],k=Z.monster(k),k=new na(k,1,{xH:b,yH:h})):6<b&&.1>Oa()&&(l=1);f[h]=new ya(l,k)}return f};a.prototype.draw=function(a,b,c){var d=this,e=c.field;a.save();var f=128*e.depth/2;a.fillStyle=this.imgSky.createPattern(a,"repeat");a.translate(-f,0);a.fillRect(0+f,0,1280,80);a.restore();var g={x:0,y:0,w:128,h:80};
e.eachVisible(function(e,f,h){e=e.type;g.x=c.toX(f,h);g.y=c.toY(f,h);d.imgCells[e].draw(a,b,g)})};return a}();a.EndressStage=fa;fa=function(a){function b(c,d){function e(a,b){return new K(10+110*a,570,100,140,{draw:function(a,c,d){var e=d.x,n=d.y,f=Ea(b.ch.image,d.w,d.h,!0),h=f.w,f=f.h,e=e+(d.w-h)/2,n=n+(d.h-f)/2;b.ch.image.draw(a,c,{x:e,y:n,w:h,h:f})}},function(){return k.click(b.hex)},[l.$1+a])}function f(a,b,c,d){a=new K(1280-150*a,570,140,140,new C(b),c);d&&qa(a,"enabled",d);return a}var h=this;
a.call(this);this.data=c;this.stage=d;this.team=0;this.enabled=!1;var k=new Pa;k.attach(this);k.visible=!1;var t=new Ta;t.attach(this);t.visible=!1;for(var z=c.party,L=new Na(0,ya.DUMMY),m=L.minVisibleXH,t=L.maxVisibleXH;m<t;++m)L.setLine(m,this.stage.generate(L,m));for(var t=[],E=[[2,0],[2,1],[2,2],[1,0],[1,1],[1,2]],x=0,p=E.length;x<p;++x){var q=z[x];if(q){var v=E[x],m=v[0],m=new na(q,0,{xH:m,yH:v[1]});m.state=new Ha(q.DEX);L.rawget(m.hex).unit=m;t.push(e(x,m))}}this.field=L;this.dying=[];this.snapshots=
[];this.startTurn();x=new da;x.onDraw=function(a,b){return h.drawUnits(a,b,h.focusTime)};x.attach(this);x=new Q;qa(x,"visible",function(){return k.visible&&null==h.focus});x.attach(this);f(1,g("Combat","End"),function(){return h.endTurn()}).attach(x);f(2,g("Combat","Undo"),function(){return k.undo()},function(){return k.canUndo}).attach(x);f(3,g("Combat","Retire"),function(){return h.retire()}).attach(x);t=new Q(t);qa(t,"visible",function(){return 0===h.team&&null==h.focus});t.attach(this);x=new da;
x.onDraw=function(a,b){return h.drawBarsOnIdle(a,b)};x.attach(t);t=new Q;qa(t,"visible",function(){return h.controller.visible&&null!=h.focus});t.attach(this);x=new da;x.onDraw=function(a,b){return h.drawBarsOnFocus(a,b,h.focus,h.controller.caret)};x.attach(t);var mb=new la(0,560,1280,160);mb.onDraw=function(a,b){return h.drawPanel(a,b,h.focus,mb)};mb.attach(t);t=new Q;qa(t,"visible",function(){return k.visible&&null!=h.focus});t.attach(this);z=[];for(x=0;6>x;++x)(new La(this,400+170*r(x/2),570+x%
2*75,160,65,z)).attach(t);var y=function(){var a=h.mapFor(h.focus);if(a){var b=h.controller.caret;if(b&&null!=a.get(b).deltaHP)return L.get(b).unit}return null},t=new Q;qa(t,"visible",function(){return null!=y()});t.attach(this);var w=new la(640,560,640,160);w.onDraw=function(a,b){return h.drawPanel(a,b,y(),w)};w.attach(t);t=System.canvas.getContext("2d");x=t.createLinearGradient(0,0,128,0);x.addColorStop(0,U);x.addColorStop(1,P);(new G(0,0,128,560,new cb({fillStyle:x}))).attach(this);t=t.createLinearGradient(1152,
0,1280,0);t.addColorStop(0,P);t.addColorStop(1,U);(new G(1152,0,1280,560,new cb({fillStyle:t}))).attach(this);bb(this)}q(b,a);Object.defineProperty(b.prototype,"controller",{get:function(){return this.children[this.team]},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"numScrollsPerTurn",{get:function(){return this.stage.numScrollsPerTurn},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"focus",{get:function(){return this._focus},set:function(a){null==a?(this._focus=
null,this.focusTime=void 0):this._focus!==a&&(this._focus=a,this.focusTime=performance.now())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"zoc",{get:function(){if(this.enabled){var a=this._zoc;if(!a){var a=this.field.depth,b=[new Na(a,0),new Na(a,0)];this.eachUnit(function(a){var c=a.ZoC;if(0<c){var d=b[0===a.team?1:0];d.surround(a.hex,1,function(a){return d.set(d.get(a)+c,a)})}});this._zoc=a=b}return a}},enumerable:!0,configurable:!0});b.prototype.mapFor=function(a){if(a&&
this.enabled){var b=this.zoc,c=this.maps;c||(this.maps=c=new Na(this.field.depth));var d=a.hex,e=c.rawget(d);null==e&&(e=new Ka(this,a,b[a.team]),c.set(e,d));return e}};b.prototype.onSkillChanged=function(a){var b=this.maps,c=this.snapshots;b&&b.set(void 0,a.hex);if(c)for(b=0;b<c.length;b++){var d=c[b];d.unit===a&&d.maps.set(void 0,d.hex)}};b.prototype.savepoint=function(a){this.snapshots.push({unit:a,hex:a.hex,SP:a.SP,maps:this.maps,zoc:this.zoc})};b.prototype.rollback=function(){var a=this.snapshots.pop(),
b=a.unit;this.setUnit(b,a.hex);b.SP=a.SP;this._zoc=a.zoc;this.maps=a.maps;this.focus=b};b.prototype.setUnit=function(a,b){var c=this.field,d=c.rawget(b);if(null==d)throw Error("Cannot set unit at "+b+": out of range");var e=d.unit;if(a){if(e===a)return;if(e)throw Error("Cannot set unit at "+b+": already exists");a.hex&&(c.rawget(a.hex).unit=null);a.hex=b}else e&&(e.hex=null);d.unit=a;this.invalidate()};b.prototype.invalidate=function(){this.maps=this.zoc=void 0};b.prototype.startTurn=function(){var a=
this;this.eachUnit(function(b){b.onTurnStart(a)});this.enabled=!0;this.controller.visible=!0};b.prototype.retire=function(){var a=this;Ia.confirm(this,g("Combat","ConfirmRetire"),{label:g("Combat","Retire"),click:function(){a.controller.visible=!1;(new ea(a,new Ma.Home(a.data))).attach(a.parent)},mnemonic:hb},{label:g("Config","Cancel"),mnemonic:ib})};b.prototype.endTurn=function(){var a=this;this.enabled=!1;this.snapshots.length=0;this.controller.visible=!1;this.eachUnit(function(b){b.onTurnEnd(a)});
if(0===this.team){var b=this.numScrollsPerTurn;if(0<b){var c=this.field.minXH+b;this.eachUnit(function(b){b.hex.xH<c&&(b.state=new xa(b,b.HP),a.kill(b))});var d=this.field.depth;(new I(400*b,function(c){a.scrollTo(d+b*c)})).attach(this);if(this.isGameOver)return}}this.team=0===this.team?1:0;var e=Ga[this.team],f=e.bkgnd,h=f.rgba,l=(new k(f.r,f.g,f.b,0)).rgba,m=e.textStyle,z=g("Combat",e.messageID);(new I(800,function(a,b){b.save();b.globalAlpha=X(Y*a);Sa(b,0,0,1280,560,h,l);Ra(b,z.localized,640,280,
m);b.restore()})).then(function(){a.startTurn()}).attach(this)};b.prototype.move=function(a,b){var c=this;Wa(!e(b,a.hex));var d=function(){c.enabled=!0;a.done(c)&&(c.focus=null)};this.focus=a;var f=this.field,h=this.mapFor(a),g=h.get(b);if(null!=g.deltaHP){this.enabled=!1;g=function(){c.snapshots.length=0;c.invalidate();return a.shoot(c,b).then(d)};if(a.canTarget(f,b))return g();var f=h.getPath(b,f),k=f[f.length-1];Wa(!e(k,b));Wa(!e(k,a.hex));this.setUnit(a,k);a.SP=h.get(k).SP;h=a.state=new Aa(f);
g=ab(g);h.then(g);return g}Wa(0<=g.SP&&f.rawget(b).empty);f=h.getPath(b,f);this.setUnit(a,b);a.SP=g.SP;h=a.state=new Aa(f);d();return m.wait.WALK?h:W};b.prototype.findUnit=function(a,b,c){var d=this.field,e=d.minXH,f=d.maxXH,h=(0===this.team?b:!b)?1:-1;b=b?1:-1;var g,k;a?(g=a.xH,k=a.yH,a):(g=0>h?e:f-1,k=0>b?0:2);a=1;for(var l=3*(f-e+1);a<l;++a){k+=b;if(0>k||3<=k)k=0>k?2:0,g+=h,g<e?g=f-1:f<=g&&(g=e);var E=d.rawget(g,k).unit;if(E&&c(E))return E}return null};b.prototype.kill=function(a){var b=this;a.HP=
0;this.setUnit(null,a.hex);this.dying.push(a);0===a.team&&this.parent&&this.isGameOver&&(this.controller.visible=!1,(a.state||W).then(function(){Ia.confirm(b,g("Combat","GameOver"),{label:g("Combat","Retire"),click:function(){(new ea(b,new Ma.Home(b.data))).attach(b.parent)},mnemonic:qb})}))};Object.defineProperty(b.prototype,"isGameOver",{get:function(){return null==this.findUnit(null,!0,function(a){return 0===a.team})},enumerable:!0,configurable:!0});b.prototype.createPopup=function(a,b,c){var d=
this.toX(c)+64,e=this.toY(c)+80;c=new I(600);c.onAnimation=function(c,f){Ra(f,a,d,e-40*c,{fontSize:48,fillStyle:b,strokeStyle:k.BLACK,globalAlpha:X(Y*c),lineWidth:4,textAlign:"center",textBaseline:"bottom"})};return c};b.prototype.prepareEffect=function(a,b,c,d){var e=this,f=db(b).toString(),g=this.createPopup(f,0<b?Fa:Ca,d||a.hex),h=g.attach;g.attach=function(d){if(0>b||0>c)a.state=new xa(a,-b);d=h.call(g,d);a.HP=F(0,a.maxHP,a.HP+b);null!=c&&(a.SP=F(0,a.maxSP,a.SP+c));0>=a.HP&&e.kill(a);return d};
return g};b.prototype.eachUnit=function(a){var b=this;this.field.eachVisible(function(c){(c=c.unit)&&a.call(b,c)})};b.prototype.toX=function(a,b){var c;null==b?(d=a,c=d.xH,d):c=a;return 0+64*(c-1-this.field.depth);var d};b.prototype.toY=function(a,b){var c;null==b?(d=a,c=d.xH,b=d.yH,d):c=a;return 80+80*(2*b+c%2);var d};b.prototype.toHex=function(a,b){var c=this.field,d=a-0+128*c.depth/2,e=r((b-0-80)/80);if(0<=e&&6>e){var f=void 0,f=0===e%2?2*r((d+64)/128):2*r(d/128)+1;if(c.minXH<=f&&f<c.maxXH)return c=
r(e/2),{xH:f,yH:c}}return null};b.prototype.scrollTo=function(a){var b=this.field;if(a>b.depth){var c=b.minVisibleXH,d=b.maxVisibleXH;b.depth=a;a=b.minVisibleXH;for(var e=b.maxVisibleXH;c<a;++c)b.deleteLine(c);for(c=V(a,d);c<e;++c)b.setLine(c,this.stage.generate(b,c))}};b.prototype.onDraw=function(b,c){this.stage.draw(b,c,this);var d=this.focus,e=this.mapFor(d);e&&this.drawMarkers(b,c,this.focusTime,e,d);a.prototype.onDraw.call(this,b,c)};b.prototype.drawMarkers=function(a,b,c,d,e){var f=this,g=I.clamp(b,
c,300);if(!(0>=g)){var h=e.cost;b=e.skill.hostile?ia:ja;var k=b.DASH_OR_RANGE,l=b.RANGE,E=b.TARGET;a.save();1>g&&(a.globalAlpha=g);d.eachVisible(function(b,c,d){var e=b.SP,u=b.shotFrom,A,M=0,m=0;null!=b.deltaHP?(A=E,M=32*(1-g),m=20*(1-g)):e>=h?A=aa:0<=e?A=u?k:ca:u&&(A=l);A&&(b=f.toX(c,d)-M,c=f.toY(c,d)-m,M=128+2*M,m=80+2*m,a.fillStyle=A.bkgnd,a.fillRect(b+5,c+5,M-10,m-10),a.strokeStyle=A.outer,a.lineWidth=2,a.strokeRect(b+2,c+2,M-4,m-4),a.strokeStyle=A.inner,a.lineWidth=1,a.strokeRect(b+4,c+4,M-8,
m-8))});a.restore()}};b.prototype.drawUnits=function(a,b,c){function d(a,b,c,e){if(null==a)return null;if(null==c)return a;b=I.cycle(b,c,e);b=(1-ka(2*Y*b))/2;return 0>=b?null:1<=b?a:new k(a.r,a.g,a.b,a.a*b)}var e=this,f=this.zoc,h=this.focus,l=[];this.eachUnit(function(a){var c=a.getXY(e,b);c.unit=a;l.push(c)});for(var m=0;m<this.dying.length;){var z=this.dying[m],E=z.getXY(this,b);E?(E.unit=z,l.push(E),++m):this.dying.splice(m,1)}l.sort(na.compare);for(var m=g("Combat","Done").localized,x,ba,p,E=
this.mapFor(h),q=0;q<l.length;q++){var r=l[q],z=r.unit,v=r.x,r=r.y,w=void 0;if(E)if(h===z)w=x=x?x:d(ma,b,c,1E3);else{var y=z.hex;y&&(y=E.get(y).deltaHP,0>y?w=ba=ba?ba:d(Ja,b,c,1E3):0<y&&(w=p=p?p:d(oa,b,c,1E3)))}z.draw(a,b,v,r,w);if(null==z.state&&f){var y=z.hex,w=z.SP,B=z.step,C=z.cost,z=z.team;y&&w<C&&(w<B?Ra(a,m,v,r,va):w<B+f[z].get(y)&&Ra(a,m,v,r,za))}}};b.prototype.drawBarsOnIdle=function(a,b){var c=this;this.eachUnit(function(d){return d.drawBars(a,b,c)})};b.prototype.drawBarsOnFocus=function(a,
b,c,d){var g=this,k=this.mapFor(c);if(k){var l=this.field;k.each(function(c,d,e){c=c.deltaHP;null!=c&&l.get(d,e).unit.drawBars(a,b,g,c)});if(d){var m=k.get(d);null!=m.deltaHP?(d=m.shotFrom,e(d,c.hex)?c.drawBars(a,b,this,null,-c.cost):(f(a,b,this,c,c.hex),h(a,b,this,c,d,k.get(d).SP-c.cost))):0<m.SP&&l.get(d).empty?(f(a,b,this,c,c.hex),h(a,b,this,c,d,m.SP)):c.drawBars(a,b,this)}else c.drawBars(a,b,this)}};b.prototype.drawPanel=function(a,b,c,d){if(c){a.save();switch(c.team){case 0:a.fillStyle="#000044";
a.strokeStyle="#CCCCFF";break;case 1:a.fillStyle="#440000";a.strokeStyle="#FFCCCC";break;default:a.fillStyle="#004400",a.strokeStyle="#CCFFCC"}a.fillRect(d.x,d.y,d.w,d.h);a.strokeRect(d.x,d.y,d.w,d.h);a.restore();var e=d.x,f=d.y,g=Ea(c.ch.image,128,128,!0),h=g.w,g=g.h,f=f+(d.h-g)/2;c.ch.image.draw(a,b,{x:e+(128-h)/2,y:f,w:h,h:g});a.save();a.fillStyle="#FFFFFF";a.textAlign="left";a.textBaseline="top";a.fillText(c.name,d.x+128,d.y+10);a.fillText("HP: "+c.HP+" / "+c.maxHP,d.x+128,d.y+10+30);b=c.SP>=
c.cost?r((c.SP-c.cost)/c.step):"-";a.fillText("SP: "+c.SP+" / "+c.maxSP,d.x+128,d.y+10+60);a.fillText("MOVE: "+b+"/"+r(c.SP/c.step),d.x+128,d.y+10+90);a.fillText("ATK/DEF: "+function(a){return null!=a?a.toFixed(1):"-"}(c.ATK)+" / "+c.DEF.toFixed(1),d.x+128,d.y+10+120);a.restore()}};return b}(Q);a.Scene=fa;var Pa=function(a){function c(){a.call(this);this._mode=0}q(c,a);Object.defineProperty(c.prototype,"mode",{get:function(){0!==this._mode&&null==this.parent.focus&&(this._mode=0);return this._mode},
set:function(a){this._mode=a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"caret",{get:function(){return 1<=this.mode?this._caret:null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"canUndo",{get:function(){return 0<this.parent.snapshots.length||1<=this.mode},enumerable:!0,configurable:!0});c.prototype.undo=function(){var a=this.parent;0<a.snapshots.length?(a.rollback(),this.moveCaretTo(this._caret)):1<=this.mode?(this.mode=0,this.moveCaretTo(this._caret)):
H.error(g("Combat","CannotUndo"))};c.prototype.moveCaretTo=function(a){this._caret=a;if(0===this.mode){var b=this.parent;b.focus=a?b.field.get(a).unit:null}};c.prototype.onHover=function(a,b){this.moveCaretTo(this.parent.toHex(a,b))};c.prototype.onDrag=function(a,b){this.moveCaretTo(this.parent.toHex(a,b))};c.prototype.downCaret=function(a){if(this._caret=a){var b;a:{b=this.parent;var c=this.mode,d=b.focus;if(d){if(d.team===b.team&&!d.done(b)){b=1===c&&e(a,d.hex)?3:2;break a}}else if(a=b.field.get(a).unit,
b.focus=a){b=2;break a}b=0}this.mode=b}};c.prototype.onDown=function(a,b){this.downCaret(this.parent.toHex(a,b))};c.prototype.upCaret=function(a){function b(a,c,d){if(2>c)return c;var f=a.focus;if(null==f||a.team!=f.team)return 0;if(e(d,f.hex))return 2===c?1:0;if(!a.enabled)return c;c=a.mapFor(f).get(d);if(null==c.deltaHP)if(0<=c.SP&&a.field.rawget(d).empty)a.savepoint(f);else return a.focus=null,0;a.move(f,d);return a.focus?1:0}if(this._caret=a)this.mode=b(this.parent,this.mode,a)};c.prototype.onUp=
function(a,b){this.upCaret(this.parent.toHex(a,b))};c.prototype.onPress=function(a){function c(a){var d=this.parent.field,e=this._caret;e?(a=b(e,a),d.contains(a)&&this.moveCaretTo(a)):this.moveCaretTo({xH:d.minXH,yH:0})}function d(a){var b=this.parent,c=this._caret,e=b.team,f=b.focus;(a=b.findUnit(f?f.hex:c,a,function(a){return a.team===e&&!a.done(b)}))?(b.focus=a,null==c&&(this.caret=a.hex),0===this._mode&&(this.mode=1)):H.error(g("Combat","UnitNotAvailable"))}switch(a){case l.TAB:case l.DELETE:case l.Q:this.undo();
break;case l.PAGE_DOWN:case l.C:d.call(this,!0);break;case l.PAGE_UP:d.call(this,!1);break;case l.SPACE:case l.ENTER:this.click(this._caret);break;case l.E:c.call(this,0);break;case l.RIGHT:case l.D:c.call(this,1);break;case l.DOWN:case l.X:case l.S:c.call(this,2);break;case l.Z:c.call(this,3);break;case l.LEFT:case l.A:c.call(this,4);break;case l.UP:case l.W:c.call(this,5)}};c.prototype.click=function(a){this.parent.field.contains(a)&&(this.downCaret(a),this.upCaret(a))};c.prototype.onDraw=function(a,
b){function c(a,b,d,e){var f=b.toX(d)+6.5;b=b.toY(d)+6.5;a.save();a.lineCap="round";a.lineJoin="round";a.beginPath();a.moveTo(f+32,b);a.lineTo(f,b);a.lineTo(f,b+20);a.moveTo(f+115-32,b);a.lineTo(f+115,b);a.lineTo(f+115,b+20);a.moveTo(f+115-32,b+67);a.lineTo(f+115,b+67);a.lineTo(f+115,b+67-20);a.moveTo(f+32,b+67);a.lineTo(f,b+67);a.lineTo(f,b+67-20);a.lineWidth=7;a.strokeStyle=e.outer;a.stroke();a.lineWidth=3;a.strokeStyle=e.inner;a.stroke();a.restore()}function d(a,b,c){a.save();a.lineCap="butt";
a.lineJoin="round";var e=c[c.length-2],f=c[c.length-1],g=b.toX(e)+64,h=b.toY(e)+40,e=b.toX(f)+64,f=b.toY(f)+40,g=wb(f-h,e-g);a.beginPath();a.moveTo(e+20*ka(g),f+20*X(g));a.lineTo(e+20*ka(g+2*Y/3),f+20*X(g+2*Y/3));a.lineTo(e+20*ka(g-2*Y/3),f+20*X(g-2*Y/3));a.fillStyle=pa;a.fill();a.beginPath();a.moveTo(e-10*ka(g),f-10*X(g));for(g=c.length-2;0<=g;--g)e=c[g],a.lineTo(b.toX(e)+64,b.toY(e)+40);a.strokeStyle=pa;a.lineWidth=12;a.stroke();a.restore()}var e=this._caret;if(e){var f=this.parent,g=f.focus,h=
f.field;if(0===this.mode)c(a,f,e,J);else if(g){var k=f.mapFor(g);if(k){var l=k.get(e);(k=k.getPath(e,h))&&2<=k.length&&d(a,f,k);if(null!=l.deltaHP)switch(g=g.skill,g.target){case 0:c(a,f,e,T);break;case 1:c(a,f,e,R);break;case 2:h.straight(l.shotFrom,e,g.range,function(b){return c(a,f,b,T)});break;case 3:h.straight(l.shotFrom,e,g.range,function(b){return c(a,f,b,R)});break;case 4:h.surround(l.shotFrom,g.range,function(b){return c(a,f,b,T)});break;case 5:h.surround(l.shotFrom,g.range,function(b){return c(a,
f,b,R)})}else 0<=l.SP?c(a,f,e,O):c(a,f,e,J)}}}};return c}(da),Ta=function(a){function b(){a.apply(this,arguments);this.running=!1}q(b,a);Object.defineProperty(b.prototype,"visible",{get:function(){return this.running},set:function(a){var b=this;(this.running=a)&&W.then(function(){return b.run([])})},enumerable:!0,configurable:!0});b.prototype.run=function(a){function b(a,c){var d=a.focus;if(d)return d;var e=a.team,d=c.length,d=0<d?a.findUnit(c[d-1].hex,!1,function(b){return b.team===e&&!b.done(a)&&
0>c.indexOf(b)}):a.findUnit(null,!1,function(b){return b.team===e&&!b.done(a)});return a.focus=d}function c(a,b,d){var f=a.field,g=a.numScrollsPerTurn,h=a.mapFor(b),k=f.minXH,l=f.maxXH,n=b.maxSP,z=b.hex,u=b.cost,A=k+g,p=z,q=y(b,z.xH,z.yH,k,l,A)+40*b.SP/n;h.each(function(a,c,d){var e=a.SP,g=a.deltaHP;a=a.shotFrom;var m;if(null!=g){e=m=y(b,a.xH,a.yH,k,l,A);m=400;var z=f.rawget(c,d).unit,t=-z.trySkill(b),z=z.HP,g=-g,ba=b.maxHP;0<t&&0<g&&(m=z<=g?m+600*V(1,t/ba):m+600*V(1,t/ba)*V(1,g/z));m=e+m;e=h.get(a).SP-
u}else if(0<=e&&f.rawget(c,d).empty)m=y(b,c,d,k,l,A);else return;m+=40*e/n;q<m&&(q=m,p={xH:c,yH:d})});if(e(p,z))return d.push(b),a.focus=null;d.length=0;this.caret=p;d=m.wait.PICK;return 0<d?(g=ab(function(){return a.move(b,p)}),(new I(d)).then(g).attach(a),g):a.move(b,p)}for(var d=this,f=this.parent,g=null;this.running;){f.enabled||(g=W);if(g){g.then(function(){return d.run(a)});break}this.caret=null;g=b(f,a);if(null==g){f.endTurn();break}g=c.call(this,f,g,a)}};return b}(da),$a={Charge:function(a,
b,c){c=a.field.get(c).unit;var d=b.trySkill(c),e=a.prepareEffect(c,d);c=new wa(a,b.hex,c.hex);b.state=c;c.hit(function(){e.attach(a)});return m.wait.POPUP?new Xa([e,c]):c},Knockback:function(a,b,c){var d=a.field,e=p(d,b.hex,c);if(null==e)return $a.Charge(a,b,c);var f=d.get(c).unit,d=b.trySkill(f),g=a.prepareEffect(f,d,null,e),d=new wa(a,b.hex,f.hex),h=new Aa([c,e]);b.state=d;d.hit(function(){a.setUnit(f,e);f.state=h});h.then(function(){g.attach(a)});return m.wait.POPUP?new Xa([g,d]):d},GoBehind:function(a,
b,c){var d=a.field,e=p(d,b.hex,c);if(null==e)return $a.Charge(a,b,c);var f=b.hex,d=d.get(c).unit,g=b.trySkill(d),h=a.prepareEffect(d,g);c=new Aa([f,c]);a.setUnit(b,e);b.state=c;c.then(function(){h.attach(a)});return m.wait.POPUP?h:c},Trample:function(a,b,c){var d=a.field,e=p(d,b.hex,c);if(null==e)return $a.Charge(a,b,c);var f=b.hex,d=d.get(c).unit,g=b.trySkill(d),h=a.prepareEffect(d,g,null,e),f=new Aa([f,c]),g=new Aa([c,c,e]);a.setUnit(d,e);d.state=g;a.setUnit(b,c);b.state=f;g.then(function(){h.attach(a)});
return m.wait.POPUP?h:g},Shoot:function(a,b,c){c=a.field.get(c).unit;var d=b.trySkill(c);return N(a,b,c,a.prepareEffect(c,d),B(255,128,0),w(255,128,0,0))},Freeze:function(a,b,c){c=a.field.get(c).unit;var d=b.trySkill(c),e=r(d/2);return N(a,b,c,a.prepareEffect(c,d,e),B(0,128,255),w(0,128,255,0))},Drain:function(a,b,c){var d=a.field.get(c).unit,e=b.trySkill(d);c=a.prepareEffect(d,e);var f=a.prepareEffect(b,-e);b=D(a,d.hex,b.hex,B(255,0,128),w(255,0,128,0));b.then(function(){f.attach(a)});c.attach(a);
return m.wait.POPUP?f:b},Explode:function(a,b,c){var d=a.field.get(c).unit;b.trySkill(d);var d=D(a,b.hex,d.hex,B(255,128,0),w(255,128,0,0)),e=ab(function(){return v(a,b,c,1,new k(1,.5,0),function(a,b){return r(a/(1+b))})});d.then(e);return e},Laser:function(a,b,c){var d=a.field,e=b.hex,f,g=[];d.straight(e,c,b.skill.range,function(c){var e=d.get(c).unit;if(b.isTarget(e)){var h=b.trySkill(e),e=a.prepareEffect(e,h);e.attach(a);g.push(e)}f=c});c=new I(400,function(b,c){var d=a.toX(e)+64,g=a.toY(e)+40,
h=a.toX(f)+64,l=a.toY(f)+40,m=wb(l-g,h-d),n=64*ka(m),m=40*X(m);c.save();c.beginPath();c.moveTo(d+n,g+m);c.lineTo(h+n,l+m);c.lineCap="round";c.lineWidth=80*b/4;c.strokeStyle=(new k(1,.5,0,1-b)).rgba;c.stroke();c.restore()});c.attach(a);return m.wait.POPUP?(g.push(c),new Xa(g)):c},Nova:function(a,b,c){return v(a,b,b.hex,b.skill.range,new k(1,.5,0))}}})(za||(za={}));var xa,m=new (function(){function a(){this._refineCanvas=this._magnifyCanvas=!1;this.volume=new Ab(50,0,100);this.effects=new Ab(na.length-
1,0,na.length-1)}Object.defineProperty(a.prototype,"magnifyCanvas",{get:function(){return this._magnifyCanvas},set:function(a){this._magnifyCanvas!=a&&(this._magnifyCanvas=a,window.dispatchEvent(new UIEvent("resize")))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"refineCanvas",{get:function(){return this._refineCanvas},set:function(a){this._refineCanvas!=a&&(this._refineCanvas=a,window.dispatchEvent(new UIEvent("resize")))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"wait",{get:function(){return na[this.effects.value]},enumerable:!0,configurable:!0});return a}());System.main=function(a,b){var d=new Image;d.src="assets/dummy.png";S.DUMMY=d;var d=new Q,e=new Q;e.attach(d);var c=new Lb(10,10,1260,700,2E3,Jb);c.attach(d);H=c;xa=function(){for(;;){var a=e.children,b=a.length;if(0===b)break;a[b-1].detach()}(new xb(new La.Scene)).attach(e)};Ib();xa();Eb(a,d,m)};System.checkpoint=function(){vb()}})();
