(function(){function Ab(){}function ea(a,b,d){return d<a?a:d>b?b:d}function oa(a,b){return null!=a?a:b}function Ba(a){return u($a()*a)}function pa(a){return null==a?[]:a.map(function(a){return null!=a?a.toJSON():null})}function R(a,b){return null==b?[]:b.map(function(b){return null!=b?a.Xb(b):null})}function Ca(a){return void 0===a?"(undefined)":null===a?"(null)":a.toString()}function Da(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];return a.replace(/\$\{(\d+)\}/g,function(a,d){return Ca(b[parseInt(d,
10)])})}function Ea(a,b,d){Object.defineProperty(a,b,{enumerable:!0,configurable:!0,writable:!0,value:d})}function qa(a,b,d){Object.defineProperty(a,b,{enumerable:!0,configurable:!0,get:d,set:void 0})}function Bb(a,b){var d=document.createElement("script");d.src=a;d.onerror=b;document.head.appendChild(d)}function ra(a,b){if(a===b)return 0;if(void 0===a&&void 0!==b)return-1;if(void 0!==a&&void 0===b)return 1;if(null===a&&null!==b)return-1;if(null!==a&&null===b)return 1;var d=typeof a,e=typeof b;if(d!==
e)return d<e?-1:1;if("object"===d){if(a instanceof Date&&b instanceof Date)return ra(a.getTime(),b.getTime());if(a instanceof Array&&b instanceof Array){a:{for(var d=a.length,e=b.length,c=0,f=S(d,e);c<f;++c){var h=ra(a[c],b[c]);if(0!==h){d=h;break a}}d=d<e?-1:d>e?1:0}return d}if(a.dh===Object&&b.constructor===Object){a:{for(var d=Fa(a).sort(),e=Fa(b).sort(),c=d.length,f=e.length,h=S(c,f),z=0;z<h;++z){var g=d[z],r=e[z];if(g<r||g>r){d=-1;break a}g=ra(a[g],b[r]);if(0!==g){d=g;break a}}d=c<f?-1:c>f?1:
0}return d}throw new TypeError("Cannot compare: ("+a+") and ("+b+")");}return a<b?-1:a>b?1:0}function Z(a,b){return(a||24)+"px "+(b||"Arial")}function fa(a,b){if(null==a)return b;if("function"===typeof a)return[a,b];a.push(b);return a}function ga(a){if(null!=a)if("function"===typeof a)L.then(a);else for(var b=0;b<a.length;b++)L.then(a[b])}function sa(a){for(var b,d=a.length,e=0;e<a.length;e++)a[e].then(function(){0>=--d&&(ga(b),b=void 0)});return{then:function(a){0<d?b=fa(b,a):L.then(a);return this}}}
function ib(a){function b(){a().then(function(){ga(d);d=void 0;a=null})}var d;b.then=function(b){a?d=fa(d,b):L.then(b);return this};return b}function g(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return new M(a)}function Cb(a,b,d){function e(b){return(null==b.pageX?b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-a.offsetLeft:b.pageX-a.offsetLeft)*k/a.offsetWidth}function c(b){return(null==b.pageY?b.clientY+document.body.scrollTop+document.documentElement.scrollTop-
a.offsetTop:b.pageY-a.offsetTop)*q/a.offsetHeight}function f(a){a.buttons&1?b.Qa(e(a),c(a)):b.qb(e(a),c(a));a.preventDefault()}function h(a){switch(a.button){case 0:b.Pa(e(a),c(a))}a.preventDefault()}function g(a){switch(a.button){case 0:b.Ma(e(a),c(a));break;case 2:b.bb(l.tb)}a.preventDefault()}function hb(){null!=n&&clearTimeout(n);n=setTimeout(function(){n=void 0;var b=a.parentElement,e=b.clientWidth,b=b.clientHeight,b=b-a.offsetTop;0<b&&(d.Ya||(e=S(e,k),b=S(b,q)),e*q>k*b?e=ta(b*k/q):b=ta(e*q/
k),0<e&&0<b&&(a.style.width=e+"px",a.style.height=b+"px",!d.eb&&(e>k||b>q)&&(e=k,b=q),a.width!==e||a.height!==b))&&(a.width=e,a.height=b)},300)}function r(d){L.finish();var e=a.width,c=a.height,f=a.getContext("2d");f.clearRect(0,0,e,c);f.save();f.font=Z();e===k&&c===q||f.scale(e/k,c/q);b.ma(f,d);f.restore();window.requestAnimationFrame(r)}var k=a.width,q=a.height;a.addEventListener("mousemove",f);a.addEventListener("touchmove",f);a.addEventListener("mousedown",h);a.addEventListener("touchstart",h);
a.addEventListener("mouseup",g);a.addEventListener("touchend",g);a.addEventListener("contextmenu",function(a){a.preventDefault()});a.addEventListener("mousewheel",function(a){b.bb(0<a.wheelDelta?l.Vc:l.Uc);a.preventDefault()});window.addEventListener("keydown",function(a){if(!a.ctrlKey&&!a.altKey){var d=oa(a.keyCode,a.charCode);d&&l[d]&&(b.bb(d),a.preventDefault())}});var n;window.addEventListener("resize",hb);"complete"===document.readyState?hb():window.addEventListener("load",hb);window.requestAnimationFrame(r)}
function Ga(a,b,d,e){void 0===e&&(e=!1);var c=a.i;a=a.l;if(c>b||a>d||e){e=c/b;var f=a/d;e>f?(c=b,a/=e):(c/=f,a=d)}return{i:c,l:a}}function Ha(a,b){if(b)for(var d in b)switch(d){case "fontSize":a.font=Z(b.fontSize,b.fontFamily);break;case "fontFamily":null==b.fontSize&&(a.font=Z(null,b.fontFamily));break;default:a[d]=b[d]}}function Ia(a,b,d,e,c,f){var h;null==e?(f=b,b=f.x,h=f.y,e=f.i,c=f.l,f,f=d):h=d;if(0<e&&0<c){a.save();Ha(a,f);f&&!f.fillStyle||a.fillRect(b,h,e,c);if(!f||f.strokeStyle)d=a.lineWidth-
1,a.strokeRect(b+d/2,h+d/2,e-d,c-d);a.restore()}}function Ja(a,b,d,e,c){function f(a,b,d,e,c){c&&!c.strokeStyle||a.strokeText(b,d,e);c&&!c.fillStyle||a.fillText(b,d,e)}a.save();Ha(a,c);if(0>b.indexOf("\n"))f(a,b,d,e,c);else{var h=b.split("\n");b=1.2*(c&&c.fontSize||24);switch(a.textBaseline){case "top":for(var g=0;g<h.length;g++){var k=h[g];f(a,k,d,e,c);e+=b}break;case "middle":e-=b*(h.length-1)/2;for(g=0;g<h.length;g++)k=h[g],f(a,k,d,e,c),e+=b;break;case "bottom":for(g=0,h=h.reverse();g<h.length;g++)k=
h[g],f(a,k,d,e,c),e-=b}}a.restore()}function ua(a,b,d,e,c,f,h){a.save();Ha(a,h);switch(a.textAlign){case "center":d+=c/2;break;case "right":d+=c;break}if(0>b.indexOf("\n")){switch(a.textBaseline){case "middle":e+=f/2;break;case "bottom":e+=f;break}h&&!h.strokeStyle||a.strokeText(b,d,e,c);h&&!h.fillStyle||a.fillText(b,d,e,c)}else{b=b.split("\n");var g=1.2*(h&&h.fontSize||24);switch(a.textBaseline){case "middle":e+=(f-g*(b.length-1))/2;break;case "bottom":e=e+f-g*(b.length-1);break}for(f=0;f<b.length;f++){var k=
a,r=b[f],l=d,q=e,n=c,ab=h;ab&&!ab.strokeStyle||k.strokeText(r,l,q,n);ab&&!ab.fillStyle||k.fillText(r,l,q,n);e+=g}}a.restore()}function jb(a,b,d,e,c,f,h){a=a.createLinearGradient(b,d,e,c);a.addColorStop(0,f);a.addColorStop(1,h);return a}function va(a,b,d,e,c,f,h){0<e&&0<c&&(a.save(),a.fillStyle=jb(a,b,d,b,d+c,f,h),a.fillRect(b,d,e,c),a.restore())}function bb(a,b,d,e,c,f,h,g){void 0===g&&(g=0);0<e&&0<c&&(a.save(),a.translate(b+e/2,d+c/2),a.scale(e,c),b=a.createRadialGradient(0,0,g/2,0,0,.5),b.addColorStop(0,
f),b.addColorStop(1,h),a.fillStyle=b,a.fillRect(-.5,-.5,1,1),a.restore())}function k(a,b,d){return"rgb("+a+","+b+","+d+")"}function w(a,b,d,e){e=e.toFixed(6).replace(/([0-9]+(\.[0-9]+[1-9])?)(\.?0+$)/,"$1");return"rgba("+a+","+b+","+d+","+e+")"}function Ka(a,b){return null==b?k(a.r,a.ob,a.ib):w(a.r,a.ob,a.ib,b)}function cb(a){null==wa&&(wa=[g("Tag","Melee"),g("Tag","Throw"),g("Tag","Shoot"),g("Tag","Magic"),g("Tag","Alchemy"),g("Tag","Slash"),g("Tag","Blunt"),g("Tag","Pierce"),g("Tag","Shield"),g("Tag",
"Head"),g("Tag","Body"),g("Tag","Arms"),g("Tag","Legs"),g("Tag","Fire"),g("Tag","Cold"),g("Tag","Lightning"),g("Tag","Life")]);return a.map(function(a){return wa[a].ta}).join(", ")}function xa(a){for(var b=0,d=0;d<a.length;d++)b|=1<<a[d];return b}function kb(a){var b={fillStyle:"white",strokeStyle:"black",fontSize:44,textAlign:"center",textBaseline:"middle"},d={textAlign:"right",textBaseline:"middle"},e={textAlign:"right",textBaseline:"middle"};(new K(4,4,32,32,new I("assets/config.png"),function(){function c(a,
b){var e=100+70*a;(new H(640,e,160,60,new B(b,d))).a(z);return e}function f(a,b,d){a=c(a,b);(new Db(810,a+15,300,30,d)).a(z);(new H(1120,a,50,60,new B(d,e))).a(z)}function h(a,b,d,e,f,h){a=c(a,b);var g=new K(810,a+0,100,60,new B(function(){var a=f();g.Da&&g.sa&&(a=!a);return(a?d:e).ta}),h);g.a(z)}var z=new La;(new H(0,0,1280,720,new lb(Ma))).a(z);(new H(0,20,1280,80,new B(g("Config","Caption"),b))).a(z);(new K(480,495,320,90,new B(g("Config","OK")),function(){z.detach()},tb)).a(z);var k=Fa(M.languages).sort().map(function(a){return g("Language",
a)}),r=new E(10,10,160,E.Xa(S(10,k.length)),[{name:g("Config","LanguageID"),ba:function(a){return a.src[1]},width:40,align:"center"},{name:g("Config","LanguageName"),ba:function(a){return a.ta}}],k,function(a){r.selected=a;M.language=a.src[1]});r.selected=r.rows.find(function(a){return a.src[1]===M.language});r.a(z);f(0,g("Config","Volume"),p.volume);f(1,g("Config","CPUEffects"),p.nb);var k=g("Config","On"),l=g("Config","Off");h(2,g("Config","FullScreen"),k,l,function(){return System.ke()},function(){System.ph(!System.ke())});
h(3,g("Config","MagnifyCanvas"),k,l,function(){return p.Ya},function(){p.Ya=!p.Ya});h(4,g("Config","RefineCanvas"),k,l,function(){return p.eb},function(){p.eb=!p.eb});(function(a,b,d){a=new K(810,70*a+100,300,60,new B(b),d);a.a(z);return a})(5,g("Config","BackToTitle"),function(){z.detach();Na()});z.a(a)},Eb,new K.Pd("white"))).a(a)}function Oa(){try{var a=System.ih("NYO");if(!a)return null;var b=Pa(a);return{Lb:b.Lb,Qb:R(aa,b.Qb),fb:R(X,b.fb),ra:R(X,b.ra),pb:b.pb}}catch(d){return F.error(d),null}}
function Qa(a){try{System.Pe("NYO",Ra(a))}catch(b){F.error(b)}db()}function Fb(){try{var a=System.hh("NYO");if(a){var b=Pa(a);b&&(a=function(a,b){return typeof a===typeof b?b:a},M.language=a(M.language,b.language),p.Ya=a(p.Ya,b.Ya),p.eb=a(p.eb,b.eb),p.volume.value=a(p.volume.value,b.volume),p.nb.value=a(p.nb.value,b.nb))}}catch(d){F.error(d)}}function db(){try{System.qh("NYO",Ra({language:M.language,Ya:p.Ya,eb:p.eb,volume:p.volume.value,nb:p.nb.value}))}catch(a){F.error(a)}}var x=this&&this.Zg||function(a,
b){function d(){this.constructor=a}for(var e in b)b.hasOwnProperty(e)&&(a[e]=b[e]);a.prototype=null===b?Object.create(b):(d.prototype=b.prototype,new d)},Fa=Object.keys,mb=Math.abs,S=Math.min,U=Math.max,u=Math.floor,Sa=Math.ceil,ta=Math.round,ia=Math.pow,V=Math.sin,ja=Math.cos,ub=Math.atan2,W=Math.PI,$a=Math.random,Pa=JSON.parse,Ra=JSON.stringify,L={ua:null,then:function(a){this.ua=fa(this.ua,a);return this},finish:function(){var a=this.ua;if(a)if(this.ua=null,"function"===typeof a)a();else for(var b=
0;b<a.length;b++)(0,a[b])()}},M=function(){function a(a){this.src=a}Object.defineProperty(a.prototype,"localized",{get:function(){function b(b){var d=a.languages,f=a.language,h=d[f];null==h&&(f=a.language=a.ie,h=d[f]);if("string"===typeof h)return d[f]=!0,Bb(h,function(){d[f]=!1}),null;if(!0===h)return null;if(!1===h)return b.join(".");for(var g=h,h=0,k=b.length;h<k;++h)if(g=g[b[h]],null==g)return b.join(".");return g.toString()}if(this.Sd!==a.language){var d=b(this.src);if(null===d)return this.src.join(".");
this.Sd=a.language;this.Td=d}return this.Td},enumerable:!0,configurable:!0});a.prototype.toString=function(){return this.ta};a.language=(window.navigator.rh||window.navigator.language||window.navigator.browserLanguage).substr(0,2);a.ie="en";a.languages={};return a}();System.lh=function(a,b){M.languages[a]=b};var l;(function(a){a[a.TAB=9]="TAB";a[a.ENTER=13]="ENTER";a[a.ESCAPE=27]="ESCAPE";a[a.SPACE=32]="SPACE";a[a.PAGE_UP=33]="PAGE_UP";a[a.PAGE_DOWN=34]="PAGE_DOWN";a[a._END=35]="_END";a[a._HOME=36]=
"_HOME";a[a.LEFT=37]="LEFT";a[a.UP=38]="UP";a[a.RIGHT=39]="RIGHT";a[a.DOWN=40]="DOWN";a[a._INSERT=45]="_INSERT";a[a.DELETE=46]="DELETE";a[a.$0=48]="$0";a[a.$1=49]="$1";a[a.$2=50]="$2";a[a.$3=51]="$3";a[a.$4=52]="$4";a[a.$5=53]="$5";a[a.$6=54]="$6";a[a.$7=55]="$7";a[a.$8=56]="$8";a[a.$9=57]="$9";a[a.A=65]="A";a[a.B=66]="B";a[a.C=67]="C";a[a.D=68]="D";a[a.E=69]="E";a[a.F=70]="F";a[a.G=71]="G";a[a.H=72]="H";a[a.I=73]="I";a[a.J=74]="J";a[a.K=75]="K";a[a.L=76]="L";a[a.M=77]="M";a[a.N=78]="N";a[a.O=79]=
"O";a[a.P=80]="P";a[a.Q=81]="Q";a[a.R=82]="R";a[a.S=83]="S";a[a.T=84]="T";a[a.U=85]="U";a[a.V=86]="V";a[a.W=87]="W";a[a.X=88]="X";a[a.Y=89]="Y";a[a.Z=90]="Z"})(l||(l={}));var ba=function(){function a(){}a.prototype.qb=function(){};a.prototype.Qa=function(){};a.prototype.Pa=function(){};a.prototype.Ma=function(){};a.prototype.bb=function(){};a.prototype.ma=function(){};a.prototype.a=function(a){return a.ze(this)};a.prototype.detach=function(){var a=this.parent;return a?(a.Ae(this),a):null};Object.defineProperty(a.prototype,
"visible",{get:function(){return!0},set:function(a){Ea(this,"visible",a)},enumerable:!0,configurable:!0});return a}(),P=function(a){function b(b){a.call(this);this.children=[];if(b)for(var e=0;e<b.length;e++)b[e].a(this)}x(b,a);b.prototype.ze=function(a){if(a.parent===this)return!1;this.children.push(a);a.parent=this;return!0};b.prototype.Ae=function(a){if(null!=a.parent){a.parent=null;for(var b=this.children,c=0;c<b.length;++c)if(b[c]===a){a=this.children;for(var b=a.length,f=Array(b-1),h=0;h<c;++h)f[h]=
a[h];for(h=c+1;h<b;++h)f[h-1]=a[h];this.children=f;break}}};b.prototype.qb=function(a,b){for(var c=0,f=this.children;c<f.length;c++){var h=f[c];h.visible&&h.qb(a,b)}};b.prototype.Qa=function(a,b){for(var c=0,f=this.children;c<f.length;c++){var h=f[c];h.visible&&h.Qa(a,b)}};b.prototype.Pa=function(a,b){for(var c=0,f=this.children;c<f.length;c++){var h=f[c];h.visible&&h.Pa(a,b)}};b.prototype.Ma=function(a,b){for(var c=0,f=this.children;c<f.length;c++){var h=f[c];h.visible&&h.Ma(a,b)}};b.prototype.bb=
function(a){for(var b=0,c=this.children;b<c.length;b++){var f=c[b];f.visible&&f.bb(a)}};b.prototype.ma=function(a,b){for(var c=0,f=this.children;c<f.length;c++){var h=f[c];h.visible&&h.ma(a,b)}};return b}(ba),lb=function(){function a(a){this.fc=a}a.prototype.aa=function(a,d,e){Ia(a,e,this.fc)};return a}(),B=function(){function a(a,d,e){this.value=a;this.Pb=d;this.fc=e;d&&d.fillStyle&&d.textAlign&&d.textBaseline||(a=Object.create(d||null),d&&d.fillStyle||(a.fillStyle="white"),d&&d.textAlign||(a.textAlign=
"center"),d&&d.textBaseline||(a.textBaseline="middle"),this.Pb=a)}a.prototype.aa=function(a,d,e){d=e.x;var c=e.y,f=e.i;e=e.l;this.fc&&Ia(a,d,c,f,e,this.fc);ua(a,this.text,d,c,f,e,this.Pb)};Object.defineProperty(a.prototype,"text",{get:function(){var a=this.value;"function"===typeof a&&(a=a());return Ca(a)},enumerable:!0,configurable:!0});return a}(),I=function(){function a(a){this.src=a;this.hb=void 0}a.from=function(b){var d=new a(void 0);d.hb=b;return d};a.prototype.then=function(a){null==this.hb?
(this.ua=fa(this.ua,a),this.ud()):L.then(a);return this};a.prototype.ud=function(){var b=this;if(void 0===this.hb){var d=function(a){b.hb=a;ga(b.ua);b.ua=void 0};this.hb=null;var e=new Image;e.addEventListener("load",function(){return d(e)});e.addEventListener("error",function(){return d(a.Ua)});e.src=this.src}};Object.defineProperty(a.prototype,"image",{get:function(){void 0===this.hb&&this.ud();return this.hb},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"w",{get:function(){var a=
this.oa;return a?a.width:1},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"h",{get:function(){var a=this.oa;return a?a.height:1},enumerable:!0,configurable:!0});a.prototype.aa=function(a,d,e,c,f){d=this.oa;var h=e.x,g=e.y,k=e.i;e=e.l;d&&0<k&&0<e&&(!c||0>=f?a.drawImage(d,h,g,k,e):(a.save(),a.globalCompositeOperation="destination-out",a.drawImage(d,h,g,k,e),a.globalCompositeOperation="destination-over",a.fillStyle=c,a.fillRect(h,g,k,e),1>f&&(a.globalCompositeOperation="source-over",
a.globalAlpha=1-f,a.drawImage(d,h,g,k,e)),a.restore()))};a.Ua=null;return a}(),Gb={fontSize:32,fillStyle:"white",strokeStyle:"black",textAlign:"left",textBaseline:"top",lineWidth:2},Ma={fillStyle:w(0,0,0,.8)},Hb={fillStyle:"white",strokeStyle:"black",fontSize:44,textAlign:"center",textBaseline:"middle"},G=function(a){function b(b,e){a.call(this);this.duration=b;e&&(this.Jb=e)}x(b,a);b.prototype.a=function(b){return a.prototype.a.call(this,b)?(this.start=performance.now(),!0):!1};b.prototype.detach=
function(){this.start=null;return a.prototype.detach.call(this)};b.prototype.ma=function(a,b){var c=this.start;null!=c&&(b>=c+this.duration?(this.Jb(1,a,b),this.detach(),ga(this.ua),this.ua=void 0):(c=U(0,b-c)/this.duration,this.Jb(c,a,b)))};b.prototype.Jb=function(){};b.prototype.then=function(a){this.ua=fa(this.ua,a);return this};b.Ub=function(a,b,c){return null==b||a<b?0:null==c||b+c<a?1:(a-b)/c};b.Vd=function(a,b){return null==b||a<b?0:(a-b)%1E3/1E3};return b}(ba),eb=function(a){function b(b,
e){void 0===e&&(e=400);a.call(this,e);this.next=b}x(b,a);b.prototype.Jb=function(a,b,c){1>a?(0<a&&this.next.ma(b,c),b.save(),b.globalAlpha=1-a,b.fillStyle="black",b.fillRect(0,0,1280,720),b.restore()):this.next.a(this.parent)};return b}(G),ca=function(a){function b(b,e,c){void 0===c&&(c=400);a.call(this,c);this.Ab=b;this.next=e}x(b,a);b.prototype.a=function(b){return a.prototype.a.call(this,b)?(this.Ab.detach(),!0):!1};b.prototype.Jb=function(a,b,c){1>a?(this.Ab.ma(b,c),0<a&&(b.save(),b.globalAlpha=
a,b.fillStyle="black",b.fillRect(0,0,1280,720),b.restore())):this.next&&(new eb(this.next,this.duration)).a(this.parent)};return b}(G),La=function(a){function b(){a.apply(this,arguments)}x(b,a);b.prototype.a=function(b){return null==this.Ab&&null!=b.parent&&a.prototype.a.call(this,b.parent)?(b.detach(),this.Ab=b,!0):!1};b.prototype.detach=function(){var b=a.prototype.detach.call(this);b&&this.Ab.a(b);return b};b.prototype.ma=function(b,e){this.Ab.ma(b,e);a.prototype.ma.call(this,b,e)};b.confirm=function(a,
e){function c(a){var b=f[a],d=b.click,e=b.La;(new K(l+(k+r)*a,495,k,90,new B(b.label),d?function(){g.detach();d()}:function(){g.detach()},e)).a(g)}for(var f=[],h=2;h<arguments.length;h++)f[h-2]=arguments[h];var g=new b;(new H(0,0,1280,720,new B(e,Hb,Ma))).a(g);for(var h=f.length,k=1280/(3+h),r=k/8,l=(1280-k*h-r*(h-1))/2,q=0;q<h;++q)c(q);g.a(a);return g};return b}(P),ka=function(a){function b(b,e,c,f){a.call(this);this.x=b;this.y=e;this.i=c;this.l=f}x(b,a);b.prototype.contains=function(a,b){return this.visible&&
this.x<=a&&this.y<=b&&a<this.x+this.i&&b<this.y+this.l};Object.defineProperty(b.prototype,"left",{get:function(){return this.x},set:function(a){this.i=this.i+this.x-a;this.x=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"right",{get:function(){return this.x+this.i},set:function(a){this.i=a-this.x},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"top",{get:function(){return this.y},set:function(a){this.l=this.l+this.y-a;this.y=a},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"bottom",{get:function(){return this.y+this.l},set:function(a){this.l=a-this.y},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"center",{get:function(){return{x:this.x+this.i/2,y:this.y+this.l/2}},enumerable:!0,configurable:!0});b.prototype.moveTo=function(a,b){this.x=a;this.y=b;return this};b.prototype.moveBy=function(a,b){this.x+=a;this.y+=b;return this};return b}(ba),H=function(a){function b(b,e,c,f,h){a.call(this,b,e,c,f);this.Wa=h}x(b,a);b.prototype.ma=
function(a,b){this.Wa.aa(a,b,this)};return b}(ka),K=function(a){function b(d,e,c,f,h,g,k,l){void 0===l&&(l=b.jb);a.call(this,d,e,c,f);this.Wa=h;this.click=g;this.La=k;this.xa=l;this.sa=!1}x(b,a);Object.defineProperty(b.prototype,"enabled",{get:function(){return!0},set:function(a){Ea(this,"enabled",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"state",{get:function(){return this.enabled?this.Da?2:this.sa?1:0:3},enumerable:!0,configurable:!0});b.prototype.qb=function(a,b){this.sa=
this.contains(a,b);this.Da=null};b.prototype.Qa=function(a,b){null!=this.Da&&(this.Da=this.contains(a,b))};b.prototype.Pa=function(a,b){this.enabled&&this.contains(a,b)&&(this.Da=!0)};b.prototype.Ma=function(a,b){var c=this.Da;this.Da=null;c&&this.contains(a,b)&&this.Mc()};b.prototype.bb=function(a){this.La&&0<=this.La.indexOf(a)&&this.enabled&&(this.Da=!1,this.Mc())};b.prototype.Mc=function(){var a=this;this.click&&L.then(function(){return a.click()})};b.prototype.ma=function(a,b){this.xa.aa(a,b,
this)};b.jb={aa:function(a,b,c){a.save();switch(c.state){case 0:a.fillStyle=w(0,0,0,.8);a.strokeStyle=k(200,200,200);break;case 1:a.fillStyle=w(0,0,50,.8);a.strokeStyle=k(100,100,200);break;case 2:a.fillStyle=w(0,0,150,.8);a.strokeStyle=k(100,100,255);break;case 3:a.fillStyle=w(200,200,200,.8),a.strokeStyle=k(200,200,200)}a.fillRect(c.x,c.y,c.i,c.l);a.strokeRect(c.x,c.y,c.i,c.l);a.restore();c.Wa&&c.Wa.aa(a,b,c)}};b.Pd=function(){function a(b){this.td=b}a.prototype.aa=function(a,b,d){var h=d.Wa;switch(d.state){case 0:h.aa(a,
b,d);break;case 1:h.aa(a,b,d,this.td,.7);break;case 2:h.aa(a,b,d,this.td,.9);break;case 3:h.aa(a,b,d,k(200,200,200),.8)}};return a}();return b}(ka),Ib=function(a){function b(b,e,c,f,h,g,k,l,p,q){void 0===q&&(q=K.jb);a.call(this,b,e,c,f,g,k,p,q);this.group=h;this.Dd=l;h.push(this)}x(b,a);b.prototype.Qa=function(b,e){var c=this;a.prototype.Qa.call(this,b,e);if(this.j&&!this.wa){var f=this.group.find(function(a){return a!==c&&a.contains(b,e)&&!a.wa});if(f){var h=performance.now();this.rd(f,h);f.rd(this,
h);this.j={kc:this.wa.lc,mc:this.wa.nc};this.Dd&&this.Dd(f)}else null!=this.j.Qc?(this.x=this.j.kc-this.j.Qc+b,this.y=this.j.mc-this.j.Id+e):(this.j.Qc=b,this.j.Id=e)}};b.prototype.Pa=function(b,e){a.prototype.Pa.call(this,b,e);!this.j&&this.contains(b,e)&&(this.j={Qc:b,Id:e,kc:this.x,mc:this.y})};b.prototype.Ma=function(b,e){if(this.wa)this.j=null,a.prototype.Ma.call(this,b,e);else if(this.j){var c=this.j,f=c.kc,c=c.mc;this.wa={start:performance.now(),Hd:this.x,Jd:this.y,lc:f,nc:c};this.j=null;this.Da&&
(this.Da=null,this.contains(b,e)&&f<=b&&c<=e&&b<f+this.i&&e<c+this.l&&this.Mc())}else a.prototype.Ma.call(this,b,e)};b.prototype.rd=function(a,b){this.Da=null;this.wa={start:b,Hd:this.x,Jd:this.y,lc:a.j?a.j.kc:a.x,nc:a.j?a.j.mc:a.y}};b.prototype.ma=function(b,e){if(this.wa){var c=G.Ub(e,this.wa.start,200);1>c?(c=(1-ja(W*c))/2,this.x=this.wa.Hd*(1-c)+this.wa.lc*c,this.y=this.wa.Jd*(1-c)+this.wa.nc*c):(this.x=this.wa.lc,this.y=this.wa.nc,this.wa=null)}a.prototype.ma.call(this,b,e)};return b}(K),E=function(a){function b(d,
e,c,f,h,g,k,l){void 0===l&&(l=b.jb);a.call(this,d,e,c,f);this.Va=h;this.rows=g;this.click=k;this.xa=l;this.Oa=0}x(b,a);b.Xa=function(a){var e;void 0===e&&(e=b.jb);return e.xb+a*e.gc};b.prototype.qb=function(a,b){this.sa=this.jc(a,b);this.scrolling=this.j=null};b.prototype.Qa=function(a,b){var c=this.xa.xb;null!=this.scrolling?this.scrollTo(u(this.rows.length*(b-(this.y+c)-this.scrolling)/(this.l-c))):(c=this.jc(a,b),null!=c&&null!=this.j&&c!==this.j&&(f=[this.rows[c],this.rows[this.j]],this.rows[this.j]=
f[0],this.rows[c]=f[1],this.j=c,this.Ia=this.scrolling=this.sa=null));var f};b.prototype.Pa=function(a,b){if(this.contains(a,b)&&(this.sa=this.j=this.jc(a,b),null==this.j)){var c=this.xa,f=c.xb,h=this.i-c.Kb,c=this.y+f;if(this.x<=a&&a<this.x+h&&this.y<=b&&b<c)c=this.Re(a),null!=c&&this.sort(c,null!=this.Ia&&this.Ia[0]===c+1);else if(this.x+h<=a&&a<this.right){var h=this.rows.length,g=this.Cc,f=this.l-f,k=c+f*this.Oa/h,l=f*g/h;c<=b&&b<k?(this.scrollTo(u(h*(b-c)/f)),k=c+f*this.Oa/h):k+l<=b&&b<this.bottom&&
(this.scrollTo(u(h*(b-c)/f)-g+1),k=c+f*this.Oa/h);k<=b&&b<k+l&&(this.scrolling=b-k)}}};b.prototype.Ma=function(a,b){null==this.scrolling&&null!=this.j&&this.j===this.sa&&(this.click(this.rows[this.j],this.j),this.refresh());this.scrolling=this.j=null;this.sa=this.jc(a,b)};b.prototype.bb=function(a){switch(a){case l.Uc:this.scrollBy(this.Oe);break;case l.Vc:this.scrollBy(-this.Oe)}};b.prototype.ma=function(a){var b=this.xa,c=b.xb,f=b.Kb,h=this.rows.length,g=this.Cc,k=this.x,l=this.y+c,p=this.i-f,q=
this.l-c,n=this.x+p,u=(0<h&&q*this.Oa/h||0)+l,N=0<h&&q*g/h||q,rb=this.Wd;b.dd(a,this.x,this.y,this.i,c);b.Yd(a,this.x,l,p,q);0<f&&(b.dd(a,n,l,f,q),g<h&&b.ee(a,n,u,f,N));a.save();a.font=b.Le;a.fillStyle=b.Me;a.textBaseline="middle";for(var N=b.gc,T=0;T<g;++T){var f=T+this.Oa,sb=this.rows[f],ha=l+N*T;f===this.j?b.be(a,this.x,ha,p,N):sb===this.selected?b.de(a,this.x,ha,p,N):f===this.sa&&null==this.j&&b.ce(a,this.x,ha,p,N);for(var vb=0,f=0,h=this.Va.length;f<h;++f){var n=this.Va[f],u=oa(n.width,rb),w=
this.ba(sb,n);if(null!=w){var la=k+vb+2,ma=u-4;a.textAlign=n.align||"left";switch(a.textAlign){case "center":la+=ma/2;break;case "right":la+=ma}a.fillText(w,la,ha+N/2,ma)}vb+=u}}a.restore();a.save();N=0;a.font=b.me;a.fillStyle=b.ne;a.textAlign="center";a.textBaseline="middle";a.strokeStyle=b.we;f=0;for(h=this.Va.length;f<h;++f)n=this.Va[f],u=oa(n.width,rb),T=k+N,0<f&&(a.beginPath(),a.moveTo(T,l),a.lineTo(T,this.bottom),a.stroke()),a.fillText(n.name.ta,T+u/2,this.y+c/2),N+=u;a.restore();0===g&&0<q&&
b.he&&(a.save(),a.font=b.eh,a.textAlign="center",a.textBaseline="middle",a.fillStyle=b.fh,a.fillText(b.he.ta,this.x+p/2,l+q/2),a.restore())};Object.defineProperty(b.prototype,"displayCount",{get:function(){var a=this.xa;return S(u((this.l-a.xb)/a.gc),this.rows.length)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"scrollStep",{get:function(){return U(u(.2*this.Cc),1)},enumerable:!0,configurable:!0});b.prototype.ba=function(a,b){var c=b.ba;switch(typeof c){case "function":return c(a);
case "number":return a[c];default:return a[c]}};b.prototype.compare=function(a,b){for(var c=0,f=0,h=this.Ia.length;0===c&&f<h;++f){var g=this.Ia[f],c=this.Va[(0<g?g:-g)-1],c=c.compare?c.compare(a,b):ra(this.ba(a,c),this.ba(b,c));0>g&&(c=-c)}return c};b.prototype.sort=function(a,b){var c=this;void 0===b&&(b=!1);var f=a+1;if(this.Ia){for(var h=0,g=this.Ia.length;h<g;++h)if(this.Ia[h]===f||this.Ia[h]===-f){this.Ia.splice(h,1);break}this.Ia.unshift(b?-f:f)}else this.Ia=[b?-f:f];this.rows.sort(function(a,
b){return c.compare(a,b)})};b.prototype.jc=function(a,b){var c=this.xa,f=this.i-c.Kb;return this.x<=a&&a<this.x+f&&(c=this.Oa+u((b-this.y-c.xb)/c.gc),this.Oa<=c&&c<this.rows.length)?c:null};b.prototype.Re=function(a){var b=this.i-this.xa.Kb;if(this.x<=a&&a<this.x+b)for(var b=this.Wd,c=this.x,f=0,h=this.Va.length;f<h;++f){var g=oa(this.Va[f].width,b);if(c<=a&&a<c+g)return f;c+=g}return null};Object.defineProperty(b.prototype,"defaultColumnWidth",{get:function(){for(var a=this.i-this.xa.Kb,b=0,c=0,
f=0,h=this.Va;f<h.length;f++){var g=h[f];null!=g.width?b+=g.width:++c}return 0<c&&b<a?(a-b)/c:0},enumerable:!0,configurable:!0});b.prototype.refresh=function(){var a=this.rows.length;this.j>=a&&(this.j=null);this.sa>=a&&(this.sa=null);this.scrollTo(this.Oa)};b.prototype.scrollTo=function(a){this.Oa=ea(0,this.rows.length-this.Cc,a)};b.prototype.scrollBy=function(a){this.scrollTo(this.Oa+a)};b.jb={gc:28,Le:Z(20),Me:"white",xb:24,me:Z(18),ne:"white",Kb:14,we:k(102,102,102),dd:function(a,b,c,f,h){a.save();
a.fillStyle=w(25,25,25,.8);a.fillRect(b,c,f,h);a.restore()},Yd:function(a,b,c,f,h){a.save();a.fillStyle=w(0,0,0,.6);a.fillRect(b,c,f,h);a.restore()},ee:function(a,b,c,f,h){va(a,b,c,f,h,k(100,100,100),k(75,75,75))},be:function(a,b,c,f,h){va(a,b,c,f,h,k(255,0,0),k(50,0,0))},de:function(a,b,c,f,h){va(a,b,c,f,h,k(100,0,0),k(50,0,0))},ce:function(a,b,c,f,h){va(a,b,c,f,h,k(75,0,0),k(50,0,0))}};return b}(ka),fb=function(){function a(a,d,e){this.min=d;this.max=e;this.value=a}Object.defineProperty(a.prototype,
"value",{get:function(){return this.yc},set:function(a){this.yc=ea(this.min,this.max,ta(a))},enumerable:!0,configurable:!0});a.prototype.toString=function(){return this.yc.toString()};a.prototype.valueOf=function(){return this.yc};return a}(),Db=function(a){function b(d,e,c,f,h,g){void 0===g&&(g=b.jb);a.call(this,d,e,c,f);this.value=h;this.xa=g;this.sa=this.j=!1}x(b,a);b.prototype.le=function(){var a=this.xa.Kc,b=this.value,c=b.min;return this.x+a/2+(b.value-c)/(b.max-c)*(this.i-a)};b.prototype.Bd=
function(a){var b=this.xa.Kc,c=this.value,f=c.min;this.value.value=ta(f+ea(0,1,(a-this.x-b/2)/(this.i-b))*(c.max-f))};b.prototype.qb=function(a,b){this.sa=this.contains(a,b);this.j=!1};b.prototype.Qa=function(a,b){this.sa=this.j&&this.contains(a,b);this.j&&this.Bd(a)};b.prototype.Pa=function(a,b){this.contains(a,b)&&(this.j=!0,this.Bd(a))};b.prototype.Ma=function(){this.j=!1};b.prototype.ma=function(a,b){this.xa.aa(a,b,this)};Object.defineProperty(b.prototype,"knob",{get:function(){var a=this.xa.Kc,
b=this.l;return{x:this.le()-a/2,y:this.y-(this.l-b)/2,i:a,l:b,state:this.j?2:this.sa?1:0}},enumerable:!0,configurable:!0});b.jb={Kc:12,aa:function(a,b,c){Ia(a,c,{fillStyle:w(50,50,50,.8),strokeStyle:"white",lineWidth:4});b=c.kh;c={strokeStyle:"white",lineWidth:4};switch(b.state){case 0:c.fillStyle=w(150,150,150,.8);break;case 1:c.fillStyle=w(200,200,200,.8);break;case 2:c.fillStyle=w(255,255,255,.8)}Ia(a,b,c)}};return b}(ka),Jb=function(a){function b(b,e,c,f,g,k){a.call(this,b,e,c,f);this.duration=
g;this.style=k;this.pd=[]}x(b,a);b.prototype.ma=function(a,b){var c=this.pd;if(0<c.length){var f=b-this.duration,g=c.findIndex(function(a){return a.Gd>f});0>g?c.length=0:c.splice(0,g);g=c.length;if(0<g)for(var k=this.style,l=1.2*(k&&k.fontSize||24),r=0;r<g;++r)ua(a,c[r].message,this.x,this.y+r*l,this.i,l,k)}};b.prototype.log=function(a){if(a){var b=performance.now(),c=this.pd,f=c.length;0<f&&c[f-1].message===a?c[f-1].Gd=b:c.push({message:Ca(a),Gd:b})}};b.prototype.error=function(a){this.log(a)};return b}(ka);
M.languages.en="assets/lang/en.js";M.languages.ja="assets/lang/ja.js";var nb={Ga:w(0,0,0,.6),ad:k(255,51,0),dc:k(153,204,0),wb:k(0,204,51)},wb={Ga:w(0,0,0,.6),ad:k(0,51,102),dc:k(0,153,204),wb:k(0,153,255)},Ta=[{Sb:0,Tb:!1,Ea:!1},{Sb:0,Tb:!1,Ea:!0},{Sb:0,Tb:!0,Ea:!0},{Sb:300,Tb:!0,Ea:!0}],tb=[l.tb,l.pc,l.Tc,l.tc,l.Bb],ob=[l.pc,l.tc,l.Xg],pb=[l.tb,l.Tc,l.Bb,l.ag],Eb=[l.Tc],Kb=[l.pc,l.tc],F,Lb={Ug:{INT:4,da:4,ka:7,ea:["Mace","PlateArmor","Mace"],w:["Swing","Crash","Bash","PathToWarrior"],oa:"nazrin"},
tg:{INT:3,da:7,ka:5,ea:["Katana","Chainmail"],w:["Swing","Slash","CutThrough","Sweep"],oa:"rin"},Lf:{INT:6,da:2,ka:7,ea:["Spear","LamellarArmor","KiteShield"],w:["Swing","Stab","Thrust","ShieldBash","ShieldCharge"],oa:"toramaru"},Mg:{INT:3,da:6,ka:6,ea:["LongBow","LetherArmor","FirstAidKit"],w:["Shoot","PoisonArrow","FirstAid"],oa:"marisa"},Ff:{INT:7,da:3,ka:5,ea:["Staff","Robe"],w:["Swing","Heal","PartyHeal"],oa:"reimu"},Xf:{INT:8,da:4,ka:3,ea:["Wand","Robe"],w:["FireBall","IceSpear","DrainLife",
"LightningLaser","FireNova"],oa:"utsuho"}},xb={Te:{INT:3,da:3,ka:4,ea:["Dagger","LetherArmor"],w:["Swing"],oa:"ant.png"},sf:{INT:4,da:3,ka:3,ea:["Wand","LetherArmor"],w:["FireBall","ResistFire"],oa:"elemental.png"},yf:{INT:4,da:4,ka:4,ea:["ShortBow","LetherArmor"],w:["Shoot"],oa:"frog.png"},ig:{INT:4,da:3,ka:4,ea:["Wand","LetherArmor"],w:["FireNova"],oa:"plant.png"},Dg:{INT:3,da:3,ka:3,ea:["Wand","LetherArmor"],w:["DrainLife"],oa:"slug.png"},Eg:{INT:3,da:3,ka:3,ea:["Wand","LetherArmor"],w:["Heal"],
oa:"snail.png"},Lg:{INT:3,da:5,ka:4,ea:["LongSword","LetherArmor"],w:["Swing"],oa:"sword.png"},Sg:{INT:2,da:2,ka:6,ea:["Mace","LetherArmor"],w:["Swing"],oa:"wall.png"},Vg:{INT:3,da:6,ka:3,ea:["Spear","LetherArmor"],w:["Thrust"],oa:"weasel.png"}},Mb={Se:{b:[0,1,2],min:5,max:10,ia:function(a,b){return b+a}}},Y={hf:{b:[0,5],weight:13,m:100,ia:30},Ag:{b:[0,5],weight:15,m:100,ia:40},Vf:{b:[0,5],weight:16,m:100,ia:50},Jf:{b:[0,5],weight:15,m:100,ia:45},Xe:{b:[0,5,6],weight:18,m:100,ia:45},Wf:{b:[0,6],weight:16,
m:100,ia:40},Fg:{b:[0,7],weight:20,m:100,ia:50},Df:{b:[0,5,6,7],weight:30,m:100,ia:50},zg:{b:[2,7],weight:18,m:100,ia:30},Uf:{b:[2,7],weight:20,m:100,ia:40},Ig:{b:[0,6,3],weight:20,m:100,ia:20},Tg:{b:[3],weight:16,m:100,ia:25},xf:{b:[4],weight:10,m:100,ia:10},af:{b:[8],weight:20,m:100,ia:10,v:10},rg:{b:[8],weight:25,m:100,ia:15,v:15},Gg:{b:[8],weight:30,m:100,ia:30,v:15},Kf:{b:[8],weight:35,m:100,ia:20,v:20},Og:{b:[8],weight:40,m:100,ia:30,v:20},df:{b:[9],weight:5,m:100,v:2},Rf:{b:[9],weight:10,m:100,
v:4},Yf:{b:[9],weight:15,m:100,v:6},sg:{b:[9],weight:20,m:100,v:8},Ye:{b:[9],weight:25,m:100,v:10},Hf:{b:[9],weight:30,m:100,v:12},qg:{b:[10],weight:20,m:100,v:10},Sf:{b:[10],weight:25,m:100,v:15},vg:{b:[10],weight:30,m:100,v:20},bf:{b:[10],weight:35,m:100,v:22},Pf:{b:[10],weight:40,m:100,v:25},jg:{b:[10],weight:45,m:100,v:30},Af:{b:[11],weight:10,m:100,v:4},$f:{b:[11],weight:20,m:100,v:6},zf:{b:[11],weight:30,m:100,v:8},Cg:{b:[12],weight:5,m:100,v:2},ug:{b:[12],weight:10,m:100,v:4},yg:{b:[12],weight:15,
m:100,v:6},$e:{b:[12],weight:20,m:100,v:8},Cf:{b:[12],weight:25,m:100,v:10}},Nb={rf:{b:[],usage:1,o:0,h:999,ca:0,f:"Damage",action:"Charge"},Kg:{b:[0],usage:1,o:100,h:14,ca:1,f:"Damage",action:"Charge"},Bg:{b:[0,5],usage:1,o:110,h:15,ca:1,f:"Damage",action:"Charge"},ff:{b:[0,5],usage:1,o:100,h:20,ca:1,f:"Damage",action:"GoBehind"},Jg:{b:[0,5],usage:5,o:100,h:20,ca:1,f:"Damage",action:"Nova"},ef:{b:[0,6],usage:1,o:110,h:15,ca:1,f:"Damage",action:"Charge"},Ze:{b:[0,6],usage:1,o:100,h:20,ca:1,f:"Damage",
action:"Knockback"},Hg:{b:[0,7],usage:1,o:110,h:15,ca:1,f:"Damage",action:"Charge"},Ng:{b:[0,7],usage:3,o:100,h:15,ca:2,f:"Damage",action:"Laser"},wg:{b:[8],usage:1,o:100,h:20,ca:1,f:"Damage",action:"Charge"},xg:{b:[8],usage:1,o:100,h:24,ca:1,f:"Damage",action:"Trample"},Qd:{b:[2],usage:1,o:100,h:20,ca:3,f:"Damage",action:"Shoot"},kg:{b:[2],usage:1,o:60,h:20,ca:3,f:"DamageOverTime",action:"Shoot"},If:{b:[3,14],usage:1,o:80,h:16,ca:5,f:"DamageHPandSP",action:"Shoot"},qf:{b:[3,16],usage:1,o:80,h:16,
ca:5,f:"Damage",action:"Drain"},uf:{b:[3,13],usage:1,o:100,h:16,ca:5,f:"Damage",action:"Explode"},Tf:{b:[3,15],usage:3,o:100,h:16,ca:5,f:"Damage",action:"Laser"},vf:{b:[3,13],usage:5,o:100,h:16,ca:2,f:"Damage",action:"Nova"},Od:{b:[3,16],usage:2,o:100,h:24,ca:3,f:"Heal",action:"Shoot"},cg:{b:[3,16],usage:6,o:100,h:24,ca:1,f:"Heal",action:"Nova"},wf:{b:[4,16],usage:2,o:100,h:24,ca:1,f:"HealOverTime",action:"Charge"},hg:{b:[0],usage:0,o:2,h:10,f:"Aura",action:"Offence"},gg:{b:[1],usage:0,o:2,h:10,f:"Aura",
action:"Offence"},eg:{b:[2],usage:0,o:2,h:10,f:"Aura",action:"Offence"},fg:{b:[3],usage:0,o:2,h:10,f:"Aura",action:"Offence"},dg:{b:[4],usage:0,o:2,h:10,f:"Aura",action:"Offence"},mf:{b:[0],usage:0,o:2,h:10,f:"Aura",action:"Defence"},nf:{b:[1,2],usage:0,o:2,h:10,f:"Aura",action:"Defence"},Zf:{b:[3],usage:0,o:2,h:10,f:"Aura",action:"Defence"},Gf:{b:[4],usage:0,o:2,h:10,f:"Aura",action:"Defence"},Ve:{b:[13],usage:0,o:4,h:10,f:"Aura",action:"Offence"},Ue:{b:[14],usage:0,o:4,h:10,f:"Aura",action:"Offence"},
We:{b:[15],usage:0,o:4,h:10,f:"Aura",action:"Offence"},og:{b:[13],usage:0,o:4,h:10,f:"Aura",action:"Defence"},ng:{b:[14],usage:0,o:4,h:10,f:"Aura",action:"Defence"},pg:{b:[15],usage:0,o:4,h:10,f:"Aura",action:"Defence"}},wa,Ob=xa([0,1,2,3,4,5,6,7]),Pb=xa([8,9,10,11,12]),Ua=function(){function a(b){this.oc=b;this.fa=Mb[b];if(null==this.fa)throw new RangeError('Enchantment not found: "'+b+'"');this.name=a.zb(b);this.Pc=a.Mb(b);this.value=this.fa.min+Ba(this.fa.max-this.fa.min)}a.prototype.Fe=function(a){return Da(this.name.ta,
a)};a.prototype.modify=function(a){this.fa.ia&&(a=this.fa.ia(this.value,a));return a};a.zb=function(a){return g("Enchant",a,"Name")};a.Mb=function(a){return g("Enchant",a,"Spec")};a.from=function(b){return new a(b)};a.Xb=function(b){return new a(b.oc)};a.prototype.toJSON=function(){return{oc:this.oc,value:this.value}};return a}(),aa=function(){function a(b,d){this.sb=b;this.Ha=d;this.fa=Y[b];if(null==this.fa)throw new RangeError('Item not found: "'+b+'"');this.baseName=a.zb(b);this.Pc=a.Mb(b);this.Sa=
xa(this.fa.b);null==this.Ha&&(this.Ha=(this.fa.Ha||[]).map(Ua.from))}Object.defineProperty(a.prototype,"name",{get:function(){for(var a=this.baseName.ta,d=0,e=this.Ha;d<e.length;d++)a=e[d].Fe(a);return a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"tags",{get:function(){return this.fa.b},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"weight",{get:function(){return this.fa.weight},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"priceToSell",
{get:function(){for(var a=this.fa.m,d=0,e=this.Ha;d<e.length;d++)a=e[d].modify(a);return u(a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ATK",{get:function(){for(var a=this.fa.ia||0,d=0,e=this.Ha;d<e.length;d++)a=e[d].modify(a);return a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"DEF",{get:function(){for(var a=this.fa.v||0,d=0,e=this.Ha;d<e.length;d++)a=e[d].modify(a);return a},enumerable:!0,configurable:!0});a.zb=function(a){return g("Item",a,"Name")};
a.Mb=function(a){return g("Item",a,"Spec")};a.from=function(b){return new a(b)};a.Xb=function(b){return new a(b.sb,R(Ua,b.Ha))};a.prototype.toJSON=function(){return{sb:this.sb,Ha:pa(this.Ha)}};return a}(),gb=function(){function a(b){this.sc=b;this.fa=Nb[b];if(null==this.fa)throw new RangeError('Skill not found: "'+b+'"');this.name=a.zb(b);this.Pc=a.Mb(b);this.Sa=xa(this.fa.b)}Object.defineProperty(a.prototype,"tags",{get:function(){return this.fa.b},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"rawCost",{get:function(){return this.fa.h},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"rawRange",{get:function(){return this.fa.ca},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"rawPower",{get:function(){return this.fa.o},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"target",{get:function(){return this.fa.usage},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hostile",{get:function(){var a;a:switch(this.fa.usage){case 2:case 4:case 6:a=
!1;break a;default:a=!0}return a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"effect",{get:function(){return this.fa.f},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"action",{get:function(){return this.fa.action},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isActive",{get:function(){return"Aura"!==this.f},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isPassive",{get:function(){return"Aura"===this.f},enumerable:!0,
configurable:!0});a.prototype.match=function(a){var d=this.Sa&Ob;return(d&a.Sa)===d};a.zb=function(a){return g("Skill",a,"Name")};a.Mb=function(a){return g("Skill",a,"Spec")};a.from=function(b){return new a(b)};a.Xb=function(b){return new a(b.sc)};a.prototype.toJSON=function(){return{sc:this.sc}};a.Ua=new a("Dummy");return a}(),yb=[1,2,3,4,5,5,5,5,4,3,2,1],Va;(function(a){a[a.DEFAULT=0]="DEFAULT";a[a.BLINK_1=1]="BLINK_1";a[a.BLINK_2=2]="BLINK_2";a[a.BLINK_3=3]="BLINK_3";a[a.BLINK_4=4]="BLINK_4";a[a.CLOSED=
5]="CLOSED"})(Va||(Va={}));var X=function(){function a(a,d,e,c,f,g,k,l,r){this.name=a;this.level=d;this.INT=e;this.da=c;this.ka=f;this.ea=g;this.w=k;this.yb=l;this.src=r;var p=[];a=0>r.indexOf("/")?"assets/char/"+r:r;if(r.endsWith(".png"))r=new I(a),p[0]=r;else{var q=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];if(0>=a.length)return null;var b=a[0],c=b.i,d=b.l,b=document.createElement("canvas");b.width=c;b.height=d;for(var e=b.getContext("2d"),c={x:0,y:0,i:c,l:d},d=0;d<a.length;d++)a[d].aa(e,
null,c);return I.from(b)},n=[new I(a+"/back.png"),new I(a+"/eye.png"),new I(a+"/eye1.png"),new I(a+"/eye2.png"),new I(a+"/eye3.png"),new I(a+"/eye4.png"),new I(a+"/eye5.png"),new I(a+"/fore.png")];sa(n).then(function(){return p.push(q(n[0],n[1],n[7]),q(n[0],n[2],n[7]),q(n[0],n[3],n[7]),q(n[0],n[4],n[7]),q(n[0],n[5],n[7]),q(n[0],n[6],n[7]))})}this.images=p;this.$c=4500+100*e;this.Ud=Ba(this.$c)}Object.defineProperty(a.prototype,"w",{get:function(){var a=this.images[0];return a?a.i:1},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"h",{get:function(){var a=this.images[0];return a?a.l:1},enumerable:!0,configurable:!0});a.prototype.aa=function(a,d,e,c,f){var g;g=(d+this.Ud)%this.$c;g=450>g?yb[u(g/450*yb.length)]:0;var k=this.images;(g=k[g]||k[Va.DEFAULT])&&g.aa(a,d,e,c,f)};Object.defineProperty(a.prototype,"HP",{get:function(){return 10*(3+this.ka)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"SP",{get:function(){var a=U(0,this.weight-this.xe);return U(0,
4*(3+this.ka)-a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"reservedSP",{get:function(){var a=this;return this.w.reduce(function(d,e){return d+(e.ue?a.vb(e):0)},0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"step",{get:function(){return 13-this.da},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ZoC",{get:function(){return 3+this.da},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxWeight",{get:function(){return 10*
(3+this.ka)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"weight",{get:function(){return this.ea.reduce(function(a,d){return a+d.weight},0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"DEF",{get:function(){return 100*(1-this.ea.reduce(function(a,d){return a*(1-d.v/100)},1))},enumerable:!0,configurable:!0});a.prototype.vb=function(a){return null==a?void 0:a.Ge-this.INT};a.prototype.cb=function(a){return null==a?void 0:a.He};a.prototype.rb=function(a){var d=
this.ve(a);return d?d.ia*a.wd/100:void 0};a.prototype.ve=function(a){var d=void 0;if(a)for(var e=0,c=0,f=this.ea;c<f.length;c++){var g=f[c];if(a.match(g)){var k=g.ia;e<k&&(e=k,d=g)}}return d};a.ub=function(b){var d=Lb[b];if(null==d)throw new RangeError('Adventurer not found: "'+b+'"');return a.from(g("Adventurer",b),0,d)};a.ye=function(b,d){var e=xb[b];if(null==e)throw new RangeError('Monster not found: "'+b+'"');return a.from(g("Monster",b),d,e)};a.from=function(b,d,e){return new a(b.ta,d,e.INT,
e.da,e.ka,e.ea.map(aa.from),e.w.map(gb.from),[],e.oa)};a.Xb=function(b){return new a(b.name,b.level||0,b.INT,b.da,b.ka,R(aa,b.ea),R(gb,b.w),R(gb,b.yb),b.oa)};a.prototype.toJSON=function(){return{name:this.name,level:this.level,INT:this.INT,da:this.da,ka:this.ka,ea:pa(this.ea),w:pa(this.w),yb:pa(this.yb),oa:this.src}};return a}(),ya;(function(a){var b=function(a){function b(){function c(a){(new ca(f,new Wa.qc(a))).a(f.parent)}var f=this;a.call(this);(new H(0,0,1280,720,new I("assets/scene/title.jpg"))).a(this);
var h=Oa(),k,l;h?(k=g("Title","Continue"),l=function(){return c(h)},(new K(1070,650,200,60,new B(g("Title","Delete")),function(){La.confirm(f,g("Title","ConfirmDelete"),{label:g("Title","Delete"),click:function(){try{System.Pe("NYO",null)}catch(a){F.error(a)}(new ca(f,new b)).a(f.parent);F.log(g("Title","NotifyDelete"))},La:ob},{label:g("Config","Cancel"),La:pb})})).a(this)):(k=g("Title","New"),l=function(){var a={},b;for(b in Y){var d=Ba(4);0<d&&(a[b]=d)}a={Lb:a,Qb:[],fb:[],ra:[X.ub("Knight"),X.ub("Warrior"),
X.ub("Samurai"),X.ub("Mage"),X.ub("Healer"),X.ub("Thief")],pb:1E3};a.ra[0].ea[0].Ha.push(Ua.from("AddedFire"));Qa(a);c(a)});(new K(480,504,320,72,new B(k),l,Kb)).a(this);(new K(480,612,320,72,new B(g("Title","Quit")),System.gh)).a(this);kb(this)}x(b,a);return b}(P);a.uc=b})(ya||(ya={}));var Wa;(function(a){function b(){return[{name:g("Character","Name"),ba:function(a){return a.name},width:200},{name:g("Character","INT"),ba:function(a){return a.INT},width:60,align:"right"},{name:g("Character","DEX"),
ba:function(a){return a.da},width:60,align:"right"},{name:g("Character","STR"),ba:function(a){return a.ka},width:60,align:"right"}]}function d(a){return[{name:a,ba:function(a){return a.name},width:200},{name:g("Town","Tags"),ba:function(a){return cb(a.b)}},{name:g("Town","Weight"),ba:function(a){return a.weight},width:60,align:"right"},{name:g("Town","ATK"),ba:function(a){return a.ia},width:60,align:"right"},{name:g("Town","DEF"),ba:function(a){return a.v},width:60,align:"right"}]}function e(a,b){var c=
b.Lb,e=d(a);e.push({name:g("Town","Stock"),ba:function(a){return oa(c[a.sb],g("Town","New"))},width:60,align:"right"});return e}function c(a,b){var c=b.Lb,d=b.Qb;return[{name:a,ba:function(a){return aa.zb(a)},width:200},{name:g("Town","Tags"),ba:function(a){return cb(Y[a].b)}},{name:g("Town","ATK"),ba:function(a){return Y[a].ia},width:60,align:"right"},{name:g("Town","DEF"),ba:function(a){return Y[a].v},width:60,align:"right"},{name:g("Town","Weight"),ba:function(a){return Y[a].weight},width:60,align:"right"},
{name:g("Town","Stock"),ba:function(a){return c[a]},width:60,align:"right"},{name:g("Town","Owned"),ba:function(a){return d.reduce(function(b,c){return c.sb===a?b+1:b},0)},width:60,align:"right"}]}function f(a){return[{name:a,ba:function(a){return a.name.ta},width:200},{name:g("Town","Required"),ba:function(a){return cb(a.b)}},{name:g("Town","Cost"),ba:function(a){return a.Ge},width:60,align:"right"},{name:g("Town","Range"),ba:function(a){return a.He},width:60,align:"right"},{name:g("Town","Power"),
ba:function(a){return a.wd},width:60,align:"right"},{name:g("Town","Spec"),ba:function(a){return a.Pc.ta}}]}var h={fontSize:64,fillStyle:k(255,255,255),strokeStyle:k(0,0,0),textAlign:"center",textBaseline:"middle",lineWidth:2},p=function(){function a(b,c){this.ra=b;this.index=c}a.prototype.aa=function(a,b,c){var d=c.x,e=c.y,f=c.i;c=c.l;var g=this.ra[this.index];a.save();if(g){var l=Ga(g,140,184);g.aa(a,b,{x:d+f/2-l.i/2,y:e+92-l.l/2,i:l.i,l:l.l});var p=this.ra.reduce(function(a,b){return b?U(a,b.qa):
a},1);b=g.qa;var l=d+10,n=f-20,q=e+c-30,p=(n-2)*b/p;a.strokeStyle="black";a.fillStyle=nb.wb;a.fillRect(l,q,p,6);a.strokeRect(l,q,p,6);ua(a,b.toString(),l+4,q-20,n,20,{fontSize:20,fillStyle:k(255,255,255),strokeStyle:k(0,0,0),textAlign:"left",textBaseline:"bottom",lineWidth:2});ua(a,g.name,d,e+c-24,f,24,{fontSize:24,fillStyle:k(255,255,255),strokeStyle:k(0,0,0),textAlign:"center",textBaseline:"bottom",lineWidth:2})}else ua(a,(this.index+1).toString(),d,e,f,c,h);a.restore()};return a}(),w=function(a){function b(c){a.call(this);
this.data=c}x(b,a);b.prototype.Fa=function(a,b,c,d){a=new K(1280-170*a,665,160,45,new B(c),d,b);a.a(this);return a};b.prototype.Gb=function(a){(new ca(this,new a(this.data))).a(this.parent)};return b}(P),r=function(a){function b(c,d){a.call(this,c);(new H(0,0,1280,720,new I("assets/scene/"+d))).a(this);kb(this);for(var e=c.ra,f=this,g=[],h=0;6>h;++h){var k=u(h/3);(new Ib(10+170*(1-k),10+h%3*214+68*k,160,204,g,new p(e,h),function(){f.Nc(this.Wa.index)},function(a){var b=this.Wa;a=a.Wa;c=[e[a.index],
e[b.index]];e[b.index]=c[0];e[a.index]=c[1];c=[a.index,b.index];b.index=c[0];a.index=c[1];var c},[l.$1+h])).a(this)}}x(b,a);return b}(w),G=function(a){function b(c){var d=this;a.call(this,c,"town.jpg");var e=["grass","moss"],f=Ba(e.length);this.Cb(5,l.Kd,"Guild",function(){}).enabled=!1;this.Cb(4,l.Ld,"Tavern",function(){return d.Gb(q)});this.Cb(3,l.Rc,"Shop",function(){return d.Gb(n)});this.Cb(2,l.Md,"Smith",function(){}).enabled=!1;this.Cb(1,l.E,"Dungeon",function(){(new ca(d,new za.uc(c,new za.Nd(e[f],
0)))).a(d.parent)}).enabled=c.ra.some(function(a){return null!=a});this.Fa(2,[l.Nf],g("Town","Load"),function(){La.confirm(d,g("Town","ConfirmLoad"),{label:g("Town","Load"),click:function(){var a=Oa();a&&((new ca(d,new b(a))).a(d.parent),F.log(g("Town","NotifyLoad")))},La:ob},{label:g("Config","Cancel"),La:pb})});this.Fa(1,[l.rc],g("Town","Save"),function(){Qa(d.data);F.log(g("Town","NotifySave"))})}x(b,a);b.prototype.Nc=function(a){(a=this.data.ra[a])&&(new ca(this,new L(this.data,a))).a(this.parent)};
b.prototype.Cb=function(a,b,c,d){a=new K(950,665-100*a,320,90,new B(g("Town",c)),d,[b]);a.a(this);return a};return b}(r);a.qc=G;var q=function(a){function c(d){function e(a,b){(c=Array.prototype.splice).call.apply(c,[a,0,a.length].concat(b));var c}var f=this;a.call(this,d,"tavern.jpg");var h=d.ra.concat(),k=d.fb.concat();this.Fa(3,[l.Rc],g("Town","Clear"),function(){for(var a=0;6>a;++a){var b=d.ra[a];b&&(d.fb.push(b),d.ra[a]=null)}});this.Fa(2,[l.lg],g("Town","Revert"),function(){e(d.ra,h);e(d.fb,
k)});this.Fa(1,[l.tb,l.Bb],g("Town","Back"),function(){return f.Gb(G)});(new E(350,10,920,E.Xa(10),b(),d.fb,function(a,b){return f.Be(a,b)})).a(this)}x(c,a);c.prototype.Nc=function(a){var b=this.data.ra[a];b&&(this.data.ra[a]=null,this.data.fb.push(b))};c.prototype.Be=function(a,b){for(var c=0;6>c;++c)if(null==this.data.ra[c]){this.data.ra[c]=a;this.data.fb.splice(b,1);return}F.error(g("Town","PartyFull"))};return c}(r),n=function(a){function b(d){var f=this;a.call(this,d,"shop.jpg");var h=d.Lb,k=
d.Qb,p=new E(350,10,920,E.Xa(10),c(g("Town","Buy"),d),Fa(h),function(a){if(0>=h[a])F.error(g("Town","SoldOut"));else{var b=Y[a].m;if(d.pb<b)F.error(g("Town","NoMoney"));else{var c=new aa(a);--h[a];k.push(c);d.pb-=b;F.log(Da(g("Town","NotifyBuy").ta,c.name,b))}}});p.a(this);var q=new E(350,10,920,E.Xa(10),e(g("Town","Sell"),d),k,function(a,b){var c=a.sb,e=a.nh;k.splice(b,1);var f=h[c];null==f?(h[c]=1,p.rows.push(c)):h[c]=1+f;d.pb+=e;F.log(Da(g("Town","NotifySell").ta,a.name,e))});q.a(this);var n,u;
n=this.Fa(3,[l.Ld],g("Town","Buy"),function(){p.visible=!0;q.visible=!1;n.enabled=!1;u.enabled=!0});u=this.Fa(2,[l.rc],g("Town","Sell"),function(){p.visible=!1;q.visible=!0;n.enabled=!0;u.enabled=!1});this.Fa(1,[l.tb,l.Bb],g("Town","Back"),function(){return f.Gb(G)});n.click()}x(b,a);b.prototype.Nc=function(a){F.log("TODO: Shop.onPortraitClick: "+a)};return b}(r),L=function(a){function b(c,e){var h=this;a.call(this,c);var k=c.Qb,p=Ga(e,1280,720,!0);(new H(0,0,p.i,p.l,e)).a(this);(new H(0,0,200,40,
new B(e.name+" / Lv: "+e.level))).a(this);(new H(0,40,200,40,new B("INT: "+e.INT))).a(this);(new H(100,40,200,40,new B("DEX: "+e.da))).a(this);(new H(200,40,200,40,new B("STR: "+e.ka))).a(this);(new H(0,80,200,40,new B(function(){return"HP: "+e.qa}))).a(this);(new H(0,120,200,40,new B(function(){return"SP: "+e.g}))).a(this);(new H(0,160,200,40,new B(function(){return"WT: "+e.weight+"/"+e.xe}))).a(this);(new H(0,200,200,40,new B(function(){return"DEF: "+e.v.toFixed(1)}))).a(this);var n=new P([new E(350,
10,920,E.Xa(10),d(g("Town","Equipments")),e.ea,function(a,b){e.ea.splice(b,1);k.push(a)}),new E(350,360,920,E.Xa(10),d(g("Town","Warehouse")),k,function(a,b){k.splice(b,1);var c=e.ea,d=a.Sa,f=[],d=d&Pb;if(0!==d)for(var g=0;g<c.length;)0!==(c[g].Sa&d)?(f.push(c[g]),c.splice(g,1)):++g;e.ea.push(a);(h=k.push).call.apply(h,[k].concat(f));var h})]);n.a(this);var q=new P([new E(350,10,920,E.Xa(10),f(g("Town","Skills")),e.w,function(a,b){e.w.splice(b,1);e.yb.push(a)}),new E(350,360,920,E.Xa(10),f(g("Town",
"Knowns")),e.yb,function(a,b){e.yb.splice(b,1);e.w.push(a)})]);q.a(this);var u,r;u=this.Fa(3,[l.E],g("Town","Equipments"),function(){n.visible=!0;q.visible=!1;r.enabled=!0;u.enabled=!1});r=this.Fa(2,[l.rc],g("Town","Skills"),function(){n.visible=!1;q.visible=!0;r.enabled=!1;u.enabled=!0});this.Fa(1,[l.tb,l.Bb],g("Town","Back"),function(){return h.Gb(G)});u.click()}x(b,a);return b}(w)})(Wa||(Wa={}));var za;(function(a){function b(a,b){var m=a.s;return{s:m+[1,2,1,-1,-2,-1][b],la:a.la+(0===m%2?[-1,0,
0,0,0,-1]:[0,0,1,1,0,0])[b]}}function d(a,b){var m=a.s,t=b.s,c=t-m,m=2*b.la+t%2-(2*a.la+m%2);return 0>m?m>c?(-c-m)/2:m>-c?(c-m)/2:-m:m<c?(c+m)/2:m<-c?(-c+m)/2:m}function e(a,b){return a===b||!!a&&!!b&&a.s===b.s&&a.la===b.la}function c(a,b,m,t,c,d,e){var f=96,g=6,h=ea(0,1,t/c);t=null==d?h:ea(0,1,(t+d)/c);a.save();a.fillStyle=e.Ga;a.fillRect(b,m,f,g);b+=1;m+=1;f-=2;g-=2;t>h?(a.fillStyle=1<=h?e.wb:e.dc,a.fillRect(b,m,f*h-1,g),a.fillStyle=e.wb,a.fillRect(b+f*h,m,f*(t-h),g)):t<h?(c=f*t,0<t&&(c=U(c,2),
a.fillStyle=1<=h?e.wb:e.dc,a.fillRect(b,m,c-1,g)),a.fillStyle=e.ad,a.fillRect(b+c,m,f*(h-t),g)):(a.fillStyle=1<=h?e.wb:e.dc,a.fillRect(b,m,f*h,g));a.restore()}function f(a,b,m,t){var y=b.ga(t)+16;b=b.ha(t)+60;c(a,y,b,m.qa,m.Ka,null,nb)}function h(a,b,m,t,y){var d=b.ga(t)+16;b=b.ha(t)+60+6;c(a,d,b,m.g,m.$b,y-m.g,wb)}function z(a,b,m){var t=b.Sa;b=a.rb(b);return Sa(b*(100-m.v)/100*ia(N,a.level+a.jd(t)-m.level-m.je(t)))}function E(a,b,m){var t=m.Sa;m=b.rb(m);return Sa(m*ia(N,b.level+b.jd(t)-a.level))}
function r(a){var b=a.Sa;return 0!==(b&8192)?{r:255,ob:128,ib:0}:0!==(b&16384)?{r:0,ob:128,ib:255}:0!==(b&32768)?{r:255,ob:255,ib:0}:0!==(b&65536)?a.Zb?{r:255,ob:0,ib:128}:{r:0,ob:255,ib:128}:{r:255,ob:255,ib:255}}function M(a,b,m){var t=void 0,c=d(b,m)+1;a.hc(b,m,c,function(b,m){m===c&&a.get(b).empty&&(t=b)});return t}function q(a,b,m){var c=b.Ja(a,m),y=a.Na(m,c);m=new Oa(a,b.c,m.c);b.state=m;m.ld(function(){return y.a(a)});return p.Ta.Ea?sa([y,m]):m}function n(a,b,m,c){c=r(c);var y=Ka(c),d=Ka(c,
0);c=a.ga(b)-a.ga(m);var e=a.ha(b)-a.ha(m);c=100+ia(c*c+e*e,.5)/1280*400;c=new G(c,function(c,t){var e=a.ga(b),f=a.ha(b),g=a.ga(m),h=a.ha(m);bb(t,e*(1-c)+g*c+64-20,f*(1-c)+h*c+40-20,40,40,y,d,.5)});c.a(a);return c}function R(a,b,m,c,y){function d(m,c){var t=e.get(m).na;if(b.Jc(t)){var g=b.Ja(a,t);y&&(g.Ca=y(g.Ca,c));t=a.Na(t,g);t.a(a);f.push(t)}}var e=a.$,f=[];d(m,0);e.Ob(m,c,d);var g=r(b.pa),h=Ka(g,0),k=new G(400,function(b,d){var y=a.ga(m)+64,e=a.ha(m)+40,C=128*c*b,f=80*c*b,J=Ka(g,1-b);bb(d,y-C,
e-f,2*C,2*f,J,h,b)});k.a(a);return p.Ta.Ea?(f.push(k),sa(f)):k}var N=ia(2,.1),Y=[{lineWidth:2,fillStyle:k(0,0,68),strokeStyle:k(204,204,255)},{lineWidth:2,fillStyle:k(68,0,0),strokeStyle:k(255,204,204)}],T={fillStyle:"white",textAlign:"left",textBaseline:"top"},Z=w(0,0,0,0),ha=w(0,0,0,.75),aa={ya:k(230,255,180),za:k(51,230,51)},pa={ya:k(230,180,255),za:k(51,51,230)},la={ya:k(255,180,230),za:k(230,51,51)},ma={ya:k(230,180,255),za:k(51,51,230)},ra={za:k(64,192,255),ya:k(180,232,255),Ga:w(64,192,255,
.3)},ta={za:k(255,192,64),ya:k(255,232,192),Ga:w(255,192,64,.3)},va={Sc:{za:k(255,64,64),ya:k(255,180,180),Ga:w(255,192,64,.3)},Wc:{za:k(255,64,64),ya:k(255,180,180),Ga:w(255,128,64,.3)},Xc:{za:k(255,24,24),ya:k(255,64,64),Ga:w(255,24,24,.3)}},xa={Sc:{za:k(24,24,255),ya:k(180,180,255),Ga:w(255,192,64,.3)},Wc:{za:k(64,64,255),ya:k(180,180,255),Ga:w(24,128,255,.3)},Xc:{za:k(24,24,255),ya:k(64,64,255),Ga:w(24,24,255,.3)}},za=w(0,0,0,.65),Ca=w(0,0,0,0),Da={textAlign:"center",textBaseline:"bottom",fontSize:32,
fillStyle:"yellow",strokeStyle:"black",lineWidth:2},Ha={textAlign:"center",textBaseline:"bottom",fontSize:32,fillStyle:"red",strokeStyle:"black",lineWidth:2},wa=w(255,0,0,.8),Na=k(255,180,180),Ta=k(180,255,180),Ua=[{qd:"PartyTurn",md:k(0,0,128),sd:w(0,0,128,0),Pb:{fontSize:64,fillStyle:"white",textAlign:"center",textBaseline:"middle"}},{qd:"EnemyTurn",md:k(128,0,0),sd:w(128,0,0,0),Pb:{fontSize:64,fillStyle:"white",textAlign:"center",textBaseline:"middle"}}],ya,Ea,Za=function(){function a(b,m){this.ge=
m;this.cells={};this.depth=u(b)}Object.defineProperty(a.prototype,"minXH",{get:function(){return 1+Sa(this.depth)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxXH",{get:function(){return 20+u(this.depth)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"minVisibleXH",{get:function(){return u(this.depth)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxVisibleXH",{get:function(){return 21+Sa(this.depth)},enumerable:!0,configurable:!0});
a.prototype.contains=function(a,b){if(null==a)return!1;var c;null==b?(d=a,c=d.s,b=d.la,d):c=a;return 0<=b&&3>b&&this.ab<=c&&c<this.bc;var d};a.prototype.Ad=function(a,b){this.cells[a]=b};a.prototype.Xd=function(a){delete this.cells[a]};a.prototype.Aa=function(a,b){var c;null==b?(d=a,c=d.s,b=d.la,d):c=a;if(0<=b&&3>b&&this.cc<=c&&c<this.ac&&(c=this.cells[c]))return c[b];return;var d};a.prototype.get=function(a,b){var c;null==b?(d=a,c=d.s,b=d.la,d):c=a;return oa(this.Aa(c,b),this.ge);var d};a.prototype.set=
function(a,b,c){null==c&&(d=b,b=d.s,c=d.la,d);d=this.cells[b];null==d&&(d=this.cells[b]=[]);d[c]=a;var d};a.prototype.Dc=function(a){for(var b=this.bc,c=this.ab;c<b;++c)for(var d=0;3>d;++d)a.call(this,this.get(c,d),c,d)};a.prototype.Ec=function(a){for(var b=this.ac,c=this.cc;c<b;++c)for(var d=0;3>d;++d)a.call(this,this.get(c,d),c,d)};a.prototype.hc=function(a,b,c,y){if(!e(a,b)){var f=a.s,g=1+2*(2*a.la+a.s%2),h=d(a,b);a=(b.s-f)/h;b=(1+2*(2*b.la+b.s%2)-g)/h;for(h=1;h<=c;++h){var k=f+h*a,D=u((g+h*b)/
2),k=0===D%2?2*u((k+1)/2):2*u(k/2)+1,D=u(D/2);this.contains(k,D)&&y({s:k,la:D},h)}}};a.prototype.Ob=function(a,m,c){if(1===m)for(var d=0;6>d;++d){var e=b(a,d);this.contains(e)&&c(e,1)}else if(1<m){a=b(a,0);for(var f=1;f<=m;++f){for(var e=a,g=0,h=[2,3,4,5,0,1];g<h.length;g++)for(var d=h[g],k=0;k<f;++k,e=b(e,d))this.contains(e)&&c(e,f);a=b(a,0)}}};return a}(),da=function(){function a(b){this.duration=b}a.prototype.then=function(a){null==this.duration?L.then(a):this.ua=fa(this.ua,a);return this};a.prototype.Vb=
function(){ga(this.ua);this.duration=this.ua=void 0};a.prototype.Yb=function(a,b,c){if(null!=this.duration)if(c=G.Ub(c,this.start,this.duration),1<=c)this.Vb();else return this.ec(a,b,c)};a.prototype.kb=function(a,b,c,d,e,f,g){a.kb(b,c,d,e,f,g)};return a}(),Ma=function(a){function b(m){a.call(this,400*(13-m)/4)}x(b,a);b.prototype.ec=function(a,b,c){a=a.c;return{x:b.ga(a)-128*(1-c)+64,y:b.ha(a)+80}};return b}(da),Aa=function(a){function b(c){a.call(this,100*ia(c.length-1,.75));this.path=c}x(b,a);b.prototype.ec=
function(a,b,c){var d=this.path.length-1,e=u(d*c),f=this.path[e],g=this.path[e+1];a=b.ga(f);var f=b.ha(f),C=b.ga(g);b=b.ha(g);c=d*c-e;return{x:a*(1-c)+C*c+64,y:f*(1-c)+b*c+80}};return b}(da),Oa=function(a){function b(c,d,e){a.call(this,function(a,b,c){var m=a.ga(b)-a.ga(c);a=a.ha(b)-a.ha(c);return 200+ia(m*m+a*a,.3)/1280*1E3}(c,d,e));this.oe=d;this.pe=e}x(b,a);b.prototype.ld=function(a){null==this.duration?L.then(a):this.Hb=fa(this.Hb,a)};b.prototype.Vb=function(){ga(this.Hb);this.Hb=void 0;a.prototype.Vb.call(this)};
b.prototype.ec=function(a,b,c){var d=this.oe,e=this.pe;a=b.ga(d);var d=b.ha(d),f=b.ga(e);b=b.ha(e);.5>c?c*=2:(c=2-2*c,ga(this.Hb),this.Hb=null);return{x:a*(1-c)+f*c+64,y:d*(1-c)+b*c+80}};return b}(da),Pa=function(a){function b(c,d){a.call(this,500);var e=c.qa;this.lb=d>=e?c.c:null;this.vd=d>=e/2?1:.5+d/e}x(b,a);b.prototype.ec=function(a,b,c){var d=20*(1-c)*this.vd;c=c*W*this.duration/250*this.vd;a=this.lb||a.c;return{x:d*V(4*c)+b.ga(a)+64,y:d*V(3*c)+b.ha(a)+80}};b.prototype.kb=function(b,c,d,e,f,
g,C){this.lb?(g=G.Ub(d,this.start,this.duration),c.save(),c.globalAlpha=1-g,a.prototype.kb.call(this,b,c,d,e,f,"red",g),c.restore()):a.prototype.kb.call(this,b,c,d,e,f,g,C)};return b}(da),qb=function(){function a(b,c,d){this.ch=b;this.u=c;this.c=d;this.qe=$a();this.pa=b.w.find(function(a){return 0<b.cb(a)})||gb.Ua;this.qa=this.Ka;this.Lc=this.g=this.Ac;c=0;for(d=b.w;c<d.length;c++){var e=d[c];e.jh&&(e=this.vb(e),e<this.Lc&&(this.Lc=e))}this.fd=[]}Object.defineProperty(a.prototype,"name",{get:function(){return this.ch.name},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"level",{get:function(){return this.ch.level},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"INT",{get:function(){return this.ch.INT},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"DEX",{get:function(){return this.ch.da},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"STR",{get:function(){return this.ch.ka},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxHP",
{get:function(){return this.ch.qa},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxSP",{get:function(){return this.ch.g},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"availSP",{get:function(){return U(0,this.ch.g-this.ch.oh)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"step",{get:function(){return this.ch.step},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ZoC",{get:function(){return this.ch.Rd},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"DEF",{get:function(){return this.ch.v},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"skills",{get:function(){return this.ch.w},enumerable:!0,configurable:!0});a.prototype.vb=function(a){return this.ch.vb(a)};a.prototype.cb=function(a){return this.ch.cb(a)};a.prototype.rb=function(a){return this.ch.rb(a)};Object.defineProperty(a.prototype,"cost",{get:function(){return this.vb(this.pa)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"range",{get:function(){return this.cb(this.pa)},enumerable:!0,configurable:!0});a.prototype.kd=function(a,b){for(var c=0,d=0,e=this.ch.w;d<e.length;d++){var f=e[d];f.ue&&f.action===b&&0!==(a&f.Sa)&&(c+=f.wd)}return c};a.prototype.jd=function(a){return this.kd(a,"Offence")};a.prototype.je=function(a){return this.kd(a,"Defence")};a.prototype.Ic=function(a){return null!=a&&this.u!==a.u};a.prototype.Jc=function(a){return null==a?!1:this.pa.Zb?this.Ic(a):this!==a&&!this.Ic(a)};a.prototype.done=function(a){a=
a.Rb;if(!a)return!1;var b=this.c;return!!b&&this.g<this.Lc&&this.g<this.step+a[this.u].get(b)};a.prototype.Ja=function(a,b){var c=this.pa.f,d=ya[c];if(null==d)throw new RangeError('Effect not found: "'+c+'"');return d(a,this,b)};a.prototype.Qe=function(a,b){var c=this.pa.action,d=Ea[c];if(null==d)throw new RangeError('Action not found: "'+c+'"');c=d(a,this,b);this.g-=this.h;return c};a.prototype.De=function(a){this.u===a.u&&(this.g=this.Ac)};a.prototype.Ee=function(a){if(this.u===a.u){for(var b=0,
c=this.fd,d=c.length-1;0<=d;--d){var e=c[d];null!=e.Eb&&(b+=e.Eb);0>=--e.duration&&c.splice(d,1)}if(0!==b)return b=a.Na(this,{Ca:b}),b.a(a),b}return null};a.prototype.Yb=function(a,b){var c;this.state&&(c=this.state.Yb(this,a,b),null==c&&(this.state=null));if(null==c){var d=this.c;d&&(c={x:a.ga(d)+64,y:a.ha(d)+80})}return c};Object.defineProperty(a.prototype,"state",{get:function(){return this.Zc},set:function(a){var b=this.Zc;if(this.Zc=a)a.start=performance.now();b&&b.Vb()},enumerable:!0,configurable:!0});
a.prototype.kb=function(a,b,c,d,e,f){var g=this.ch,h=Ga(g,128,128),k=h.i,v=.2*k;bb(a,c-k/2,d-10-v/2,k,v,za,Ca,.75);b&&(k=200*(13-g.da),k=U(0,V(2*W*(this.qe+b%k/k))),d-=16*k+10*(1-k));h.x=c-h.i/2;h.y=d-h.l;g.aa(a,b,h,e,f)};a.prototype.aa=function(a,b,c,d,e,f){this.state?this.state.kb(this,a,b,c,d,e,f):this.kb(a,b,c,d,e,f)};a.prototype.Fb=function(a,b,d,e){var f=this.c,g=b.ga(f)+16;b=b.ha(f)+60;c(a,g,b,this.qa,this.Ka,d,nb);c(a,g,b+6,this.g,this.$b,e,wb)};a.compare=function(a,b){return a.y<b.y?-1:a.y>
b.y?1:a.x<b.x?-1:a.x>b.x?1:0};return a}(),Qa=function(){function a(b,c){void 0===b&&(b=0);this.type=b;this.na=c}Object.defineProperty(a.prototype,"empty",{get:function(){return null==this.na&&0===this.type},enumerable:!0,configurable:!0});a.Ua=new a(1);return a}(),Ra=function(a){function c(d,f,g){function h(a,b,c,d){var m=this,f=b.ca;if(1<=f){var g=b.c,t=a.$,y=a.Ib,k=this.get(d).g,C=c.get(d),J=mb(2*d.la+d.s%2-3),A=t.ab+y,zb=d.s<A,v=function(a){var b=m.get(a).g;if(k>b)return!0;if(k<b)return!1;b=a.s<
A;if(!zb&&b)return!0;if(zb&&!b)return!1;b=c.get(a);return C<b?!0:C>b?!1:d.s<a.s?!0:d.s>a.s?!1:J<mb(2*a.la+a.s%2-3)};t.Ob(d,f,function(c){if(!e(c,g)){var f=t.Aa(c);c=m.Fc(c);null==c.Ba?(c.Ba=d,f=f.na,b.Jc(f)&&(c.f=b.Ja(a,f))):v(c.Ba)&&(c.Ba=d)}})}}var k=this,Xa=d.$;a.call(this,Xa.depth,c.Ua);var l=d.Rb[f.u],Q=f.step,v=f.h,A=f.c;this.Fc(A).g=g;if(g>=Q+l.get(A))for(var O=[],p=A;p;p=O.shift()){var Ya=this.get(p).g-(Q+l.get(p));if(0<=Ya)for(var na=0;6>na;++na){var n=b(p,na),q=Xa.Aa(n);q&&0===q.type&&!f.Ic(q.na)&&
(q=this.Fc(n),q.g<Ya||q.g===Ya&&Xa.get(p).empty&&!Xa.get(q.Db).empty)&&(q.g=Ya,q.Db=p,Ya>=Q+l.get(n)&&O.push(n))}}g>=v&&(h.call(this,d,f,l,A),this.Dc(function(a,b,c){a.g>=v&&Xa.Aa(b,c).empty&&h.call(k,d,f,l,{s:b,la:c})}))}x(c,a);c.prototype.Fc=function(a){var b=this.Aa(a);null==b&&(b={g:-1},this.set(b,a));return b};c.prototype.Hc=function(a,b){var c=this.get(a),d=c.Db,e=c.Ba,f;if(c.f){if(!b.get(e).empty)return null;f=[e];c=this.get(e);d=c.Db;c}else if(d){if(!b.get(a).empty)return null;f=[a]}for(;d;)f.unshift(d),
c=this.get(d),d=c.Db,c;return f};c.Ua={g:-1};return c}(Za),db=function(a){function b(c,d,e,f,g,h){a.call(this,e,f,g,h,new B(function(){var a=c.focus;if(a){var b=a.w[d];if(b){var e=a.cb(b);if(0<e){var f=a.pa===b,g=a.vb(b),a=a.rb(b);return""+(f?"E ":"")+b.name.ta+"\n"+g+" / "+e+" / "+(0<a?a.toFixed(1):"-")}return b.name.ta+"\n"+("Offence"===b.action?"ATK":"DEF")+": "+cb(b.b)}}},{fontSize:20}),function(){var a=c.focus;if(a){var b=a.w[d];b&&0<a.cb(b)&&(a.pa=b,c.Ce(a))}});this.yd=c;this.index=d}x(b,a);
Object.defineProperty(b.prototype,"visible",{get:function(){var a=this.yd.focus;return null!=a&&null!=a.w[this.index]},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"enabled",{get:function(){var a=this.yd.focus;return null!=a&&0<a.cb(a.w[this.index])},enumerable:!0,configurable:!0});return b}(K),da=function(){function a(b,c,d){void 0===d&&(d=2);this.level=c;this.Ib=d;b="assets/"+("level/"+b+"/");this.se=new I(b+"sky.png");this.re=[new I(b+"tile.png"),new I(b+"hole.png")]}a.prototype.hd=
function(a,b){var c=0,d=0;a.mb(function(a){0===a.u?++c:++d});for(var e=0===c?.3:.3*ia(1.1,c-d),f=Array(3),g=Fa(xb),h=0;3>h;++h){var k=void 0,v=0;12<b&&$a()<e?(k=g[Ba(g.length)],k=X.ye(k,a.level),k=new qb(k,1,{s:b,la:h})):6<b&&.1>$a()&&(v=1);f[h]=new Qa(v,k)}return f};a.prototype.aa=function(a,b,c){var d=this,e=c.$,f=this.se.oa;if(f){a.save();var g=128*e.depth/2;a.fillStyle=a.createPattern(f,"repeat");a.translate(-g,0);a.fillRect(0+g,0,1280,80);a.restore()}var h={x:0,y:0,i:128,l:80};e.Ec(function(e,
f,g){e=e.type;h.x=c.ga(f,g);h.y=c.ha(f,g);d.re[e].aa(a,b,h)})};return a}();a.Nd=da;da=function(a){function b(c,d){function e(){var a=k.Za(k.focus);if(a){var b=k.controller.va;if(b&&a.get(b).f)return C.get(b).na}return null}function f(a,b,c){return new K(10+110*b,570,100,140,{aa:function(a,b,d){var e=c.ch,m=d.x,f=d.y,g=Ga(e,d.i,d.l,!0),h=g.i,g=g.l,m=m+(d.i-h)/2,f=f+(d.l-g)/2;if(c.c)e.aa(a,b,{x:m,y:f,i:h,l:g});else{var t=c.qa/c.Ka;.5<=t?e.aa(a,b,{x:m,y:f,i:h,l:g}):(e.images[Va.CLOSED]||e.images[Va.DEFAULT]).aa(a,
b,{x:m,y:f,i:h,l:g});ua(a,u(100*t).toFixed(0)+"%",d.x,d.y,d.i,d.l,{fillStyle:"white",strokeStyle:"black",textAlign:"center",textBaseline:"bottom"})}}},function(){if(c.c)Q.click(c.c);else if(.5<=c.qa/c.Ka){for(var d=C.ab,e=b%3,m=0;3>m;++m){if(C.get(d,e).empty){a.Je(c,{s:d,la:e});return}e=(e+1)%3}F.error(g("Combat","NoSpaceToRevive"))}else F.error(g("Combat","CannotRevive"))},[l.$1+b])}function h(a,b,c,d,e){b=new K(1280-150*b,570,140,140,new B(c),d);e&&qa(b,"enabled",e);b.a(a);return b}var k=this;a.call(this);
this.data=c;this.Nb=d;this.u=0;this.enabled=!1;var C=this.$=new Za(0,Qa.Ua);this.lb=[];this.Bc=[];this.gb=[];var Q=new eb;Q.a(this);Q.visible=!1;var v=new fb;v.a(this);v.visible=!1;for(var A=C.cc,v=C.ac;A<v;++A)C.Ad(A,this.Nb.hd(this,A));for(var O=[],p=[[2,0],[2,1],[2,2],[1,0],[1,1],[1,2]],q=c.ra,v=0;6>v;++v){var na=q[v];if(na){var n=p[v],A=n[0],A={s:A,la:n[1]},n=new qb(na,0,A);n.state=new Ma(na.da);C.Aa(A).na=n;O.push(f(this,v,n))}}var r=new P(O);qa(r,"visible",function(){return Q.visible&&null==
k.focus});r.a(this);h(r,1,g("Combat","End"),function(){return k.gd()});h(r,2,g("Combat","Undo"),function(){return Q.Ed()},function(){return Q.ah});h(r,3,g("Combat","Retire"),function(){return k.Ie()});var w=h(r,4,g("Combat","View")),v=new ba;v.ma=function(a,b){return k.fe(a,b,k.Gc)};v.a(this);v=new ba;v.ma=function(a){return k.$d(a)};qa(v,"visible",function(){return r.visible&&(w.sa||w.Da)});v.a(this);v=new P;qa(v,"visible",function(){return null!=k.focus});v.a(this);O=new ba;O.ma=function(a){return k.Zd(a,
k.focus,k.controller.va)};O.a(v);var x=new ka(0,560,1280,160);x.ma=function(a,b){return k.ed(a,b,k.focus,x)};x.a(v);O=new P;qa(O,"visible",function(){return Q.visible&&null!=k.focus});O.a(this);for(v=0;6>v;++v)(new db(this,v,400+170*u(v/2),570+v%2*75,160,65)).a(O);var z=new ka(640,560,640,160);qa(z,"visible",function(){return null!=e()});z.ma=function(a,b){return k.ed(a,b,e(),z)};z.a(this);v=System.canvas.getContext("2d");(new H(0,0,128,560,new lb({fillStyle:jb(v,0,0,128,0,ha,Z)}))).a(this);(new H(1152,
0,1280,560,new lb({fillStyle:jb(v,1152,0,1280,0,Z,ha)}))).a(this);kb(this);this.Cd()}x(b,a);Object.defineProperty(b.prototype,"controller",{get:function(){return this.children[this.u]},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"level",{get:function(){var a=this.Nb,b=a.level,a=a.Ib;0<a&&(b+=this.$.depth/a*.1);return b},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"numScrollsPerTurn",{get:function(){return this.Nb.Ib},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"focus",{get:function(){return this.vc},set:function(a){null==a?(this.vc=null,this.Gc=void 0):this.vc!==a&&(this.vc=a,this.Gc=performance.now())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"zoc",{get:function(){if(this.enabled){var a=this.zc;if(!a){var a=this.$.depth,b=[new Za(a,0),new Za(a,0)];this.mb(function(a){var c=a.Rd;if(0<c){var d=b[0===a.u?1:0];d.Ob(a.c,1,function(a){return d.set(d.get(a)+c,a)})}});this.zc=a=b}return a}},enumerable:!0,configurable:!0});b.prototype.Za=
function(a){if(a&&this.enabled){var b=this.$a;b||(this.$a=b=new Za(this.$.depth));var c=a.c,d=b.Aa(c);null==d&&(d=new Ra(this,a,a.g),b.set(d,c));return d}};b.prototype.Ce=function(a){var b=this.$a,c=this.gb;b&&b.set(void 0,a.c);if(c)for(b=0;b<c.length;b++){var d=c[b];d.na===a&&d.$a.set(void 0,d.c)}};b.prototype.Ne=function(a){this.gb.push({na:a,c:a.c,g:a.g,$a:this.$a,Rb:this.Rb})};b.prototype.Ke=function(){var a=this.gb.pop(),b=a.na;this.Ra(b,a.c);b.g=a.g;this.zc=a.Rb;this.$a=a.$a;this.focus=b};b.prototype.Ra=
function(a,b){var c=this.$,d=c.Aa(b),e=d.na;if(a){if(e===a)return;a.c&&(c.Aa(a.c).na=null);a.c=b}else e&&(e.c=null);d.na=a;this.nd()};b.prototype.Je=function(a,b){var c=this.Bc;c.splice(c.indexOf(a),1);a.g=a.Ac;a.state=new Ma(a.da);this.Ra(a,b);this.gb.length=0};b.prototype.nd=function(){this.$a=this.zc=void 0};b.prototype.Cd=function(){function a(){b.enabled=!0;b.controller.visible=!0}for(var b=this,c=this.u,d=0,e=this.Bc;d<e.length;d++){var f=e[d];if(f.u===c){var g=u(.1*f.Ka);f.qa=S(f.Ka,f.qa+g)}}var h;
this.mb(function(a){(a=a.Ee(b))&&(h?h.push(a):h=[a])});h?sa(h).then(a):a()};b.prototype.Ie=function(){var a=this;La.confirm(this,g("Combat","ConfirmRetire"),{label:g("Combat","Retire"),click:function(){a.controller.visible=!1;(new ca(a,new Wa.qc(a.data))).a(a.parent)},La:ob},{label:g("Config","Cancel"),La:pb})};b.prototype.gd=function(){var a=this;this.enabled=!1;this.gb.length=0;this.controller.visible=!1;this.mb(function(b){b.De(a)});if(0===this.u){var b=this.Ib;if(0<b){var c=this.$.ab+b;this.mb(function(b){b.c.s<
c&&(b.state=new Pa(b,b.qa),a.od(b))});var d=this.$.depth;(new G(400*b,function(c){a.scrollTo(d+b*c)})).a(this);if(this.te)return}}this.u=0===this.u?1:0;var e=Ua[this.u],f=e.md,h=e.sd,k=e.Pb,v=g("Combat",e.qd);(new G(800,function(a,b){b.save();b.globalAlpha=V(W*a);bb(b,0,0,1280,560,f,h);Ja(b,v.ta,640,280,k);b.restore()})).then(function(){a.Cd()}).a(this)};b.prototype.move=function(a,b){function c(){d.enabled=!0;a.done(d)&&(d.focus=null)}var d=this;this.focus=a;var f=this.$,g=this.Za(a),h=g.get(b);
if(h.f){this.enabled=!1;var k=f.get(b).na,v=function(){d.gb.length=0;d.nd();return a.Qe(d,k).then(c)};if(e(h.Ba,a.c))return v();f=g.Hc(b,f);h=f[f.length-1];this.Ra(a,h);a.g=g.get(h).g;g=a.state=new Aa(f);v=ib(v);g.then(v);return v}Ab(0<=h.g&&f.Aa(b).empty);f=g.Hc(b,f);this.Ra(a,b);a.g=h.g;g=a.state=new Aa(f);c();return p.Ta.Tb?g:L};b.prototype.Wb=function(a,b,c){var d=this.$,e=d.ab,f=d.bc,g=(0===this.u?b:!b)?1:-1;b=b?1:-1;var h,k;a?(h=a.s,k=a.la,a):(h=0>g?e:f-1,k=0>b?0:2);a=1;for(var A=3*(f-e+1);a<
A;++a){k+=b;if(0>k||3<=k)k=0>k?2:0,h+=g,h<e?h=f-1:f<=h&&(h=e);var l=d.Aa(h,k).na;if(l&&c(l))return l}return null};b.prototype.od=function(a){var b=this;a.qa=0;this.Ra(null,a.c);this.lb.push(a);0===a.u&&(this.Bc.push(a),this.parent&&this.te&&(this.controller.visible=!1,(a.state||L).then(function(){La.confirm(b,g("Combat","GameOver"),{label:g("Combat","Retire"),click:function(){(new ca(b,new Wa.qc(b.data))).a(b.parent)},La:tb})})))};Object.defineProperty(b.prototype,"isGameOver",{get:function(){return null==
this.Wb(null,!0,function(a){return 0===a.u})},enumerable:!0,configurable:!0});b.prototype.createPopup=function(a,b,c){var d=this.ga(c)+64,e=this.ha(c)+80;return new G(600,function(c,f){return Ja(f,a,d,e-40*c,{fontSize:48,fillStyle:b,strokeStyle:"black",globalAlpha:V(W*c),lineWidth:4,textAlign:"center",textBaseline:"bottom"})})};b.prototype.Na=function(a,b,c){var d=this,e=b.Ca||0,f=mb(e).toString(),g=this.createPopup(f,0<e?Ta:Na,c||a.c),h=g.a;g.a=function(c){var f=b.bd||0;if(0>e||0>f)a.state=new Pa(a,
-e);a.qa=ea(0,a.Ka,a.qa+e);0!==f&&(a.g=ea(0,a.$b,a.g+f));0>=a.qa?d.od(a):(f=b.duration,null!=f&&a.fd.push({duration:f,Eb:b.Eb}));return h.call(g,c)};return g};b.prototype.mb=function(a){var b=this;this.$.Ec(function(c){(c=c.na)&&a.call(b,c)})};b.prototype.ga=function(a,b){var c;null==b?(d=a,c=d.s,d):c=a;return 0+64*(c-1-this.$.depth);var d};b.prototype.ha=function(a,b){var c;null==b?(d=a,c=d.s,b=d.la,d):c=a;return 80+80*(2*b+c%2);var d};b.prototype.ic=function(a,b){var c=this.$,d=a-0+128*c.depth/
2,e=u((b-0-80)/80);return 0<=e&&6>e&&(d=0===e%2?2*u((d+64)/128):2*u(d/128)+1,c.ab<=d&&d<c.bc)?(c=u(e/2),{s:d,la:c}):null};b.prototype.scrollTo=function(a){var b=this.$;if(a>b.depth){var c=b.cc,d=b.ac;b.depth=a;a=b.cc;for(var e=b.ac;c<a;++c)b.Xd(c);for(c=U(a,d);c<e;++c)b.Ad(c,this.Nb.hd(this,c))}};b.prototype.ma=function(b,c){this.Nb.aa(b,c,this);var d=this.focus,e=this.Za(d);e&&this.ae(b,c,this.Gc,e,d);a.prototype.ma.call(this,b,c)};b.prototype.ae=function(a,b,c,d,e){var f=this,g=G.Ub(b,c,300);if(!(0>=
g)){var h=e.h;b=e.pa.Zb?va:xa;var k=b.Sc,l=b.Wc,C=b.Xc;a.save();1>g&&(a.globalAlpha=g);d.Ec(function(b,c,d){var e=b.g,t=b.Ba,y,D=0,J=0;b.f?(y=C,D=32*(1-g),J=20*(1-g)):e>=h?y=ra:0<=e?y=t?k:ta:t&&(y=l);y&&(b=f.ga(c,d)-D,c=f.ha(c,d)-J,D=128+2*D,J=80+2*J,a.fillStyle=y.Ga,a.fillRect(b+5,c+5,D-10,J-10),a.strokeStyle=y.za,a.lineWidth=2,a.strokeRect(b+2,c+2,D-4,J-4),a.strokeStyle=y.ya,a.lineWidth=1,a.strokeRect(b+4,c+4,D-8,J-8))});a.restore()}};b.prototype.fe=function(a,b,c){var d=this,e=this.Rb,f=this.focus,
h=[];this.mb(function(a){var c=a.Yb(d,b);c.na=a;h.push(c)});for(var k=0;k<this.lb.length;){var l=this.lb[k],A=l.Yb(this,b);A?(A.na=l,h.push(A),++k):this.lb.splice(k,1)}h.sort(qb.compare);k=g("Combat","Done").ta;c=(1-ja(2*W*G.Vd(b,c)))/2*.5;for(var C=(A=this.Za(f))&&f.pa.Zb?"red":"blue",D=0;D<h.length;D++){var p=h[D],l=p.na,n=p.x,p=p.y,q=void 0;if(A)if(f===l)q="yellow";else{var r=l.c;r&&A.get(r).f&&(q=C)}l.aa(a,b,n,p,q,c);if(!l.state&&e){var r=l.c,q=l.g,u=l.step,w=l.h,l=l.u;r&&q<w&&(q<u?Ja(a,k,n,p,
Da):q<u+e[l].get(r)&&Ja(a,k,n,p,Ha))}}};b.prototype.$d=function(a){var b=this;this.mb(function(c){return c.Fb(a,b)})};b.prototype.Zd=function(a,b,c){var d=this,g=this.Za(b);if(g){var k=this.$;g.Dc(function(b,c,e){(b=b.f)&&k.get(c,e).na.Fb(a,d,b.Ca,b.bd)});if(c){var l=g.get(c);l.f?(c=l.Ba,e(c,b.c)?b.Fb(a,this,null,-b.h):(f(a,this,b,b.c),h(a,this,b,c,g.get(c).g-b.h))):0<l.g&&k.get(c).empty?(f(a,this,b,b.c),h(a,this,b,c,l.g)):b.Fb(a,this)}else b.Fb(a,this)}};b.prototype.ed=function(a,b,c,d){if(c){Ia(a,
d,Y[c.u]);var e=c.ch,f=Ga(e,128,128);f.x=d.x+10+(128-f.i)/2;f.y=d.y+(d.l-f.l)/2;e.aa(a,b,f);b=c.g>=c.h?u((c.g-c.h)/c.step):"-";e=c.rb(c.pa);f=c.level;Ja(a,c.name+" / Lv: "+(null!=f?f.toFixed(1):"-")+"\n"+("HP: "+c.qa+" / "+c.Ka+"\n")+("SP: "+c.g+" / "+c.$b+"\n")+("MOVE: "+b+"/"+u(c.g/c.step)+"\n")+("ATK/DEF: "+(null!=e?e.toFixed(1):"-")+" / "+c.v.toFixed(1)),d.x+148,d.y+10,T)}};return b}(P);a.uc=da;var eb=function(a){function c(){a.apply(this,arguments);this.mode=0}x(c,a);Object.defineProperty(c.prototype,
"caret",{get:function(){return this.Yc},set:function(a){this.Yc=a;if(0===this.mode){var b=this.parent;b.focus=a?b.$.get(a).na:null}},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"canUndo",{get:function(){return 0<this.parent.gb.length||1<=this.mode},enumerable:!0,configurable:!0});c.prototype.Ed=function(){var a=this.parent,b=a.gb,c=b.length,b=0<c?b[c-1].na:null;1<=this.mode&&b!==a.focus?this.mode=0:b?a.Ke():F.error(g("Combat","CannotUndo"));this.va=this.Yc};c.prototype.qb=function(a,
b){this.va=this.parent.ic(a,b)};c.prototype.Qa=function(a,b){this.va=this.parent.ic(a,b)};c.prototype.cd=function(a){if(this.va=a){var b=this.parent,c=this.mode,d=b.focus;if(d){if(d.u===b.u&&!d.done(b)){this.mode=1===c&&e(a,d.c)?3:2;return}}else if(a=b.$.get(a).na,b.focus=a){this.mode=2;return}this.mode=0}};c.prototype.Pa=function(a,b){this.cd(this.parent.ic(a,b))};c.prototype.Fd=function(a){var b=this;if(this.va=a){var c=this.parent,d=this.mode;if(c.enabled&&!(2>d)){var f=c.focus;if(null==f||c.u!==
f.u)this.mode=0;else if(e(a,f.c))this.mode=2===d?1:0;else{d=c.Za(f).get(a);if(!d.f)if(0<=d.g&&c.$.Aa(a).empty)c.Ne(f);else{c.focus=null;this.mode=0;return}this.mode=1;a=c.move(f,a);f=function(){null==c.focus&&(b.mode=0)};c.enabled?f():a.then(f)}}}};c.prototype.Ma=function(a,b){this.Fd(this.parent.ic(a,b))};c.prototype.bb=function(a){function c(a){var d=this.parent.$,e=this.va;e?(a=b(e,a),d.contains(a)&&(this.va=a)):this.va={s:d.ab,la:0}}function d(a){var b=this.parent,c=this.va,e=b.u,f=b.focus;(a=
b.Wb(f?f.c:c,a,function(a){return a.u===e&&!a.done(b)}))?(b.focus=a,null==c&&(this.va=a.c),0===this.$g&&(this.mode=1)):F.error(g("Combat","UnitNotAvailable"))}switch(a){case l.tb:case l.Bb:case l.Q:this.Ed();break;case l.Uc:case l.Rc:d.call(this,!0);break;case l.Vc:d.call(this,!1);break;case l.tc:case l.pc:this.click(this.va);break;case l.E:c.call(this,0);break;case l.mg:case l.Md:c.call(this,1);break;case l.gf:case l.Wg:case l.rc:c.call(this,2);break;case l.Yg:c.call(this,3);break;case l.Of:case l.Kd:c.call(this,
4);break;case l.Qg:case l.Rg:c.call(this,5)}};c.prototype.click=function(a){this.parent.$.contains(a)&&(this.cd(a),this.Fd(a))};c.prototype.ma=function(a){function b(a,c,d,e){var f=c.ga(d)+6.5;c=c.ha(d)+6.5;a.save();a.lineCap="round";a.lineJoin="round";a.beginPath();a.moveTo(f+32,c);a.lineTo(f,c);a.lineTo(f,c+20);a.moveTo(f+115-32,c);a.lineTo(f+115,c);a.lineTo(f+115,c+20);a.moveTo(f+115-32,c+67);a.lineTo(f+115,c+67);a.lineTo(f+115,c+67-20);a.moveTo(f+32,c+67);a.lineTo(f,c+67);a.lineTo(f,c+67-20);
a.lineWidth=7;a.strokeStyle=e.za;a.stroke();a.lineWidth=3;a.strokeStyle=e.ya;a.stroke();a.restore()}function c(a,b,d){a.save();a.lineCap="butt";a.lineJoin="round";var e=d[d.length-2],f=d[d.length-1],g=b.ga(e)+64,h=b.ha(e)+40,e=b.ga(f)+64,f=b.ha(f)+40,g=ub(f-h,e-g);a.beginPath();a.moveTo(e+20*ja(g),f+20*V(g));a.lineTo(e+20*ja(g+2*W/3),f+20*V(g+2*W/3));a.lineTo(e+20*ja(g-2*W/3),f+20*V(g-2*W/3));a.fillStyle=wa;a.fill();a.beginPath();a.moveTo(e-10*ja(g),f-10*V(g));for(g=d.length-2;0<=g;--g)e=d[g],a.lineTo(b.ga(e)+
64,b.ha(e)+40);a.strokeStyle=wa;a.lineWidth=12;a.stroke();a.restore()}var d=this.va;if(d){var e=this.parent,f=e.focus,g=e.$;if(0===this.mode)b(a,e,d,aa);else if(f){var h=e.Za(f);if(h){var k=h.get(d);(h=h.Hc(d,g))&&2<=h.length&&c(a,e,h);if(k.f)switch(f.pa.target){case 1:b(a,e,d,la);break;case 2:b(a,e,d,ma);break;case 3:g.hc(k.Ba,d,f.ca,function(c){return b(a,e,c,la)});break;case 4:g.hc(k.Ba,d,f.ca,function(c){return b(a,e,c,ma)});break;case 5:g.Ob(k.Ba,f.ca,function(c){return b(a,e,c,la)});break;case 6:g.Ob(k.Ba,
f.ca,function(c){return b(a,e,c,ma)})}else 0<=k.g?b(a,e,d,pa):b(a,e,d,aa)}}}};return c}(ba),fb=function(a){function b(){a.apply(this,arguments);this.Oc=!1}x(b,a);Object.defineProperty(b.prototype,"visible",{get:function(){return this.Oc},set:function(a){var b=this;(this.Oc=a)&&L.then(function(){return b.xd([])})},enumerable:!0,configurable:!0});b.prototype.xd=function(a){function b(a,c){var d=a.focus;if(d)return d;var e=a.u,d=c.length,d=0<d?a.Wb(c[d-1].c,!1,function(b){return b.u===e&&!b.done(a)&&
0>c.indexOf(b)}):a.Wb(null,!1,function(b){return b.u===e&&!b.done(a)});return a.focus=d}function c(a,b,f){var g=a.Za(b),h=d(a,b,g),k=h.c;if(!g.get(k).f&&b.g>=b.Ac){var l=new Ra(a,b,999),k=d(a,b,l,h).c,h=l.get(k);h.f&&(k=h.Ba);for(h=a.$;k&&(0>g.get(k).g||!h.get(k).empty);)k=l.get(k).Db;null==k&&(k=b.c)}if(e(k,b.c))return f.push(b),a.focus=null;f.length=0;this.va=k;f=p.Ta.Sb;return 0<f?(g=ib(function(){return a.move(b,k)}),(new G(f)).then(g).a(a),g):a.move(b,k)}function d(a,b,c,e){var g=a.$,h=g.ab,
k=g.bc,l=b.$b,m=b.c,C=b.h,D=h+a.Ib;e||(e={c:m,zd:f(b,m.s,m.la,h,k,D)+40*b.g/l});c.Dc(function(d,m,p){var q=d.g,n=d.f;d=d.Ba;var t;if(n){q=t=f(b,d.s,d.la,h,k,D);t=a.$.Aa(m,p).na;var r;r=t.ch;for(var y=0,u=0,w=r.w;u<w.length;u++){var J=w[u];0<r.cb(J)&&(r.rb(J),y=J.Zb?z(t,J,b)/b.qa:E(a,t,J)/t.Ka,y=U(y,y))}r=S(1,y);n=n.Ca||0;n=0>n?-n:S(n,t.Ka-t.qa);n=S(1,n/t.qa);t=q+1E3*r*n;q=c.get(d).g-C}else if(0<=q&&g.get(m,p).empty)t=f(b,m,p,h,k,D);else return;t+=40*q/l;e.zd<t&&(e.zd=t,e.c={s:m,la:p})});return e}
function f(a,b,c,d,e,g){var h=0,h=1===a.u?h+10*(e-b):h+10*(b-d);a=2*c+b%2;h=3>a?h+10*a:h+10*(5-a);b<g&&(h*=.1);return h}for(var g=this,h=this.parent,k=null;this.Oc;){h.enabled||(k=L);if(k){k.then(function(){return g.xd(a)});break}this.va=null;k=b(h,a);if(null==k){h.gd();break}k=c.call(this,h,k,a)}};return b}(ba);ya={jf:function(a,b,c){return{Ca:-z(b,b.pa,c)}},kf:function(a,b,c){a=-z(b,b.pa,c);return{Ca:a,bd:u(a/2)}},lf:function(a,b,c){a=-z(b,b.pa,c);return{Ca:a,duration:2,Eb:u(a/2)}},Od:function(a,
b){return{Ca:E(a,b,b.pa)}},Ef:function(a,b){var c=E(a,b,b.pa);return{Ca:c,duration:2,Eb:Sa(c/2)}}};Ea={cf:q,Mf:function(a,b,c){var d=c.c,e=M(a.$,b.c,d);if(null==e)return q(a,b,c);var f=b.Ja(a,c),g=a.Na(c,f,e),f=new Oa(a,b.c,c.c),h=new Aa([d,e]);b.state=f;f.ld(function(){a.Ra(c,e);c.state=h});h.then(function(){g.a(a)});return p.Ta.Ea?sa([g,f]):f},Bf:function(a,b,c){var d=c.c,e=M(a.$,b.c,d);if(null==e)return q(a,b,c);var f=b.c,g=b.Ja(a,c),h=a.Na(c,g);c=new Aa([f,d]);a.Ra(b,e);b.state=c;c.then(function(){h.a(a)});
return p.Ta.Ea?h:c},Pg:function(a,b,c){var d=c.c,e=M(a.$,b.c,d);if(null==e)return q(a,b,c);var f=b.c,g=b.Ja(a,c),h=a.Na(c,g,e),f=new Aa([f,d]),g=new Aa([d,d,e]);a.Ra(c,e);c.state=g;a.Ra(b,d);b.state=f;g.then(function(){h.a(a)});return p.Ta.Ea?h:g},Qd:function(a,b,c){var d=b.Ja(a,c),e=a.Na(c,d);b=n(a,b.c,c.c,b.pa);b.then(function(){return e.a(a)});return p.Ta.Ea?e:b},pf:function(a,b,c){var d=b.Ja(a,c),e=a.Na(c,d),f=a.Na(b,{Ca:-d.Ca});b=n(a,c.c,b.c,b.pa);b.then(function(){return f.a(a)});e.a(a);return p.Ta.Ea?
f:b},tf:function(a,b,c){b.Ja(a,c);var d=n(a,b.c,c.c,b.pa),e=ib(function(){return R(a,b,c.c,1,function(a,b){return u(a/(1+b))})});d.then(e);return e},Qf:function(a,b,c){var d=a.$,e=b.c,f,g=[];d.hc(e,c.c,b.ca,function(c){var e=d.get(c).na;if(b.Jc(e)){var h=b.Ja(a,e),e=a.Na(e,h);e.a(a);g.push(e)}f=c});var h=r(b.pa);c=new G(400,function(b,c){var d=a.ga(e)+64,g=a.ha(e)+40,k=a.ga(f)+64,l=a.ha(f)+40,m=ub(l-g,k-d),n=64*ja(m),m=40*V(m);c.save();c.beginPath();c.moveTo(d+n,g+m);c.lineTo(k+n,l+m);c.lineCap="round";
c.lineWidth=80*b/4;c.strokeStyle=Ka(h,1-b);c.stroke();c.restore()});c.a(a);return p.Ta.Ea?(g.push(c),sa(g)):c},bg:function(a,b){return R(a,b,b.c,b.ca)}}})(za||(za={}));var Na,p=new (function(){function a(){this.xc=this.wc=!1;this.volume=new fb(50,0,100);this.nb=new fb(Ta.length-1,0,Ta.length-1)}Object.defineProperty(a.prototype,"magnifyCanvas",{get:function(){return this.wc},set:function(a){this.wc!==a&&(this.wc=a,window.dispatchEvent(new UIEvent("resize")))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"refineCanvas",{get:function(){return this.xc},set:function(a){this.xc!==a&&(this.xc=a,window.dispatchEvent(new UIEvent("resize")))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"wait",{get:function(){return Ta[this.nb.value]},enumerable:!0,configurable:!0});return a}());System.mh=function(a){var b=new Image;b.src="assets/dummy.png";I.Ua=b;var b=new P,d=new P;d.a(b);var e=new Jb(10,10,1260,700,2E3,Gb);e.a(b);F=e;Na=function(){for(;;){var a=d.children,b=a.length;if(0===b)break;
a[b-1].detach()}(new eb(new ya.uc)).a(d)};Fb();Na();Cb(a,b,p);System.bh=function(){db()}}})();
